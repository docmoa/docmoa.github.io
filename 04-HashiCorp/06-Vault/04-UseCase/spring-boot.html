<!doctype html>
<html lang="ko-KR" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta name="Spring Boot Vault" content="Spring Boot에 구성관리로 Vault 사용"><meta property="og:url" content="https://docmoa.github.io/04-HashiCorp/06-Vault/04-UseCase/spring-boot.html"><meta property="og:site_name" content="docmoa"><meta property="og:title" content="Vault로 Spring Boot 구성관리"><meta property="og:description" content="Vault로 Spring Boot 구성관리 Example Source : https://github.com/Great-Stone/vault_springboot_example 볼트는 애플리케이션(앱)의 구성관리, 특히 사용자 ID, 패스워드, Token, 인증서, 엔드포인트, AWS 자격증명 등과 같은 민감한 정보를 ..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/Great-Stone/images/master/uPic/image-20230406150032627.png"><meta property="og:locale" content="ko-KR"><meta property="og:updated_time" content="2023-09-18T13:12:54.000Z"><meta property="article:tag" content="vault"><meta property="article:tag" content="java"><meta property="article:tag" content="spring"><meta property="article:modified_time" content="2023-09-18T13:12:54.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Vault로 Spring Boot 구성관리","image":["https://raw.githubusercontent.com/Great-Stone/images/master/uPic/image-20230406150032627.png","https://raw.githubusercontent.com/Great-Stone/images/master/uPic/image-20230407093720360.png","https://raw.githubusercontent.com/Great-Stone/images/master/uPic/image-20230407094227005.png"],"dateModified":"2023-09-18T13:12:54.000Z","author":[]}</script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap"><link rel="icon" href="/logo.png"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://docmoa.github.io/rss.xml" title="docmoa RSS Feed"><title>Vault로 Spring Boot 구성관리 | docmoa</title><meta name="description" content="Vault로 Spring Boot 구성관리 Example Source : https://github.com/Great-Stone/vault_springboot_example 볼트는 애플리케이션(앱)의 구성관리, 특히 사용자 ID, 패스워드, Token, 인증서, 엔드포인트, AWS 자격증명 등과 같은 민감한 정보를 ...">
    <link rel="preload" href="/assets/style-CkODk6eP.css" as="style"><link rel="stylesheet" href="/assets/style-CkODk6eP.css">
    <link rel="modulepreload" href="/assets/app-DVMlqOhY.js"><link rel="modulepreload" href="/assets/spring-boot.html-DKsPZpEJ.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">본문으로 건너뛰기</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">docmoa</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="docmoa"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->docmoa<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/00-Howto/" aria-label="How To"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-rocket" style=""></span><!--]-->How To<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Infra"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-server" style=""></span>Infra<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/01-Infrastructure/" aria-label="Infrastructure"><!---->Infrastructure<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/02-PrivatePlatform/" aria-label="Private-Platform"><!---->Private-Platform<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/03-PublicCloud/" aria-label="Public-Cloud"><!---->Public-Cloud<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/05-Software/" aria-label="Software"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span><!--]-->Software<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/04-HashiCorp/" aria-label="HashiCorp"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-layer-group" style=""></span><!--]-->HashiCorp<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/07-Kubernetes/" aria-label="Kubernetes"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-dharmachakra" style=""></span><!--]-->Kubernetes<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/06-etc/" aria-label="Etc."><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-mug-hot" style=""></span><!--]-->Etc.<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="MORE"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>MORE<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/99-about/01-About.html" aria-label="About"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-house-circle-exclamation" style=""></span><!--]-->About<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/99-about/02-Thanks.html" aria-label="Thank you"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-heart" style=""></span><!--]-->Thank you<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/timeline/" aria-label="Recently"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-clock-rotate-left" style=""></span><!--]-->Recently<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/docmoa/docs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="검색"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">검색</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/" aria-label="HashiCorp"><!---->HashiCorp<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">01 Packer</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">02 Vagrant</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">03 Terraform</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">04 Consul</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">05 Boundary</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">06 Vault</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">01 Information</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">02 Secret Engine</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">03 Auth Method</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">04 Use Case</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/API-security.html" aria-label="API 보안을 위한 Vault 활용 (API Key)"><!---->API 보안을 위한 Vault 활용 (API Key)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/argocd-vault-plugin.html" aria-label="ArgoCD Vault Plugin"><!---->ArgoCD Vault Plugin<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/gitlabci-with-vault.html" aria-label="Gitlab 파이프라인의 Secret을 Vault로 관리"><!---->Gitlab 파이프라인의 Secret을 Vault로 관리<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/vault-k8s-usecase-csi-injection.html" aria-label="How to integrate Vault with K8s (CSI &amp; Injection &amp; VSO)"><!---->How to integrate Vault with K8s (CSI &amp; Injection &amp; VSO)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/jenkins-pipeilne-vault-approle.html" aria-label="Jenkins Pipeline Vault Approle (with Nomad)"><!---->Jenkins Pipeline Vault Approle (with Nomad)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/jenkins-with-vault.html" aria-label="jenkins with vault"><!---->jenkins with vault<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/jenkins-with-vault-otp.html" aria-label="jenkins with vault otp"><!---->jenkins with vault otp<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/vault-k8s-integration-three-methods.html" aria-label="Kubernetes Vault 통합방안 3가지 비교"><!---->Kubernetes Vault 통합방안 3가지 비교<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/vault-k8s-manually-using-the-sidecar.html" aria-label="Kubernetes에 Vault Agent(Sidecar) 수동 구성"><!---->Kubernetes에 Vault Agent(Sidecar) 수동 구성<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/sentinel-check-identity-cidr.html" aria-label="Sentinel - (Identity &amp; CIDR)"><!---->Sentinel - (Identity &amp; CIDR)<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/terraform-with-aws-secret-engine.html" aria-label="Terraform 코드 상에서 Vault 연동하기"><!---->Terraform 코드 상에서 Vault 연동하기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/nomad-integration.html" aria-label="Vault &amp; Nomad Integration Test"><!---->Vault &amp; Nomad Integration Test<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/mtls.html" aria-label="Vault PKI - mTLS demo"><!---->Vault PKI - mTLS demo<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/get-all-secret-engine.html" aria-label="Vault Secret Engine 조회 스크립트"><!---->Vault Secret Engine 조회 스크립트<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/secret-sync.html" aria-label="Vault Secret를 AWS Secret manager 연동"><!---->Vault Secret를 AWS Secret manager 연동<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/transit-stress-test.html" aria-label="Vault Stress Test"><!---->Vault Stress Test<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/04-HashiCorp/06-Vault/04-UseCase/spring-boot.html" aria-label="Vault로 Spring Boot 구성관리"><!---->Vault로 Spring Boot 구성관리<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/spring-boot-with-vault.html" aria-label="Vault로 Spring Boot 구성관리 aws-auth Version"><!---->Vault로 Spring Boot 구성관리 aws-auth Version<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/mtls-authentication-to-secure-web-services.html" aria-label="Vault를 활용한 mTLS 인증 자동화로 웹 서비스 보안 강화하기"><!---->Vault를 활용한 mTLS 인증 자동화로 웹 서비스 보안 강화하기<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/windows-password-rotation.html" aria-label="Windows Password rotation"><!---->Windows Password rotation<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/06-Vault/04-UseCase/Secured-RAG-with-Vault-on-aws.html" aria-label="안전한 RAG 시스템 구축: HashiCorp Vault와 Amazon Bedrock 활용"><!---->안전한 RAG 시스템 구축: HashiCorp Vault와 Amazon Bedrock 활용<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">05 Trouble Shooting</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">06 Config</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">07 Sentinel Sample</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">07 Nomad</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">08 Updates</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Vault로 Spring Boot 구성관리</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="작성일📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-04-09T23:54:58.000Z"></span><!----><span class="page-reading-time-info" aria-label="읽는 시간⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>약 25 분</span><meta property="timeRequired" content="PT25M"></span><!----><span class="page-tag-info" aria-label="태그🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color2 clickable" role="navigation">vault</span><span class="page-tag-item color8 clickable" role="navigation">java</span><span class="page-tag-item color8 clickable" role="navigation">spring</span><!--]--><meta property="keywords" content="vault,java,spring"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">이 페이지에서<button type="button" class="print-button" title="인쇄"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#구성관리-개념">구성관리 개념</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#볼트의-구성관리-저장소-및-관리">볼트의 구성관리 저장소 및 관리</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#example-1-spring-boot-application">[Example 1. Spring Boot Application]</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#example-2-spring-boot-application-rbac">[Example 2. Spring Boot Application + RBAC]</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="vault로-spring-boot-구성관리" tabindex="-1"><a class="header-anchor" href="#vault로-spring-boot-구성관리"><span>Vault로 Spring Boot 구성관리</span></a></h1><blockquote><p>Example Source : <a href="https://github.com/Great-Stone/vault_springboot_example" target="_blank" rel="noopener noreferrer">https://github.com/Great-Stone/vault_springboot_example</a></p></blockquote><p>볼트는 애플리케이션(앱)의 구성관리, 특히 사용자 ID, 패스워드, Token, 인증서, 엔드포인트, AWS 자격증명 등과 같은 민감한 정보를 안전하게 저장하는 중앙 집중식 인프라를 제공한다. 서비스의 성장과 더불어, 이를 구성하는 앱은 확장과 분리 요구 사항이 발생하면 구성 관리가 어려워 진다. 특히, 시크릿 정보가 포함되는 구성 관리는 수동으로 관리하는 경우 로컬 환경을 포함한 여러 시스템에 노출되는 위험성을 갖고, 환경마다 다른 시크릿을 관리하기위한 유지 관리의 노력과 비용이 증가한다. 볼트에서 이야기하는 앱과 관련한 &quot;시크릿 스프롤(퍼짐)&quot; 현상은 다음과 같다.</p><ul><li>시트릿의 위치가 파일 서버, Git 저장소, 로컬 환경, 앱 실행 환경등 다양한 곳에 존재하고 추적이 어려움</li><li>분산 서비스 및 Scale out/in 되는 앱 환경에 구성 설정의 변경 시 개별적 관리 필요</li><li>스크릿 사용의 위반 추적이 어렵고 거버넌스와 규제 요구사항에 대한 통제</li></ul><p>본질적으로 시크릿 스프롤은 가시성과 통제력의 저하를 야기한다.</p><h2 id="구성관리-개념" tabindex="-1"><a class="header-anchor" href="#구성관리-개념"><span>구성관리 개념</span></a></h2><p>앱과 구성 관계에서 구성관리의 원칙은 다음과 같다.</p><ul><li>구성은 앱과 분리되어야 한다.</li><li>앱은 한번 빌드되면 로직의 변화가 없는 경우 그대로 배포되어야 한다.</li><li>구성의 변경 사항은 앱의 런타임시 주입되어야 한다.</li><li>구성은 중앙집중화 되어 강력한 감사와 접근제어가 동반되어야 한다.</li><li>민감한 구성은 암호화 되어야 한다.</li><li>12 factor 앱 모범 사례에 따라, 중앙 저장소의 구성 데이터를 사용할 수 있도록(부트스트래핑) 앱을 설계해야 한다.</li></ul><h2 id="볼트의-구성관리-저장소-및-관리" tabindex="-1"><a class="header-anchor" href="#볼트의-구성관리-저장소-및-관리"><span>볼트의 구성관리 저장소 및 관리</span></a></h2><p>볼트는 구성 요소에 대해 중앙 저장소를 제공하며 다음과 같은 주요 이점이 있다.</p><ul><li>중앙 집중식 구성 저장소</li><li>저장되는 데이터의 암호화 저장</li><li>KV 형태의 구성 저장 및 버전 관리</li><li>정책 기반 접근관리</li><li>감사 기능</li><li>저장 및 인증을 위한 플러그인 기반</li><li>동적 시크릿 발급 및 수명주기 관리</li><li>고가용성(HA) 아키텍처 제공</li><li>정적 구성 요소 관리를 위한 템플릿팅 지원 (xml, json 등)</li><li>다중 클러스터 간 복제</li></ul><h3 id="example-1-spring-boot-application" tabindex="-1"><a class="header-anchor" href="#example-1-spring-boot-application"><span>[Example 1. Spring Boot Application]</span></a></h3><p>앱을 위한 볼트 구성을 위해 다음과 같이 볼트를 실행한다.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ vault server <span class="token parameter variable">-dev</span> -dev-root-token-id<span class="token operator">=</span>root -log-level<span class="token operator">=</span>trace</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">..</span>.</span>
<span class="line">You may need to <span class="token builtin class-name">set</span> the following environment variables:</span>
<span class="line"></span>
<span class="line">    $ <span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span><span class="token string">&#39;http://127.0.0.1:8200&#39;</span></span>
<span class="line"></span>
<span class="line">The unseal key and root token are displayed below <span class="token keyword">in</span> <span class="token keyword">case</span> you want to</span>
<span class="line">seal/unseal the Vault or re-authenticate.</span>
<span class="line"></span>
<span class="line">Unseal Key: UTZ7HoZCu8dtWa/eSMKcwq1klhC/qFoDxHXmhRn4qnE<span class="token operator">=</span></span>
<span class="line">Root Token: root</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>root</code> 토큰은 구성관리 관리자의 권한으로 가정한다.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span><span class="token string">&#39;http://127.0.0.1:8200&#39;</span></span>
<span class="line">$ vault login</span>
<span class="line">Token <span class="token punctuation">(</span>will be hidden<span class="token punctuation">)</span>: root</span>
<span class="line"></span>
<span class="line">Success<span class="token operator">!</span> You are now authenticated. The token information displayed below</span>
<span class="line">is already stored <span class="token keyword">in</span> the token helper. You <span class="token keyword">do</span> NOT need to run <span class="token string">&quot;vault login&quot;</span></span>
<span class="line">again. Future Vault requests will automatically use this token.</span>
<span class="line"></span>
<span class="line">Key                  Value</span>
<span class="line">---                  -----</span>
<span class="line">token                root</span>
<span class="line">token_accessor       w5LvrjTvDDcfjPHrnOj6ib7E</span>
<span class="line">token_duration       ∞</span>
<span class="line">token_renewable      <span class="token boolean">false</span></span>
<span class="line">token_policies       <span class="token punctuation">[</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">]</span></span>
<span class="line">identity_policies    <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">policies             <span class="token punctuation">[</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring Boot 앱에서 사용할 KV를 활성화 한다.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ vault secrets <span class="token builtin class-name">enable</span> <span class="token parameter variable">-path</span><span class="token operator">=</span>demo-app <span class="token parameter variable">-version</span><span class="token operator">=</span><span class="token number">2</span> kv</span>
<span class="line"></span>
<span class="line">Success<span class="token operator">!</span> Enabled the kv secrets engine at: demo-app/</span>
<span class="line"></span></code></pre></div><p>예제에서는 구성관리에서 MySQL 정보를 관리한다고 가정합니다. 관련 Spring Boot 앱은 <a href="https://start.spring.io" target="_blank" rel="noopener noreferrer">spring initializr</a>를 통해 생성한다.</p><figure><img src="https://raw.githubusercontent.com/Great-Stone/images/master/uPic/image-20230406150032627.png" alt="image-20230406150032627" tabindex="0" loading="lazy"><figcaption>image-20230406150032627</figcaption></figure><p>테스트를 위한 종속성 목록은 다음과 같다.</p><table><thead><tr><th>Dependencies</th><th>설명</th></tr></thead><tbody><tr><td>Spring Web</td><td>Spring MVC를 사용하여 RESTful을 포함한 웹 애플리케이션 구축에 사용</td></tr><tr><td>MySQL Driver</td><td>MySQL을 사용하기위한 드라이버 (MySQL 없는 경우 생략)</td></tr><tr><td>Spring Data JPA</td><td>JPA를 사용하기 편하도록 만들어놓은 모듈 (MySQL 없는 경우 생략)</td></tr><tr><td>Vault Configuration</td><td>분산 시스템에서 외부화된 볼트 구성에 대한 클라이언트 측 지원을 제공</td></tr><tr><td>Lombok</td><td>기계적인 코드들을 어노테이션을 기반으로 코드를 자동화하여 작성해주는 Java의 라이브러리</td></tr></tbody></table><p>MySQL의 경우 다음과 같이 구성한다.</p><div class="language-sql" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> java_dev_db<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">&#39;dev-user&#39;</span><span class="token variable">@&#39;%&#39;</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">&#39;dev-password&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> java_dev_db<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">&#39;dev-user&#39;</span><span class="token variable">@&#39;%&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><p>앱에서 사용할 구성을 볼트의 <code>demo-app/java_and_vault/dev</code>에 추가한다. 엔드포인트 정보의 조합은 <code>&lt;kv_endpoint&gt;/&lt;app_name&gt;/&lt;profile&gt;</code> 이다. 다음과 같이 CLI를 사용하여 구성 정보를 추가한다.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ vault kv put demo-app/java_and_vault/dev <span class="token punctuation">\</span></span>
<span class="line">		<span class="token assign-left variable">app.config.auth.token</span><span class="token operator">=</span>MY-AUTH-TOKEN-DEV-0000 <span class="token punctuation">\</span></span>
<span class="line">		<span class="token assign-left variable">app.config.auth.username</span><span class="token operator">=</span>dev-user <span class="token punctuation">\</span></span>
<span class="line">		<span class="token assign-left variable">spring.datasource.database</span><span class="token operator">=</span>java_dev_db <span class="token punctuation">\</span></span>
<span class="line">		<span class="token assign-left variable">spring.datasource.password</span><span class="token operator">=</span>dev-password <span class="token punctuation">\</span></span>
<span class="line">		<span class="token assign-left variable">spring.datasource.username</span><span class="token operator">=</span>dev-user</span>
<span class="line"></span></code></pre></div><p>UI에서 확인해보면 결과는 다음과 같다.</p><figure><img src="https://raw.githubusercontent.com/Great-Stone/images/master/uPic/image-20230407093720360.png" alt="image-20230407093720360" tabindex="0" loading="lazy"><figcaption>image-20230407093720360</figcaption></figure><p>앱과 볼트 연동 구성을 위해 다음을 추가한다. 기존 <code>application.properties</code> 대신 <code>application.yml</code>로 변경하여 구성한다.</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> java_and_vault</span>
<span class="line">  <span class="token key atrule">cloud.vault</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1</span>
<span class="line">      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8200</span></span>
<span class="line">      <span class="token key atrule">scheme</span><span class="token punctuation">:</span> http</span>
<span class="line">      <span class="token key atrule">config</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">      <span class="token key atrule">authentication</span><span class="token punctuation">:</span> TOKEN</span>
<span class="line">      <span class="token key atrule">token</span><span class="token punctuation">:</span> root</span>
<span class="line">      <span class="token key atrule">kv</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token key atrule">backend</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>app</span>
<span class="line">        <span class="token key atrule">profile-separator</span><span class="token punctuation">:</span> <span class="token string">&#39;/&#39;</span></span>
<span class="line">      <span class="token key atrule">generic</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">  <span class="token key atrule">config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">import</span><span class="token punctuation">:</span> vault<span class="token punctuation">:</span>//</span>
<span class="line">  <span class="token key atrule">datasource</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/$<span class="token punctuation">{</span>spring.datasource.database<span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>spring.cloud.vault</code> 에 볼트 관련 설정이 추가된다. <ul><li><code>host</code> : 볼트 서버의 호스트이름 또는 IP를 설정한다.</li><li><code>port</code> : 볼트 서버의 포트를 설정한다.</li><li><code>scheme</code> : 볼트 서버와의 통신에 사용할 프로토콜을 설정한다.</li><li><code>config.lifecycle.enabled</code>의 경우 동적인 시크릿에 대한 생명주기 관리 동작 여부를 설정한다. 여기서는 정적인 구성을 사용하므로 <code>false</code>로 설정한다.</li></ul></li><li><code>spring.cloud.vault.authentication</code>은 관리자 테스트를 위해 <code>TOKEN</code>으로 입력한다.</li><li><code>spring.cloud.vault.token</code>은 관리자용 인증인 <code>root</code>를 입력한다.</li><li><code>spring.cloud.vault.kv</code>는 활성화한 KV 의 선언을 위한 계층이다. <ul><li><code>enalbed</code> : 활성화 여부를 boolean 값으로 설정한다.</li><li><code>backend</code> : KV가 활성화된 엔드포인트 경로 이름을 입력한다. 기본 값은 <code>secret</code>이다.</li></ul></li><li><code>spring.cloud.vault.generic</code>은 v1 타입의 KV 선언을 위한 계층이다. <ul><li><code>enalbed</code> : 활성화 여부를 boolean 값으로 설정한다. 사용되지 않으므로 <code>false</code>로 설정한다.</li></ul></li><li><code>spring.config.import</code>에 <code>vault://</code>를 지정하여 볼트를 PropertySource로 마운트한다.</li><li><code>spring.datasource</code>에서 MySQL 연동관련 정의를 설정한다. <ul><li><code>url</code> : DB Connection Url을 명시한다.</li><li><code>database</code> : DB의 이름을 정의한다. 여기서는 볼트에서 해당 값을 가져온다.</li><li><code>username</code> : DB 계정 사용자 이름을 정의한다. 여기서는 볼트에서 해당 값을 가져오므로 생략되었다.</li><li><code>password</code> : DB 계정 사용자 패스워드를 정의한다. 여기서는 볼트에서 해당 값을 가져오므로 생략되었다.</li></ul></li></ul><p>기본 패키지 경로(e.g. <code>src/main/java/com/example/demo</code>)에 다음의 Java 파일을 추가한다.</p><p>| AppConfiguration.java</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Setter</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token annotation punctuation">@Getter</span></span>
<span class="line"><span class="token annotation punctuation">@Setter</span></span>
<span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;app.config.auth&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfiguration</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">String</span> token<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>@ConfigurationProperties</code>에 정의한 <code>app.config.auth</code>로 마운팅된 볼트의 내용을 주입한다.</li><li><code>AppConfiguration</code> 클래스는 어노테이션 정의에 따라 볼트로부터 내부에 정의되는 변수 <code>username</code>과 <code>token</code> 값이 할당된다.</li></ul><p>| AppService.java</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostConstruct</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">RequiredArgsConstructor</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token annotation punctuation">@Slf4j</span></span>
<span class="line"><span class="token annotation punctuation">@Service</span></span>
<span class="line"><span class="token annotation punctuation">@RequiredArgsConstructor</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppService</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AppConfiguration</span> appConfiguration<span class="token punctuation">;</span></span>
<span class="line">    <span class="token annotation punctuation">@PostConstruct</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readConfigs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Reading configuration {} - {}&quot;</span><span class="token punctuation">,</span> appConfiguration<span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> appConfiguration<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>readConfigs()</code> 메소드에 로그 출력에서 볼트로부터 할당된 변수 값을 확인한다.</li></ul><p>| DemoApplication.java</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="language-java"><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostConstruct</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Slf4j</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoApplication</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">	<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.datasource.username}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">String</span> ds_name<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.datasource.password}&quot;</span><span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">private</span> <span class="token class-name">String</span> ds_pw<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">DemoApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">	<span class="token annotation punctuation">@PostConstruct</span></span>
<span class="line">	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readDBconfigs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Reading datasource config {} - {}&quot;</span><span class="token punctuation">,</span> ds_name<span class="token punctuation">,</span> ds_pw<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>@Value</code> 로 볼트에서 가져오는 구성정보가 <code>application.yml</code>에 정의되어야 하는 구성 정보에 주입된 값을 받아온다.</li><li><code>readDBconfigs()</code> 메소드에 로그 출력에서 볼트로부터 할당된 구성 값을 확인한다.</li></ul><p>앱을 실행하여 구성을 가져오는지 확인한다.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ gradle bootRun <span class="token parameter variable">--args</span><span class="token operator">=</span><span class="token string">&#39;--spring.profiles.active=dev&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">&gt;</span> Task :bootRun</span>
<span class="line"></span>
<span class="line">  <span class="token builtin class-name">.</span>   ____          _            __ _ _</span>
<span class="line"> /<span class="token punctuation">\</span><span class="token punctuation">\</span> / ___<span class="token string">&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span>
<span class="line">( ( )\___ | &#39;</span>_ <span class="token operator">|</span> <span class="token string">&#39;_| | &#39;</span>_ <span class="token punctuation">\</span>/ _` <span class="token operator">|</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span></span>
<span class="line"> <span class="token punctuation">\</span><span class="token punctuation">\</span>/  ___<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span></span>
<span class="line">  &#39;  <span class="token operator">|</span>____<span class="token operator">|</span> .__<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">\</span>__, <span class="token operator">|</span> / / / /</span>
<span class="line"> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">|</span>___/<span class="token operator">=</span>/_/_/_/</span>
<span class="line"> :: Spring Boot ::                <span class="token punctuation">(</span>v3.0.5<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># dev profile이 사용됨을 표기</span></span>
<span class="line"><span class="token number">2023</span>-04-06T17:15:58.395+09:00  INFO <span class="token number">48275</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> </span>
<span class="line">com.example.demo.DemoApplication         <span class="token builtin class-name">:</span> The following <span class="token number">1</span> profile is active: <span class="token string">&quot;dev&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 앱 구성의 spring.datasource 에서 정의하는 정보가 볼트에서 가져와서 실행되어 Connection Pool이 생성되고, 가져온 계정 정보가 출력됨을 확인</span></span>
<span class="line"><span class="token number">2023</span>-04-06T17:16:00.359+09:00  INFO <span class="token number">48275</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.zaxxer.hikari.HikariDataSource       <span class="token builtin class-name">:</span> HikariPool-1 - Starting<span class="token punctuation">..</span>.</span>
<span class="line"><span class="token number">2023</span>-04-06T17:16:00.614+09:00  INFO <span class="token number">48275</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.zaxxer.hikari.pool.HikariPool        <span class="token builtin class-name">:</span> HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@57416e49</span>
<span class="line"><span class="token number">2023</span>-04-06T17:16:00.616+09:00  INFO <span class="token number">48275</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.zaxxer.hikari.HikariDataSource       <span class="token builtin class-name">:</span> HikariPool-1 - Start completed.</span>
<span class="line"><span class="token punctuation">..</span>.</span>
<span class="line"><span class="token number">2023</span>-04-07T08:57:39.888+09:00  INFO <span class="token number">52598</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.example.demo.DemoApplication         <span class="token builtin class-name">:</span> Reading datasource config dev-user - dev-password</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 앱 구성 app.config.auth 항목을 볼트에서 가져와서 출력됨을 확인</span></span>
<span class="line"><span class="token number">2023</span>-04-06T17:16:01.363+09:00  INFO <span class="token number">48275</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.example.demo.AppService              <span class="token builtin class-name">:</span> Reading configuration MY-AUTH-TOKEN-DEV-0000 - dev-user</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="example-2-spring-boot-application-rbac" tabindex="-1"><a class="header-anchor" href="#example-2-spring-boot-application-rbac"><span>[Example 2. Spring Boot Application + RBAC]</span></a></h3><p><code>Example 1</code>에서는 볼트의 루트 사용자를 사용하여 모든 구성 값을 확인할 수 있지만 앱과 이를 배포하는 사람, 파이프라인은 특정 구성에 대한 정보만 확인할 수 있어야 한다. 여기서는 <code>prd</code> 프로파일을 위한 구성과 정책 정의에 대해 확인한다.</p><p>MySQL의 경우 다음과 같이 구성한다.</p><div class="language-sql" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> java_prd_db<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">&#39;prd-user&#39;</span><span class="token variable">@&#39;%&#39;</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">&#39;prd-password&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> java_prd_db<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">&#39;prd-user&#39;</span><span class="token variable">@&#39;%&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><p><code>prd</code>를 위한 구성정보를 볼트에 추가한다.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ vault kv put demo-app/java_and_vault/prd <span class="token punctuation">\</span></span>
<span class="line">		<span class="token assign-left variable">app.config.auth.token</span><span class="token operator">=</span>MY-AUTH-TOKEN-prd-1111 <span class="token punctuation">\</span></span>
<span class="line">		<span class="token assign-left variable">app.config.auth.username</span><span class="token operator">=</span>prd-user <span class="token punctuation">\</span></span>
<span class="line">		<span class="token assign-left variable">spring.datasource.database</span><span class="token operator">=</span>java_prd_db <span class="token punctuation">\</span></span>
<span class="line">		<span class="token assign-left variable">spring.datasource.password</span><span class="token operator">=</span>prd-password <span class="token punctuation">\</span></span>
<span class="line">		<span class="token assign-left variable">spring.datasource.username</span><span class="token operator">=</span>prd-user</span>
<span class="line"></span></code></pre></div><figure><img src="https://raw.githubusercontent.com/Great-Stone/images/master/uPic/image-20230407094227005.png" alt="image-20230407094227005" tabindex="0" loading="lazy"><figcaption>image-20230407094227005</figcaption></figure><p>구성 관리자를 위한 Policy <code>java-and-vault-prd-admin.hcl</code>파일 내용 및 적용은 다음과 같다.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">cat</span> java-and-vault-prd-admin.hcl</span>
<span class="line"></span>
<span class="line">path <span class="token string">&quot;demo-app/data/java_and_vault/prd&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;create&quot;</span>, <span class="token string">&quot;update&quot;</span>, <span class="token string">&quot;read&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">$ vault policy <span class="token function">write</span> java-and-vault-prd-admin java-and-vault-prd-admin.hcl</span>
<span class="line"></span>
<span class="line">Success<span class="token operator">!</span> Uploaded policy: java-and-vault-prd-admin</span>
<span class="line"></span></code></pre></div><p>구성을 읽을수만 있는 Policy <code>java-and-vault-prd-read.hcl</code>파일 내용 및 적용은 다음과 같다.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">cat</span> java-and-vault-prd-read.hcl</span>
<span class="line"></span>
<span class="line">path <span class="token string">&quot;demo-app/data/java_and_vault/prd&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">$ vault policy <span class="token function">write</span> java-and-vault-prd-read java-and-vault-prd-read.hcl</span>
<span class="line"></span>
<span class="line">Success<span class="token operator">!</span> Uploaded policy: java-and-vault-prd-read</span>
<span class="line"></span></code></pre></div><p>앱을 위한 계정을 발급하기위한 Policy인 <code>java-and-vault-prd-approle.hcl</code> 파일 내용은 다음과 같다.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token function">cat</span> java-and-vault-prd-approle.hcl</span>
<span class="line"></span>
<span class="line">path <span class="token string">&quot;auth/approle/role/java-vault-prd/role-id&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;read&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">path <span class="token string">&quot;auth/approle/role/java-vault-prd/secret-id&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">  capabilities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;create&quot;</span>, <span class="token string">&quot;update&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">$ vault policy <span class="token function">write</span> java-and-vault-prd-approle java-and-vault-prd-approle.hcl</span>
<span class="line"></span>
<span class="line">Success<span class="token operator">!</span> Uploaded policy: java-and-vault-prd-approle</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>관리자에게 <code>java-and-vault-prd-admin</code>, <code>java-and-vault-prd-approle</code> 를 부여하여 구성에 대한 관리와 앱을위한 계정 발급 권한을 준다.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 활성화 되어있지 않다면 userpass Auth Method 활성화</span></span>
<span class="line">$ vault auth <span class="token builtin class-name">enable</span> userpass</span>
<span class="line"></span>
<span class="line">Success<span class="token operator">!</span> Enabled userpass auth method at: userpass/</span>
<span class="line"></span>
<span class="line">$ vault <span class="token function">write</span> auth/userpass/users/app-prd-admin <span class="token assign-left variable">password</span><span class="token operator">=</span>password <span class="token assign-left variable">policies</span><span class="token operator">=</span>java-and-vault-prd-admin,java-and-vault-prd-approle</span>
<span class="line"></span>
<span class="line">Success<span class="token operator">!</span> Data written to: auth/userpass/users/app-prd-admin</span>
<span class="line"></span></code></pre></div><p>앱을 위한 AppRole인증에 <code>java-and-vault-prd-read</code>를 추가한다.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># 활성화 되어있지 않다면 approle Auth Method 활성화</span></span>
<span class="line">$ vault auth <span class="token builtin class-name">enable</span> approle</span>
<span class="line"></span>
<span class="line">Success<span class="token operator">!</span> Enabled approle auth method at: approle/</span>
<span class="line"></span>
<span class="line">$ vault <span class="token function">write</span> auth/approle/role/java-vault-prd <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">secret_id_ttl</span><span class="token operator">=</span>10m <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">token_period</span><span class="token operator">=</span>24h <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">policies</span><span class="token operator">=</span><span class="token string">&quot;java-and-vault-prd-read&quot;</span></span>
<span class="line">    </span>
<span class="line">Success<span class="token operator">!</span> Data written to: auth/approle/role/java-vault-prd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>생성한 관리자 계정으로 로그인 하면 <code>demo-app/java_and_vault/prd</code> 의 구성 변경과 AppRole 계정의 <code>secret-id</code> 발급이 가능한지 확인한다. (별도의 터미널)</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span>http://127.0.0.1:8200</span>
<span class="line">$ vault login <span class="token parameter variable">-method</span> userpass <span class="token assign-left variable">username</span><span class="token operator">=</span>app-prd-admin <span class="token assign-left variable">password</span><span class="token operator">=</span>password</span>
<span class="line"></span>
<span class="line">Success<span class="token operator">!</span> You are now authenticated. The token information displayed below</span>
<span class="line">is already stored <span class="token keyword">in</span> the token helper. You <span class="token keyword">do</span> NOT need to run <span class="token string">&quot;vault login&quot;</span></span>
<span class="line">again. Future Vault requests will automatically use this token.</span>
<span class="line"></span>
<span class="line">Key                    Value</span>
<span class="line">---                    -----</span>
<span class="line">token                  hvs.CAESIAE31Vrf91UbPhV5O0eh8KM0Tky_7MGk5ThyRu4tJbhUGh4KHGh2cy50ZDdZZ09BdDRnRmpqdkVRcUJYOWR5YUI</span>
<span class="line">token_accessor         9XuvRw1jKWt99iwlZ146652v</span>
<span class="line">token_duration         768h</span>
<span class="line">token_renewable        <span class="token boolean">true</span></span>
<span class="line">token_policies         <span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span> <span class="token string">&quot;java-and-vault-prd-admin&quot;</span> <span class="token string">&quot;java-and-vault-prd-approle&quot;</span><span class="token punctuation">]</span></span>
<span class="line">identity_policies      <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">policies               <span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span> <span class="token string">&quot;java-and-vault-prd-admin&quot;</span> <span class="token string">&quot;java-and-vault-prd-approle&quot;</span><span class="token punctuation">]</span></span>
<span class="line">token_meta_username    app-prd-admin</span>
<span class="line"></span>
<span class="line">$ vault kv put demo-app/java_and_vault/prd <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">app.config.auth.token</span><span class="token operator">=</span>MY-AUTH-TOKEN-prd-1111 <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">app.config.auth.username</span><span class="token operator">=</span>prd-user <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">spring.datasource.database</span><span class="token operator">=</span>java_prd_db <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">spring.datasource.password</span><span class="token operator">=</span>prd-password <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">spring.datasource.username</span><span class="token operator">=</span>prd-user</span>
<span class="line">    </span>
<span class="line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> Secret Path <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></span>
<span class="line">demo-app/data/java_and_vault/prd</span>
<span class="line"></span>
<span class="line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Metadata <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></span>
<span class="line">Key                Value</span>
<span class="line">---                -----</span>
<span class="line">created_time       <span class="token number">2023</span>-04-07T01:54:45.464698Z</span>
<span class="line">custom_metadata    <span class="token operator">&lt;</span>nil<span class="token operator">&gt;</span></span>
<span class="line">deletion_time      n/a</span>
<span class="line">destroyed          <span class="token boolean">false</span></span>
<span class="line">version            <span class="token number">2</span></span>
<span class="line"></span>
<span class="line">$ vault <span class="token builtin class-name">read</span> auth/approle/role/java-vault-prd/role-id</span>
<span class="line"></span>
<span class="line">Key        Value</span>
<span class="line">---        -----</span>
<span class="line">role_id    53b96749-1234-fec1-05b8-760c29991d89</span>
<span class="line"></span>
<span class="line">$ vault <span class="token function">write</span> <span class="token parameter variable">-f</span> auth/approle/role/java-vault-prd/secret-id</span>
<span class="line"></span>
<span class="line">Key                   Value</span>
<span class="line">---                   -----</span>
<span class="line">secret_id             69b144ae-543a-81e3-9afa-8b290d8efd75</span>
<span class="line">secret_id_accessor    d9338290-f1ff-ca09-fbaf-742071afeaa6</span>
<span class="line">secret_id_num_uses    <span class="token number">0</span></span>
<span class="line">secret_id_ttl         10m</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>앱에서 사용할 AppRole 계정으로 로그인 하면 <code>demo-app/java_and_vault/prd</code> 의 구성 변경을 읽을수는 있고 업데이트는 안되는 여부를 확인한다. (별도의 터미널)</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">VAULT_ADDR</span><span class="token operator">=</span>http://127.0.0.1:8200</span>
<span class="line">$ vault <span class="token function">write</span> auth/approle/login <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">role_id</span><span class="token operator">=</span>53b96749-1234-fec1-05b8-760c29991d89 <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">secret_id</span><span class="token operator">=</span>aebbc4ac-79e4-c529-8751-c52f2f31a3d7</span>
<span class="line"></span>
<span class="line">Key                     Value</span>
<span class="line">---                     -----</span>
<span class="line">token                   hvs.CAESIC7bpDI_cDGLCpKl6rZ</span>
<span class="line">token_accessor          guDRqHNpnJtpmFXqkqsahc2e</span>
<span class="line">token_duration          24h</span>
<span class="line">token_renewable         <span class="token boolean">true</span></span>
<span class="line">token_policies          <span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span> <span class="token string">&quot;java-and-vault-prd-read&quot;</span><span class="token punctuation">]</span></span>
<span class="line">identity_policies       <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">policies                <span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span> <span class="token string">&quot;java-and-vault-prd-read&quot;</span><span class="token punctuation">]</span></span>
<span class="line">token_meta_role_name    java-vault-prd</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 앱용 계정은 부여된 권한에 읽기 권한이 있으므로 정보 확인</span></span>
<span class="line">$ <span class="token assign-left variable">VAULT_TOKEN</span><span class="token operator">=</span>hvs.CAESIC7bpDI_cDGLCpKl6rZ vault kv get demo-app/java_and_vault/prd</span>
<span class="line"></span>
<span class="line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> Secret Path <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></span>
<span class="line">demo-app/data/java_and_vault/prd</span>
<span class="line"></span>
<span class="line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Metadata <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></span>
<span class="line">Key                Value</span>
<span class="line">---                -----</span>
<span class="line">created_time       <span class="token number">2023</span>-04-07T01:54:45.464698Z</span>
<span class="line">custom_metadata    <span class="token operator">&lt;</span>nil<span class="token operator">&gt;</span></span>
<span class="line">deletion_time      n/a</span>
<span class="line">destroyed          <span class="token boolean">false</span></span>
<span class="line">version            <span class="token number">2</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> Data <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></span>
<span class="line">Key                           Value</span>
<span class="line">---                           -----</span>
<span class="line">app.config.auth.token         MY-AUTH-TOKEN-prd-1111</span>
<span class="line">app.config.auth.username      prd-user</span>
<span class="line">spring.datasource.database    java_prd_db</span>
<span class="line">spring.datasource.password    prd-password</span>
<span class="line">spring.datasource.username    prd-user</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 앱용 계정은 부여된 권한에 쓰기 권한이 없으므로 관련 요청시 권한 거부</span></span>
<span class="line">$ <span class="token assign-left variable">VAULT_TOKEN</span><span class="token operator">=</span>hvs.CAESIC7bpDI_cDGLCpKl6rZ vault kv put demo-app/java_and_vault/prd <span class="token punctuation">\</span></span>
<span class="line">    <span class="token assign-left variable">app.config.auth.token</span><span class="token operator">=</span>MY-AUTH-TOKEN-prd-2222</span>
<span class="line"></span>
<span class="line">Error writing data to demo-app/data/java_and_vault/prd: Error making API request.</span>
<span class="line"></span>
<span class="line">URL: PUT http://127.0.0.1:8200/v1/demo-app/data/java_and_vault/prd</span>
<span class="line">Code: <span class="token number">403</span>. Errors:</span>
<span class="line"></span>
<span class="line">* <span class="token number">1</span> error occurred:</span>
<span class="line">	* permission denied</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>앱과 정책이 적용된 볼트 연동 구성을 위해 <code>application.yml</code>를 수정한다.</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="line"><span class="token key atrule">spring</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">application</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> java_and_vault</span>
<span class="line">  <span class="token key atrule">cloud.vault</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1</span>
<span class="line">      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8200</span></span>
<span class="line">      <span class="token key atrule">scheme</span><span class="token punctuation">:</span> http</span>
<span class="line">      <span class="token key atrule">config</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">      <span class="token comment"># authentication: TOKEN</span></span>
<span class="line">      <span class="token comment"># token: root</span></span>
<span class="line">      <span class="token key atrule">authentication</span><span class="token punctuation">:</span> APPROLE</span>
<span class="line">      <span class="token key atrule">app-role</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">role-id</span><span class="token punctuation">:</span> 53b96749<span class="token punctuation">-</span>1234<span class="token punctuation">-</span>fec1<span class="token punctuation">-</span>05b8<span class="token punctuation">-</span>760c29991d89</span>
<span class="line">        <span class="token key atrule">secret-id</span><span class="token punctuation">:</span> aebbc4ac<span class="token punctuation">-</span>79e4<span class="token punctuation">-</span>c529<span class="token punctuation">-</span>8751<span class="token punctuation">-</span>c52f2f31a3d7</span>
<span class="line">        <span class="token key atrule">role</span><span class="token punctuation">:</span> db<span class="token punctuation">-</span>kv<span class="token punctuation">-</span>reader</span>
<span class="line">        <span class="token key atrule">app-role-path</span><span class="token punctuation">:</span> approle</span>
<span class="line">      <span class="token key atrule">kv</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">        <span class="token key atrule">backend</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>app</span>
<span class="line">        <span class="token key atrule">profile-separator</span><span class="token punctuation">:</span> <span class="token string">&#39;/&#39;</span></span>
<span class="line">      <span class="token key atrule">generic</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">  <span class="token key atrule">config</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">import</span><span class="token punctuation">:</span> vault<span class="token punctuation">:</span>//</span>
<span class="line">  <span class="token key atrule">datasource</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/$<span class="token punctuation">{</span>spring.datasource.database<span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>spring.cloud.vault.authentication</code>은 앱용 인증으로 생성한 방식인 <code>APPROLE</code>을 설정한다.</li><li><code>spring.cloud.vault.authentication.app-role</code>은 <code>APPROLE</code>인증에 대한 선언을 위한 계층이다. <ul><li><code>role-id</code> : 발급한 <code>role-id</code>를 설정한다.</li><li><code>secret-id</code> : 발급한 <code>secret-id</code>를 설정한다. <code>secret-id</code>는 제한시간이 <code>10m</code>이였으므로, 배포시마다 교체해주어 계정을 보호한다.</li><li><code>role</code> : <code>role-id</code>가 포함된 Approle의 이름을 설정한다.</li><li><code>app-role-path</code> : 활성화된 Approle의 엔드포인트 경로 이름을 입력한다.</li></ul></li></ul><p>앱을 실행하여 구성을 가져오는지 확인한다. <code>prd</code> 프로파일을 지정한다.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ gradle bootRun <span class="token parameter variable">--args</span><span class="token operator">=</span><span class="token string">&#39;--spring.profiles.active=prd&#39;</span>                                                                      </span>
<span class="line"></span>
<span class="line"><span class="token operator">&gt;</span> Task :bootRun</span>
<span class="line"></span>
<span class="line">  <span class="token builtin class-name">.</span>   ____          _            __ _ _</span>
<span class="line"> /<span class="token punctuation">\</span><span class="token punctuation">\</span> / ___<span class="token string">&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span>
<span class="line">( ( )\___ | &#39;</span>_ <span class="token operator">|</span> <span class="token string">&#39;_| | &#39;</span>_ <span class="token punctuation">\</span>/ _` <span class="token operator">|</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span></span>
<span class="line"> <span class="token punctuation">\</span><span class="token punctuation">\</span>/  ___<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span></span>
<span class="line">  &#39;  <span class="token operator">|</span>____<span class="token operator">|</span> .__<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token operator">|</span>_<span class="token operator">|</span> <span class="token operator">|</span>_<span class="token punctuation">\</span>__, <span class="token operator">|</span> / / / /</span>
<span class="line"> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">|</span>_<span class="token operator">|</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">|</span>___/<span class="token operator">=</span>/_/_/_/</span>
<span class="line"> :: Spring Boot ::                <span class="token punctuation">(</span>v3.0.5<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># prd profile이 사용됨을 표기</span></span>
<span class="line"><span class="token number">2023</span>-04-07T14:05:03.395+09:00  INFO <span class="token number">67782</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.example.demo.DemoApplication         <span class="token builtin class-name">:</span> The following <span class="token number">1</span> profile is active: <span class="token string">&quot;prd&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 앱 구성의 spring.datasource 에서 정의하는 정보가 볼트에서 가져온 계정 정보가 출력됨을 확인</span></span>
<span class="line"><span class="token number">2023</span>-04-07T14:05:05.099+09:00  INFO <span class="token number">67782</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.example.demo.DemoApplication         <span class="token builtin class-name">:</span> Reading datasource config prd-user - prd-password</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 앱 구성 app.config.auth 항목을 볼트에서 가져와서 출력됨을 확인</span></span>
<span class="line"><span class="token number">2023</span>-04-07T14:05:05.103+09:00  INFO <span class="token number">67782</span> --- <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> com.example.demo.AppService              <span class="token builtin class-name">:</span> Reading configuration MY-AUTH-TOKEN-prd-1111 - prd-user</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>권한이 없는 <code>dev</code> 프로파일을 지정하는 경우 구성 값을 가져오지 못하므로 앱이 실행될 때 에러가 발생한다.</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/docmoa/docs/edit/main/docs/04-HashiCorp/06-Vault/04-UseCase/spring-boot.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">마지막 수정: </span><!----></div><div class="contributors"><span class="vp-meta-label">기여자: </span><!--[--><!--[--><span class="vp-meta-info" title="email: hahohh@gmail.com">Great-Stone</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/04-HashiCorp/06-Vault/04-UseCase/transit-stress-test.html" aria-label="Vault Stress Test"><div class="hint"><span class="arrow start"></span>이전</div><div class="link"><!---->Vault Stress Test</div></a><a class="route-link auto-link next" href="/04-HashiCorp/06-Vault/04-UseCase/spring-boot-with-vault.html" aria-label="Vault로 Spring Boot 구성관리 aws-auth Version"><div class="hint">다음<span class="arrow end"></span></div><div class="link">Vault로 Spring Boot 구성관리 aws-auth Version<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">CC BY-NC-ND 4.0 Licensed | ⓒ 2021-present docmoa™ contributers all rights reserved.</div><!----></footer></div><!--]--><!--]--><!--[--><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DVMlqOhY.js" defer></script>
  </body>
</html>
