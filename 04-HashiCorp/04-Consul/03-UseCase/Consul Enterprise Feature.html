<!doctype html>
<html lang="ko-KR" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://docmoa.github.io/04-HashiCorp/04-Consul/03-UseCase/Consul%20Enterprise%20Feature.html"><meta property="og:site_name" content="docmoa"><meta property="og:title" content="Consul Mesh Gateway - K8S x BMs/VMs"><meta property="og:description" content="Mesh Gateway k8s and VM"><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/Great-Stone/images/master/uPic/HashiCorp%20General%20Presentation%20Template%20%28KR%29%20-%20Apr%202020%20-%20Google%20Slides%202020-11-12%2015-58-54.png"><meta property="og:locale" content="ko-KR"><meta property="og:updated_time" content="2023-09-18T13:12:54.000Z"><meta property="article:tag" content="Consul"><meta property="article:tag" content="Hybrid"><meta property="article:tag" content="Kubetenetes"><meta property="article:tag" content="k8s"><meta property="article:tag" content="VM"><meta property="article:modified_time" content="2023-09-18T13:12:54.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Consul Mesh Gateway - K8S x BMs/VMs","image":["https://raw.githubusercontent.com/Great-Stone/images/master/uPic/HashiCorp%20General%20Presentation%20Template%20%28KR%29%20-%20Apr%202020%20-%20Google%20Slides%202020-11-12%2015-58-54.png","https://raw.githubusercontent.com/Great-Stone/images/master/uPic/DESKTOP-LenovoMini%202020-11-15%2020-36-36.png","https://raw.githubusercontent.com/Great-Stone/images/master/uPic/consul-datacenter-dropdown.png","https://learn.hashicorp.com/img/consul/connect-getting-started/screenshot1.png","https://raw.githubusercontent.com/Great-Stone/images/master/uPic/Edit%20Intention%20-%20Consul%202020-11-16%2000-27-50.png","https://learn.hashicorp.com/img/consul/connect-getting-started/screenshot2.png"],"dateModified":"2023-09-18T13:12:54.000Z","author":[]}</script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap"><link rel="icon" href="/logo.png"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://docmoa.github.io/rss.xml" title="docmoa RSS Feed"><title>Consul Mesh Gateway - K8S x BMs/VMs | docmoa</title><meta name="description" content="Mesh Gateway k8s and VM">
    <link rel="preload" href="/assets/style-CkODk6eP.css" as="style"><link rel="stylesheet" href="/assets/style-CkODk6eP.css">
    <link rel="modulepreload" href="/assets/app-DVMlqOhY.js"><link rel="modulepreload" href="/assets/Consul Enterprise Feature.html-mWqXTj_6.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">ë³¸ë¬¸ìœ¼ë¡œ ê±´ë„ˆë›°ê¸°</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">docmoa</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="docmoa"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->docmoa<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/00-Howto/" aria-label="How To"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-rocket" style=""></span><!--]-->How To<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Infra"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-server" style=""></span>Infra<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/01-Infrastructure/" aria-label="Infrastructure"><!---->Infrastructure<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/02-PrivatePlatform/" aria-label="Private-Platform"><!---->Private-Platform<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/03-PublicCloud/" aria-label="Public-Cloud"><!---->Public-Cloud<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/05-Software/" aria-label="Software"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span><!--]-->Software<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/04-HashiCorp/" aria-label="HashiCorp"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-layer-group" style=""></span><!--]-->HashiCorp<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/07-Kubernetes/" aria-label="Kubernetes"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-dharmachakra" style=""></span><!--]-->Kubernetes<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/06-etc/" aria-label="Etc."><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-mug-hot" style=""></span><!--]-->Etc.<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="MORE"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>MORE<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/99-about/01-About.html" aria-label="About"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-house-circle-exclamation" style=""></span><!--]-->About<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/99-about/02-Thanks.html" aria-label="Thank you"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-heart" style=""></span><!--]-->Thank you<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/timeline/" aria-label="Recently"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-clock-rotate-left" style=""></span><!--]-->Recently<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/docmoa/docs" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="ê²€ìƒ‰"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">ê²€ìƒ‰</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/" aria-label="HashiCorp"><!---->HashiCorp<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">01 Packer</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">02 Vagrant</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">03 Terraform</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">04 Consul</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">01 Information</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">02 Configuration</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">03 Use Case</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/04-HashiCorp/04-Consul/03-UseCase/Consul%20Health%20Check.html" aria-label="Consul Health Check on VMs"><!---->Consul Health Check on VMs<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/04-HashiCorp/04-Consul/03-UseCase/Consul%20Enterprise%20Feature.html" aria-label="Consul Mesh Gateway - K8S x BMs/VMs"><!---->Consul Mesh Gateway - K8S x BMs/VMs<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">04 Trouble Shooting</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">05 Template Sample</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">06 on Kubernetes</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">05 Boundary</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">06 Vault</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">07 Nomad</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">08 Updates</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Consul Mesh Gateway - K8S x BMs/VMs</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="ì‘ì„±ì¼ğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2021-08-10T00:40:07.000Z"></span><!----><span class="page-reading-time-info" aria-label="ì½ëŠ” ì‹œê°„âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>ì•½ 40 ë¶„</span><meta property="timeRequired" content="PT40M"></span><!----><span class="page-tag-info" aria-label="íƒœê·¸ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color3 clickable" role="navigation">Consul</span><span class="page-tag-item color4 clickable" role="navigation">Hybrid</span><span class="page-tag-item color2 clickable" role="navigation">Kubetenetes</span><span class="page-tag-item color5 clickable" role="navigation">k8s</span><span class="page-tag-item color7 clickable" role="navigation">VM</span><!--]--><meta property="keywords" content="Consul,Hybrid,Kubetenetes,k8s,VM"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">ì´ í˜ì´ì§€ì—ì„œ<button type="button" class="print-button" title="ì¸ì‡„"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-á„€á…¢á„‹á…­">1. ê°œìš”</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-1-á„‹á…¡á„á…µá„á…¦á†¨á„á…¥">1.1 ì•„í‚¤í…ì²˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-2-port-á„€á…®á„‰á…¥á†¼-á„á…¡á†·á„€á…©">1.2 Port êµ¬ì„± ì°¸ê³ </a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-kubernetesá„‰á…¡á†¼á„‹á…¦-consulá„‰á…¥á†¯á„á…µ">2. Kubernetesìƒì— Consulì„¤ì¹˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-1-á„‰á…¡á„Œá…¥á†«-á„Œá…®á†«á„‡á…µ-á„‰á…¡á„’á…¡á†¼">2.1 ì‚¬ì „ ì¤€ë¹„ ì‚¬í•­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-2-á„‰á…¥á†¯á„á…µ">2.2 ì„¤ì¹˜</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-vm-bmá„‰á…¡á†¼á„‹á…¦-consulá„‰á…¥á†¯á„á…µ">3. VM/BMìƒì— Consulì„¤ì¹˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1-á„‰á…¡á„Œá…¥á†«-á„Œá…®á†«á„‡á…µ-á„‰á…¡á„’á…¡á†¼">3.1 ì‚¬ì „ ì¤€ë¹„ ì‚¬í•­</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2-consul-á„‡á…¡á„‹á…µá„‚á…¥á„…á…µ-á„ƒá…¡á„‹á…®á†«á„…á…©á„ƒá…³á„‹á…ª-path-á„‰á…¥á†¯á„Œá…¥á†¼">3.2 Consul ë°”ì´ë„ˆë¦¬ ë‹¤ìš´ë¡œë“œì™€ PATH ì„¤ì •</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3-primary-k8s-á„’á…ªá†«á„€á…§á†¼á„‹á…¦á„‰á…¥-á„‹á…µá†«á„Œá…³á†¼á„‰á…¥-á„€á…¡á„Œá…§á„‹á…©á„€á…µ">3.3 Primary(k8s) í™˜ê²½ì—ì„œ ì¸ì¦ì„œ ê°€ì ¸ì˜¤ê¸°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-4-consul-á„€á…®á„‰á…¥á†¼-á„‘á…¡á„‹á…µá†¯-á„Œá…¡á†¨á„‰á…¥á†¼">3.4 Consul êµ¬ì„± íŒŒì¼ ì‘ì„±</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-bm-vm-á„’á…ªá†«á„€á…§á†¼á„‹á…´-mesh-gateway-á„€á…®á„‰á…¥á†¼">4. BM/VM í™˜ê²½ì˜ Mesh Gateway êµ¬ì„±</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-1-envoy-á„‰á…¥á†¯á„á…µ">4.1 Envoy ì„¤ì¹˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2-mesh-gateway-á„‰á…µá†¯á„’á…¢á†¼">4.2 Mesh Gateway ì‹¤í–‰</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-test-option">5 TEST (Option)</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="consul-mesh-gateway-k8s-x-bms-vms" tabindex="-1"><a class="header-anchor" href="#consul-mesh-gateway-k8s-x-bms-vms"><span>Consul Mesh Gateway - K8S x BMs/VMs</span></a></h1><blockquote><p>ì´ ë¬¸ì„œì—ì„œëŠ” Consulì„ ì‚¬ìš©í•˜ì—¬ ìƒì´í•œ ë‘ Consulë¡œ êµ¬ì„±ëœ í´ëŸ¬ìŠ¤í„°(ë§ˆìŠ¤í„°ê°€ ë³„ê°œ)ì˜ ì„œë¹„ìŠ¤ë¥¼ ì—°ê³„í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.</p></blockquote><h2 id="_1-á„€á…¢á„‹á…­" tabindex="-1"><a class="header-anchor" href="#_1-á„€á…¢á„‹á…­"><span>1. ê°œìš”</span></a></h2><h3 id="_1-1-á„‹á…¡á„á…µá„á…¦á†¨á„á…¥" tabindex="-1"><a class="header-anchor" href="#_1-1-á„‹á…¡á„á…µá„á…¦á†¨á„á…¥"><span>1.1 ì•„í‚¤í…ì²˜</span></a></h3><p>ë„¤íŠ¸ì›Œí¬ ì˜ì—­ì´ ë¶„ë¦¬ë˜ì–´ìˆëŠ” ë‘ í™˜ê²½ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ë“¤ì„ Service Meshë¡œ êµ¬ì„±í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ ë´…ë‹ˆë‹¤. ì´ë²ˆ êµ¬ì„± ì˜ˆì—ì„œëŠ” Kubernetesì™€ Baremetal(BM)ì´ë‚˜ VirtualMachine(VM)ì— Consul Cluster(Datacenter)ë¥¼ êµ¬ì„±í•˜ê³  ê° í™˜ê²½ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ë¥¼ Mesh Gatewayë¡œ ì—°ê³„í•©ë‹ˆë‹¤.</p><p>Mesh Gatewayë¥¼ ì‚¬ìš©í•˜ë©´ ì„œë¡œë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„°ê°„ì— mTLS í™˜ê²½ì˜ í†µì‹ ê³¼ ì„œë¹„ìŠ¤ ê°„ì˜ íŠ¸ë˜í”½ í†µë¡œë¥¼ ë‹¨ì¼í™” í•˜ì—¬ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ mTLSë‚´ì˜ ë°ì´í„°ê°€ Gatewayì—ì„œ í•´ë™ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë‘ í´ëŸ¬ìŠ¤í„°ê°„ ì•ˆì „í•˜ê²Œ ë°ì´í„°ë¥¼ ì†¡ìˆ˜ì‹  í•©ë‹ˆë‹¤.</p><p>Consulì˜ ê° ClusterëŠ” Datacenterë¼ëŠ” ëª…ì¹­ìœ¼ë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤. <strong>ì´ë²ˆ êµ¬ì„±ì—ì„œëŠ” Kubernetesì˜ Consul Datacenterê°€ Primaryì˜ ì—­í• ì„ í•©ë‹ˆë‹¤.</strong></p><figure><img src="https://raw.githubusercontent.com/Great-Stone/images/master/uPic/HashiCorp General Presentation Template (KR) - Apr 2020 - Google Slides 2020-11-12 15-58-54.png" alt="HashiCorp General Presentation Template (KR) - Apr 2020 - Google Slides 2020-11-12 15-58-54" tabindex="0" loading="lazy"><figcaption>HashiCorp General Presentation Template (KR) - Apr 2020 - Google Slides 2020-11-12 15-58-54</figcaption></figure><ul><li>ê° Applicationì„ ìœ„í•œ Sidecarë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.</li><li>Mesh Gatewayë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” ëª¨ë“  SidecarsëŠ” Envoy ë¡œ êµ¬ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</li><li>Mesh Gatewayë¥¼ êµ¬ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” Sidecarì™€ Consulì´ TLSë¡œ í†µì‹ í•´ì•¼ í•©ë‹ˆë‹¤.</li></ul><h3 id="_1-2-port-á„€á…®á„‰á…¥á†¼-á„á…¡á†·á„€á…©" tabindex="-1"><a class="header-anchor" href="#_1-2-port-á„€á…®á„‰á…¥á†¼-á„á…¡á†·á„€á…©"><span>1.2 Port êµ¬ì„± ì°¸ê³ </span></a></h3><blockquote><p>Port êµ¬ì„±ì— ëŒ€í•œ ë¬¸ì„œëŠ” ë‹¤ìŒì„ ì°¸ê³ í•©ë‹ˆë‹¤.<br><a href="https://www.consul.io/docs/install/ports" target="_blank" rel="noopener noreferrer">https://www.consul.io/docs/install/ports</a></p></blockquote><table><thead><tr><th style="text-align:left;">Use</th><th style="text-align:left;">Default Ports</th><th>CLI</th></tr></thead><tbody><tr><td style="text-align:left;">DNS: The DNS server (TCP and UDP)</td><td style="text-align:left;">8600</td><td>-dns-port</td></tr><tr><td style="text-align:left;">HTTP: The HTTP API (TCP Only)</td><td style="text-align:left;">8500</td><td>-http-port</td></tr><tr><td style="text-align:left;">HTTPS: The HTTPs API</td><td style="text-align:left;">disabled (8501)*</td><td>-https-port</td></tr><tr><td style="text-align:left;">gRPC: The gRPC API</td><td style="text-align:left;">disabled (8502)*</td><td>-grpc-port</td></tr><tr><td style="text-align:left;">LAN Serf: The Serf LAN port (TCP and UDP)</td><td style="text-align:left;">8301</td><td>-serf-lan-port</td></tr><tr><td style="text-align:left;">Wan Serf: The Serf WAN port (TCP and UDP)</td><td style="text-align:left;">8302</td><td>-sert-wan-port</td></tr><tr><td style="text-align:left;">server: Server RPC address (TCP Only)</td><td style="text-align:left;">8300</td><td>-server-port</td></tr><tr><td style="text-align:left;">Sidecar Proxy Min: Sidecar ì„œë¹„ìŠ¤ ë“±ë¡ì— ì‚¬ìš©ë˜ëŠ” ë²”ìœ„ì˜ ìµœì†Œ í¬íŠ¸</td><td style="text-align:left;">21000</td><td><code>Configration file</code></td></tr><tr><td style="text-align:left;">Sidecar Proxy Max: Sidecar ì„œë¹„ìŠ¤ ë“±ë¡ì— ì‚¬ìš©ë˜ëŠ” ë²”ìœ„ì˜ ìµœëŒ€ í¬íŠ¸</td><td style="text-align:left;">21255</td><td><code>Configration file</code></td></tr></tbody></table><p>Federationì„ ìœ„í•œ í¬íŠ¸ë¡œëŠ”</p><ul><li>Consul Server &amp; Agent <ul><li>8301 : Gassip í”„ë¡œí† ì½œë¡œ ì„œë¡œê°„ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤.</li></ul></li><li>Consul Server <ul><li>8500 : Serverì˜ APIí†µì‹ ì„ ìœ„í•œ í¬íŠ¸ì…ë‹ˆë‹¤.</li><li>8501 : Mesh Gatewayì™€ TLSë¡œ í†µì‹ í•©ë‹ˆë‹¤.</li><li>8300 : Agentê°€ ì„œë²„ì™€ì˜ RPCí†µì‹ ì„ í•©ë‹ˆë‹¤.</li><li>8600 : Consul DNSë¥¼ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.</li></ul></li><li>Consul Agent <ul><li>21000~21255 : Sidecar ì„œë¹„ìŠ¤ê°€ í• ë‹¹ë°›ëŠ” í¬íŠ¸ ë²”ìœ„ ì…ë‹ˆë‹¤.</li></ul></li></ul><p>ê° <a href="https://www.consul.io/docs/agent/options#ports" target="_blank" rel="noopener noreferrer">í¬íŠ¸ êµ¬ì„±ì„¤ì • ê°€ì´ë“œ</a>ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb" data-title="rb"><pre class="language-ruby"><code><span class="line">ports <span class="token punctuation">{</span></span>
<span class="line">  dns <span class="token operator">=</span> <span class="token number">8600</span></span>
<span class="line">  http <span class="token operator">=</span> <span class="token number">8500</span></span>
<span class="line">  https <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></span>
<span class="line">  grpc <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></span>
<span class="line">  serf_lan <span class="token operator">=</span> <span class="token number">8301</span></span>
<span class="line">  serf_wan <span class="token operator">=</span> <span class="token number">8302</span></span>
<span class="line">  server <span class="token operator">=</span> <span class="token number">8300</span></span>
<span class="line">  sidecar_min_port <span class="token operator">=</span> <span class="token number">21000</span></span>
<span class="line">  sidecar_max_port <span class="token operator">=</span> <span class="token number">21255</span></span>
<span class="line">  expose_min_port <span class="token operator">=</span> <span class="token number">21500</span></span>
<span class="line">  expose_max_port <span class="token operator">=</span> <span class="token number">21755</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-kubernetesá„‰á…¡á†¼á„‹á…¦-consulá„‰á…¥á†¯á„á…µ" tabindex="-1"><a class="header-anchor" href="#_2-kubernetesá„‰á…¡á†¼á„‹á…¦-consulá„‰á…¥á†¯á„á…µ"><span>2. Kubernetesìƒì— Consulì„¤ì¹˜</span></a></h2><h3 id="_2-1-á„‰á…¡á„Œá…¥á†«-á„Œá…®á†«á„‡á…µ-á„‰á…¡á„’á…¡á†¼" tabindex="-1"><a class="header-anchor" href="#_2-1-á„‰á…¡á„Œá…¥á†«-á„Œá…®á†«á„‡á…µ-á„‰á…¡á„’á…¡á†¼"><span>2.1 ì‚¬ì „ ì¤€ë¹„ ì‚¬í•­</span></a></h3><ul><li>Kubernetesê°€ ì„¤ì¹˜ë˜ì–´ìˆì–´ì•¼ í•˜ë©°, ì‘ì—…ì„ ìˆ˜í–‰í•  í™˜ê²½ì—ì„œ ì ‘ì† ê°€ëŠ¥í•œ ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤.</li><li>Helm3 í˜¹ì€ Helm2ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. <ul><li>Installing Helm : <a href="https://helm.sh/docs/intro/install" target="_blank" rel="noopener noreferrer">https://helm.sh/docs/intro/install</a></li></ul></li></ul><h3 id="_2-2-á„‰á…¥á†¯á„á…µ" tabindex="-1"><a class="header-anchor" href="#_2-2-á„‰á…¥á†¯á„á…µ"><span>2.2 ì„¤ì¹˜</span></a></h3><p>Kubernetesì—ì„œ Consulì„ ì‹¤í–‰í•˜ëŠ” ê¶Œì¥ ë°©ë²•ì€ <a href="https://www.consul.io/docs/k8s/helm" target="_blank" rel="noopener noreferrer">Helm ì°¨íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ</a> ì…ë‹ˆë‹¤. Consulì„ ì‹¤í–‰í•˜ëŠ” ë° í•„ìš”í•œ ëª¨ë“  êµ¬ì„± ìš”ì†Œë¥¼ ì„¤ì¹˜í•˜ê³  êµ¬ì„±í•©ë‹ˆë‹¤. Helm 2ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° <a href="https://v2.helm.sh/docs/using_helm/#quickstart-guide" target="_blank" rel="noopener noreferrer">Helm 2 ì„¤ì¹˜ ê°€ì´ë“œ</a> ì— ë”°ë¼ Tillerë¥¼ ì„¤ì¹˜í•´ì•¼í•©ë‹ˆë‹¤.</p><h4 id="_2-2-1-helm-repository-á„á…®á„€á…¡" tabindex="-1"><a class="header-anchor" href="#_2-2-1-helm-repository-á„á…®á„€á…¡"><span>2.2.1 helm Repository ì¶”ê°€</span></a></h4><p>HashiCorp helm Repositoryë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ helm repo <span class="token function">add</span> hashicorp https://helm.releases.hashicorp.com</span>
<span class="line"><span class="token string">&quot;hashicorp&quot;</span> has been added to your repositories</span>
<span class="line"></span></code></pre></div><p>Consul ì°¨íŠ¸ì— ì ‘ê·¼ê°€ëŠ¥í•œì§€ í™•ì¸í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ helm search repo hashicorp/consul</span>
<span class="line">NAME                CHART VERSION   APP VERSION DESCRIPTION</span>
<span class="line">hashicorp/consul    <span class="token number">0.32</span>.1          <span class="token number">1.10</span>.0       Official HashiCorp Consul Chart</span>
<span class="line"></span></code></pre></div><details class="hint-container details"><summary>CHART LIST</summary><p>Consul ì°¨íŠ¸ë§ˆë‹¤ì˜ ê¸°ë³¸ ë§¤ì¹­ë˜ëŠ” ë²„ì „ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë¦¬ìŠ¤íŠ¸ë¡œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ helm search repo hashicorp/consul <span class="token parameter variable">-l</span></span>
<span class="line">NAME            	CHART VERSION	APP VERSION	DESCRIPTION</span>
<span class="line">hashicorp/consul	<span class="token number">0.32</span>.1       	<span class="token number">1.10</span>.0     	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.32</span>.0       	<span class="token number">1.10</span>.0     	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.31</span>.1       	<span class="token number">1.9</span>.4      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.31</span>.0       	<span class="token number">1.9</span>.4      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.30</span>.0       	<span class="token number">1.9</span>.3      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.29</span>.0       	<span class="token number">1.9</span>.2      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.28</span>.0       	<span class="token number">1.9</span>.1      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.27</span>.0       	<span class="token number">1.9</span>.0      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.26</span>.0       	<span class="token number">1.8</span>.5      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.25</span>.0       	<span class="token number">1.8</span>.4      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.24</span>.1       	<span class="token number">1.8</span>.2      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.24</span>.0       	<span class="token number">1.8</span>.1      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.23</span>.1       	<span class="token number">1.8</span>.0      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.23</span>.0       	<span class="token number">1.8</span>.0      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.22</span>.0       	<span class="token number">1.8</span>.0      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.21</span>.0       	<span class="token number">1.7</span>.3      	Official HashiCorp Consul Chart</span>
<span class="line">hashicorp/consul	<span class="token number">0.20</span>.1       	<span class="token number">1.7</span>.2      	Official HashiCorp Consul Chart</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h4 id="_2-2-2-gossip-á„‘á…³á„á…©á„á…©á„á…©á†¯á„‹á…³á†¯-á„‹á…±á„’á…¡á†«-kubernetes-secret-á„‰á…¢á†¼á„‰á…¥á†¼" tabindex="-1"><a class="header-anchor" href="#_2-2-2-gossip-á„‘á…³á„á…©á„á…©á„á…©á†¯á„‹á…³á†¯-á„‹á…±á„’á…¡á†«-kubernetes-secret-á„‰á…¢á†¼á„‰á…¥á†¼"><span>2.2.2 Gossip í”„í† í† ì½œì„ ìœ„í•œ Kubernetes Secret ìƒì„±</span></a></h4><p>Kubernetesìƒì—ì„œ Consul Datacenterì˜ Gossip í”„ë¡œí† ì½œì—ì„œ ì‚¬ìš©í•  í‚¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ë¯¸ë¦¬ ìƒì„±í•˜ì—¬ ê°’ì„ ë„£ì–´ë„ ë˜ê³ , ìƒì„±ì‹œ ê°’ì´ ìƒì„±ë˜ë„ë¡ í•˜ì—¬ë„ ê´€ê³„ ì—†ìŠµë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ kubectl create secret generic consul-gossip-encryption-key --from-literal<span class="token operator">=</span>key<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>consul keygen<span class="token variable">)</span></span></span>
<span class="line"></span>
<span class="line">--- or ---</span>
<span class="line"></span>
<span class="line">$ consul keygen</span>
<span class="line">h65lqS3w4x42KP+n4Hn9RtK84Rx7zP3WSahZSyD5i1o<span class="token operator">=</span></span>
<span class="line">$ kubectl create secret generic consul-gossip-encryption-key --from-literal<span class="token operator">=</span>key<span class="token operator">=</span>h65lqS3w4x42KP+n4Hn9RtK84Rx7zP3WSahZSyD5i1o<span class="token operator">=</span></span>
<span class="line"></span></code></pre></div><h4 id="_2-2-3-á„‰á…¥á†¯á„á…µá„…á…³á†¯-á„‹á…±á„’á…¡á†«-á„‰á…¡á„‹á…­á†¼á„Œá…¡-á„Œá…µá„Œá…¥á†¼-yaml-á„Œá…¡á†¨á„‰á…¥á†¼" tabindex="-1"><a class="header-anchor" href="#_2-2-3-á„‰á…¥á†¯á„á…µá„…á…³á†¯-á„‹á…±á„’á…¡á†«-á„‰á…¡á„‹á…­á†¼á„Œá…¡-á„Œá…µá„Œá…¥á†¼-yaml-á„Œá…¡á†¨á„‰á…¥á†¼"><span>2.2.3 ì„¤ì¹˜ë¥¼ ìœ„í•œ ì‚¬ìš©ì ì§€ì • <code>yaml</code> ì‘ì„±</span></a></h4><p>Helm ì°¨íŠ¸ë¡œ ì„¤ì¹˜í•  ë•Œ ê¸°ë³¸ ì„¤ì •ì„ ì—ì–´ì“°ëŠ” íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì›í•˜ëŠ” êµ¬ì„±ìœ¼ë¡œ ì„¤ì¹˜ë˜ë„ë¡ ì¤€ë¹„í•©ë‹ˆë‹¤. ê° êµ¬ì„±ì— ëŒ€í•œ ì„¤ì •ì€ <a href="https://www.consul.io/docs/k8s/helm" target="_blank" rel="noopener noreferrer">Helm Chart Configuration</a> ë¥¼ ì°¸ê³ í•©ë‹ˆë‹¤.</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="line"><span class="token comment"># consul.yaml</span></span>
<span class="line"><span class="token key atrule">global</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> consul</span>
<span class="line">  <span class="token comment"># ê¸°ë³¸ì´ë¯¸ì§€(OSS ìµœì‹  ë²„ì „)ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ë²„ì „ì˜ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë˜ëŠ” ë³„ë„ì˜ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ëª…ì‹œí•©ë‹ˆë‹¤.</span></span>
<span class="line">  <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&#39;hashicorp/consul-enterprise:1.8.5-ent&#39;</span></span>
<span class="line">  <span class="token key atrule">datacenter</span><span class="token punctuation">:</span> <span class="token string">&#39;tsis-k8s&#39;</span></span>
<span class="line">  <span class="token key atrule">tls</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># Federation êµ¬ì„±ì„ ìœ„í•´ì„œëŠ” TLSê°€ ë°˜ë“œì‹œ í™œì„±í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</span></span>
<span class="line">    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">verify</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line">    <span class="token key atrule">httpsOnly</span><span class="token punctuation">:</span> <span class="token boolean important">false</span></span>
<span class="line"></span>
<span class="line">  <span class="token key atrule">federation</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token comment"># Kubernetesê°€ Primary Datacenterì´ê¸° ë•Œë¬¸ì— ì´ í™˜ê²½ì—ì„œ Federationì„ ìœ„í•œ ì‹œí¬ë¦¿ì„ ìƒì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.</span></span>
<span class="line">    <span class="token comment"># https://www.consul.io/docs/k8s/installation/multi-cluster/kubernetes#primary-datacenter</span></span>
<span class="line">    <span class="token key atrule">createFederationSecret</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">gossipEncryption</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># gossipí”„ë¡œí† ì½œì€ ì•”í˜¸í™”ë˜ì–´ì•¼ í•˜ë©°, í•´ë‹¹ í‚¤ëŠ” ë¯¸ë¦¬ Kubernetesì— Secretìœ¼ë¡œ êµ¬ì„±í•©ë‹ˆë‹¤.</span></span>
<span class="line">    <span class="token key atrule">secretName</span><span class="token punctuation">:</span> consul<span class="token punctuation">-</span>gossip<span class="token punctuation">-</span>encryption<span class="token punctuation">-</span>key</span>
<span class="line">    <span class="token key atrule">secretKey</span><span class="token punctuation">:</span> key</span>
<span class="line">  <span class="token key atrule">enableConsulNamespaces</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"><span class="token key atrule">server</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enterpriseLicense</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">secretName</span><span class="token punctuation">:</span> consul<span class="token punctuation">-</span>enterprise<span class="token punctuation">-</span>license<span class="token punctuation">-</span>key</span>
<span class="line">    <span class="token key atrule">secretKey</span><span class="token punctuation">:</span> key</span>
<span class="line"><span class="token key atrule">connectInject</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">centralConfig</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"><span class="token key atrule">ui</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">service</span><span class="token punctuation">:</span></span>
<span class="line">	  <span class="token comment"># UIì— ì ‘ì†ì„ ìœ„í•œ íƒ€ì…ì„ ì •ì˜í•©ë‹ˆë‹¤.</span></span>
<span class="line">	  <span class="token comment"># ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ LoadBalancerê¸°ë³¸ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ë…¸ì¶œë˜ì§€ ì•Šìœ¼ë¯€ë¡œ kubectl port-forwardë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜</span></span>
<span class="line">    <span class="token comment"># NodePortë¡œ UIì— ì ‘ì†í•˜ëŠ” ë° ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.</span></span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort</span>
<span class="line"><span class="token key atrule">dns</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line"><span class="token key atrule">meshGateway</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token comment"># ë©”ì‹œ ê²Œì´íŠ¸ì›¨ì´ëŠ” ë°ì´í„° ì„¼í„° ê°„ì˜ ê²Œì´íŠ¸ì›¨ì´ì…ë‹ˆë‹¤.</span></span>
<span class="line">  <span class="token comment"># ë°ì´í„° ì„¼í„° ê°„ì˜ í†µì‹ ì´ ë©”ì‹œ ê²Œì´íŠ¸ì›¨ì´ë¥¼ í†µê³¼í•˜ë¯€ë¡œ Kubernetesì—ì„œ í˜ë”ë ˆì´ì…˜ì„ ìœ„í•´ í™œì„±í™”ë˜ì–´ì•¼í•©ë‹ˆë‹¤.</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">service</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort</span>
<span class="line">    <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">31001</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Ingress GatewayëŠ” Kubernetsë¡œ ìš”ì²­ë˜ëŠ” ì£¼ìš” ê´€ë¬¸ì„ Consulì—ì„œ ì„¤ì •í•˜ê³  Service Meshê¸°ëŠ¥ì„ í™œì„±í™” í•©ë‹ˆë‹¤.</span></span>
<span class="line"><span class="token comment"># ì´ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œëŠ” í•„ìˆ˜ ì„¤ì •ì´ ì•„ë‹™ë‹ˆë‹¤.</span></span>
<span class="line"><span class="token key atrule">ingressGateways</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">  <span class="token key atrule">gateways</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>gateway</span>
<span class="line">      <span class="token key atrule">service</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort</span>
<span class="line">        <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">          <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">31000</span></span>
<span class="line">            <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">31000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-4-consul-helm-chart-á„‰á…µá†¯á„’á…¢á†¼" tabindex="-1"><a class="header-anchor" href="#_2-2-4-consul-helm-chart-á„‰á…µá†¯á„’á…¢á†¼"><span>2.2.4 Consul Helm Chart ì‹¤í–‰</span></a></h4><p>Helm3ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì êµ¬ì„±ìœ¼ë¡œ Consulì„ ì„¤ì¹˜í•˜ë ¤ë©´ ë‹¤ìŒì„ ì‹¤í–‰í•©ë‹ˆë‹¤. (ì‚¬ìš©ì êµ¬ì„± íŒŒì¼ : <code>consul.yaml</code>)</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ helm <span class="token function">install</span> consul hashicorp/consul <span class="token parameter variable">-f</span> consul.yaml <span class="token parameter variable">--debug</span></span>
<span class="line"></span></code></pre></div><p>ì„¤ì¹˜ê°€ ì™„ë£Œë˜ê³  ì–¼ë§ˆì•ˆìˆì–´ Podë¥¼ í™•ì¸í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ kubectl get pods</span>
<span class="line">consul-consul-mesh-gateway-754fbc5575-d8dgt                       <span class="token number">2</span>/2     Running   <span class="token number">0</span>          2m</span>
<span class="line">consul-consul-mesh-gateway-754fbc5575-wkvjh                       <span class="token number">2</span>/2     Running   <span class="token number">0</span>          2m</span>
<span class="line">consul-consul-mh5h6                                               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m</span>
<span class="line">consul-consul-mx4mn                                               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m</span>
<span class="line">consul-consul-rlb5x                                               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m</span>
<span class="line">consul-consul-server-0                                            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m</span>
<span class="line">consul-consul-server-1                                            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m</span>
<span class="line">consul-consul-server-2                                            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m</span>
<span class="line">consul-consul-tbngg                                               <span class="token number">1</span>/1     Running   <span class="token number">1</span>          2m</span>
<span class="line">consul-consul-tz9ct                                               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>consul-server: 3ì¤‘í™”ë˜ì–´ êµ¬ì„±ë©ë‹ˆë‹¤.</li><li>consul: Consul Clientê°€ DaemonSet í˜•íƒœë¡œ ëª¨ë“  ë…¸ë“œì— êµ¬ì„±ë©ë‹ˆë‹¤.</li><li>consul-mesh-gateway: ê¸°ë³¸ 2ì¤‘í™” ì„¤ì •ìœ¼ë¡œ, 2ê°œ êµ¬ì„±ë©ë‹ˆë‹¤.</li></ul><h4 id="_2-2-5-á„‰á…¥á†¯á„á…µ-á„’á…®-á„á…®á„€á…¡-á„€á…¡á„‹á…µá„ƒá…³-option" tabindex="-1"><a class="header-anchor" href="#_2-2-5-á„‰á…¥á†¯á„á…µ-á„’á…®-á„á…®á„€á…¡-á„€á…¡á„‹á…µá„ƒá…³-option"><span>2.2.5 ì„¤ì¹˜ í›„ ì¶”ê°€ ê°€ì´ë“œ(Option)</span></a></h4><ul><li><p>port-forward<br> Consul UIì— ì ‘í˜¹í•˜ê¸° ìœ„í•´ <code>port-forward</code> ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ì—¬ ì ‘ê·¼ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token comment"># HTTP</span></span>
<span class="line">$ kubectl port-forward service/consul-server <span class="token number">8500</span>:8500</span>
<span class="line"></span>
<span class="line"><span class="token comment"># HTTPS (TLS)</span></span>
<span class="line">$ kubectl port-forward service/consul-server <span class="token number">8501</span>:8501</span>
<span class="line"></span></code></pre></div></li><li><p>ACL<br> ACLì´ í™œì„±í™”ëœ ê²½ìš° ACLí† í°ì´ í•„ìš”í•©ë‹ˆë‹¤. ì „ì²´ ê¶Œí•œì´ ìˆëŠ” bootstrapí† í°ì€ ë‹¤ìŒê³¼ ê°™ì´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ê°’ì˜ ë§ˆì§€ë§‰ <code>%</code> ëŠ” ì œì™¸)</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ kubectl get secrets/consul-bootstrap-acl-token <span class="token parameter variable">--template</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>.data.token<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-D</span></span>
<span class="line">e7924dd1-dc3f-f644-da54-81a73ba0a178%</span>
<span class="line"></span></code></pre></div></li></ul><h4 id="_2-2-6-á„á…¦á„‰á…³á„á…³á„…á…³á†¯-á„‹á…±á„’á…¡á†«-pod-á„‰á…¢á†¼á„‰á…¥á†¼-option" tabindex="-1"><a class="header-anchor" href="#_2-2-6-á„á…¦á„‰á…³á„á…³á„…á…³á†¯-á„‹á…±á„’á…¡á†«-pod-á„‰á…¢á†¼á„‰á…¥á†¼-option"><span>2.2.6 í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ Pod ìƒì„±(Option)</span></a></h4><p>Kubertnetesìƒì—ì„œ Mesh Gatewayë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì„¤ì •ì„ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ Podë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p><details class="hint-container details"><summary>APP SAMPLE</summary><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="line"><span class="token comment"># k8s-consul-app.yaml</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> counting</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> counting</span>
<span class="line">  <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">&#39;consul.hashicorp.com/service-tags&#39;</span><span class="token punctuation">:</span> servicemesh<span class="token punctuation">,</span> consul<span class="token punctuation">,</span> counting<span class="token punctuation">,</span> v1</span>
<span class="line">    <span class="token key atrule">&#39;consul.hashicorp.com/connect-inject&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;true&#39;</span></span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> counting</span>
<span class="line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> hashicorp/counting<span class="token punctuation">-</span>service<span class="token punctuation">:</span>0.0.2</span>
<span class="line">      <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9001</span></span>
<span class="line">          <span class="token key atrule">name</span><span class="token punctuation">:</span> http</span>
<span class="line">  <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> counting</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> dashboard</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> dashboard</span>
<span class="line">  <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token string">&#39;dashboard&#39;</span></span>
<span class="line">  <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">&#39;consul.hashicorp.com/service-tags&#39;</span><span class="token punctuation">:</span> servicemesh<span class="token punctuation">,</span> consul<span class="token punctuation">,</span> dashiboard<span class="token punctuation">,</span> v1</span>
<span class="line">    <span class="token key atrule">&#39;consul.hashicorp.com/connect-inject&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;true&#39;</span></span>
<span class="line">    <span class="token key atrule">&#39;consul.hashicorp.com/connect-service-upstreams&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;counting:9001&#39;</span></span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dashboard</span>
<span class="line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> hashicorp/dashboard<span class="token punctuation">-</span>service<span class="token punctuation">:</span>0.0.4</span>
<span class="line">      <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9002</span></span>
<span class="line">          <span class="token key atrule">name</span><span class="token punctuation">:</span> http</span>
<span class="line">      <span class="token key atrule">env</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> COUNTING_SERVICE_URL</span>
<span class="line">          <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&#39;http://localhost:9001&#39;</span></span>
<span class="line">  <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> dashboard</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> <span class="token string">&#39;v1&#39;</span></span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> <span class="token string">&#39;Service&#39;</span></span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#39;dashboard-service-nodeport&#39;</span></span>
<span class="line">  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> <span class="token string">&#39;default&#39;</span></span>
<span class="line">  <span class="token key atrule">labels</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token string">&#39;dashboard&#39;</span></span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">protocol</span><span class="token punctuation">:</span> <span class="token string">&#39;TCP&#39;</span></span>
<span class="line">      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span></span>
<span class="line">      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">9002</span></span>
<span class="line">  <span class="token key atrule">selector</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token string">&#39;dashboard&#39;</span></span>
<span class="line">  <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">&#39;NodePort&#39;</span></span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> dns</span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dns</span>
<span class="line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> anubhavmishra/tiny<span class="token punctuation">-</span>tools</span>
<span class="line">      <span class="token key atrule">command</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> sleep</span>
<span class="line">        <span class="token punctuation">-</span> infinity</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>&#39;consul.hashicorp.com/connect-inject&#39;: &#39;true&#39;</code> í•´ë‹¹ annotationsê°€ ì„ ì–¸ë˜ë©´ consul apië¥¼ í†µí•´ í•´ë‹¹ Podê°€ ë°°í¬ë  ë•Œ Sidecarê°€ í•¨ê»˜ ìƒì„±ë©ë‹ˆë‹¤.</li><li><code>&#39;consul.hashicorp.com/connect-service-upstreams&#39;: &#39;counting:9001&#39;</code> ì„¤ì •ì€ sideê°€ì— 9001í¬íŠ¸ë¡œ ìš”ì²­ì´ ì˜¤ë©´ <code>counting</code> ìœ¼ë¡œ ì •ì˜ëœ ì„œë¹„ìŠ¤ë¡œ í•´ë‹¹ ìš”ì²­ì„ ì „ë‹¬í•©ë‹ˆë‹¤.</li><li>Consul ë‚´ë¶€ì—ì„œì˜ Service Meshê¸°ëŠ¥ì€ Consulì˜ Service Discovery ê¸°ëŠ¥ì— ë”°ë¼, Sidecarë“¤ì´ ì„œë¡œë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li>ì˜ˆì œì˜ <code>dashboard</code> ì•±ì€ frontendì•±ìœ¼ë¡œ UIë¥¼ ì œê³µí•˜ë©°, <code>counting</code> ì•±ì€ backendì•±ìœ¼ë¡œ í˜¸ì¶œì‹œ ë‚´ë¶€ì ìœ¼ë¡œ countingì„ ì¶”ê°€í•©ë‹ˆë‹¤.</li><li>dashboardì•±ì€ ë°±ì—”ë“œë¡œ localhostì˜ 9001ì— ìš”ì²­í•©ë‹ˆë‹¤. Pod ë‚´ì˜ containerëŠ” ë™ì¼í•œ ipë¥¼ ê°–ê¸° ë•Œë¬¸ì— <code>upstream</code> ì„¤ì •ìœ¼ë¡œ 9001ì— ëŒ€í•œ ëª©ì ì§€ë¥¼ ì•Œê³  ìˆëŠ” sidecar container proxyê°€ í•´ë‹¹ ìš”ì²­ì„ ì „ë‹¬í•©ë‹ˆë‹¤.</li></ul></details><h2 id="_3-vm-bmá„‰á…¡á†¼á„‹á…¦-consulá„‰á…¥á†¯á„á…µ" tabindex="-1"><a class="header-anchor" href="#_3-vm-bmá„‰á…¡á†¼á„‹á…¦-consulá„‰á…¥á†¯á„á…µ"><span>3. VM/BMìƒì— Consulì„¤ì¹˜</span></a></h2><h3 id="_3-1-á„‰á…¡á„Œá…¥á†«-á„Œá…®á†«á„‡á…µ-á„‰á…¡á„’á…¡á†¼" tabindex="-1"><a class="header-anchor" href="#_3-1-á„‰á…¡á„Œá…¥á†«-á„Œá…®á†«á„‡á…µ-á„‰á…¡á„’á…¡á†¼"><span>3.1 ì‚¬ì „ ì¤€ë¹„ ì‚¬í•­</span></a></h3><ul><li>Consul ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„í•©ë‹ˆë‹¤. <ul><li>Install Consul : <a href="https://www.consul.io/docs/install" target="_blank" rel="noopener noreferrer">https://www.consul.io/docs/install</a></li><li>BMì´ë‚˜ VM í™˜ê²½ì— Consulì„ ì„¤ì¹˜í•˜ëŠ” ë°©ë²•ì€ <a href="https://www.consul.io/docs/install#precompiled-binaries" target="_blank" rel="noopener noreferrer">ë¯¸ë¦¬ ì»´íŒŒì¼ ëœ ë°”ì´ë„ˆë¦¬</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±í•˜ê±°ë‚˜ <a href="https://www.consul.io/docs/install#compiling-from-source" target="_blank" rel="noopener noreferrer">ì†ŒìŠ¤</a>ë¡œë¶€í„° ì»´íŒŒì¼í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë‘ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤. ì‚¬ì „ ì»´íŒŒì¼ ëœ ë°”ì´ë„ˆë¦¬ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ê°€ì¥ ì‰½ìŠµë‹ˆë‹¤. ì´ë²ˆ í™˜ê²½ì—ì„œëŠ” ì»´íŒŒì¼ëœ ë°”ì´ë„ˆë¦¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•©ë‹ˆë‹¤.</li></ul></li></ul><h3 id="_3-2-consul-á„‡á…¡á„‹á…µá„‚á…¥á„…á…µ-á„ƒá…¡á„‹á…®á†«á„…á…©á„ƒá…³á„‹á…ª-path-á„‰á…¥á†¯á„Œá…¥á†¼" tabindex="-1"><a class="header-anchor" href="#_3-2-consul-á„‡á…¡á„‹á…µá„‚á…¥á„…á…µ-á„ƒá…¡á„‹á…®á†«á„…á…©á„ƒá…³á„‹á…ª-path-á„‰á…¥á†¯á„Œá…¥á†¼"><span>3.2 Consul ë°”ì´ë„ˆë¦¬ ë‹¤ìš´ë¡œë“œì™€ PATH ì„¤ì •</span></a></h3><p>ê° í™˜ê²½(Linux/Windows/Mac/FreeBSC/Solaris)ì— ë§ëŠ” ë°”ì´ë„ˆë¦¬ë¥¼ ë°›ê³  ì••ì¶•ì„ í’‰ë‹ˆë‹¤. <code>consul</code> í˜¹ì€ Windowsì˜ ê²½ìš° <code>consul.exe</code>ë¥¼ ì‹œìŠ¤í…œì˜ ì ì ˆí•œ ìœ„ì¹˜ì— ì´ë™ì‹œí‚¤ê³  PATHì— ì¶”ê°€ì‹œí‚¤ë©´ ì–´ëŠê³³ì—ì„œë“  ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h4 id="_3-2-1-linux-á„€á…µá„‡á…¡á†«-á„„á…©á„‚á…³á†«-mac" tabindex="-1"><a class="header-anchor" href="#_3-2-1-linux-á„€á…µá„‡á…¡á†«-á„„á…©á„‚á…³á†«-mac"><span>3.2.1 Linux ê¸°ë°˜ ë˜ëŠ” Mac</span></a></h4><p>ì‰˜ ì„¤ì • íŒŒì¼ì„ í¸ì§‘í•˜ì—¬ PATHì— ì˜êµ¬ì ìœ¼ë¡œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ <code>.</code> + <code>ì‰˜ì´ë¦„</code> + <code>rc</code> ë¡œ êµ¬ì„±ë˜ë©° bashì‰˜ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° <code>~/.bashrc</code> ê°€ í•´ë‹¹ íŒŒì¼ì…ë‹ˆë‹¤. í•´ë‹¹ íŒŒì¼ì—ì„œ <code>export PATH=</code>ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” <code>:(ì½œë¡ )</code>ìœ¼ë¡œ êµ¬ë¶„ëœ ìœ„ì¹˜ì— consul ë°”ì´ë„ˆë¦¬ íŒŒì¼ ìœ„ì¹˜ë¥¼ ë„£ì–´ì£¼ê±°ë‚˜ ì—†ëŠ” ê²½ìš° ê¸°ì¡´ PATHì— ì¶”ê°€ë¡œ ê¸°ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>/tools/consul_dir</code> ë””ë ‰í† ë¦¬ì¸ê²½ìš° ë‹¤ìŒì˜ ì˜ˆì™€ ê°™ìŠµë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token punctuation">..</span>.</span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/tools/consul_dir</span>
<span class="line"></span></code></pre></div><p>root ê¶Œí•œì´ ìˆë‹¤ë©´ ì‹œìŠ¤í…œì˜ ê¸°ë³¸ PATHë¡œ ì§€ì •ë˜ì–´ìˆëŠ” <code>/usr/local/bin</code>ë””ë ‰í† ë¦¬ì— consulì„ ë³µì‚¬í•˜ëŠ” ê²ƒë„ í•˜ë‚˜ì˜ ë°©ë²•ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h4 id="_3-2-2" tabindex="-1"><a class="header-anchor" href="#_3-2-2"><span>3.2.2</span></a></h4><p>Windows</p><p>ì‹œìŠ¤í…œ ì„¤ì •ì—ì„œ GUIë¥¼ í†µí•´ PATHë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. ë§ˆìš°ìŠ¤ í´ë¦­ìœ¼ë¡œ ì§„í–‰í•˜ëŠ” ê²½ìš° <code>Windows ì„¤ì • &gt; ì‹œìŠ¤í…œ &gt; ì •ë³´ &gt; ì‹œìŠ¤í…œ ì •ë³´ &gt; ê³ ê¸‰ ì‹œìŠ¤í…œ ì„¤ì • &gt; ê³ ê¸‰ íƒ­ &gt; í™˜ê²½ ë³€ìˆ˜</code>ì˜ ë‹¨ê³„ë¡œ ì§„í–‰í•©ë‹ˆë‹¤. ì‘ì—…í‘œì‹œì¤„ì˜ ê²€ìƒ‰ì°½ì—ì„œ <code>ê³ ê¸‰ ì‹œìŠ¤í…œ ì„¤ì •</code> ì„ ê²€ìƒ‰í•˜ì—¬ <code>ê³ ê¸‰ íƒ­ &gt; í™˜ê²½ë³€ìˆ˜</code> ë¡œ ì´ë™í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. í™˜ê²½ ë³€ìˆ˜ GUIì—ì„œ <code>USER</code> ë˜ëŠ” <code>ì‹œìŠ¤í…œ ë³€ìˆ˜</code>ì˜ Pathì— Consul ë””ë ‰í† ë¦¬ ê²½ë¡œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p><figure><img src="https://raw.githubusercontent.com/Great-Stone/images/master/uPic/DESKTOP-LenovoMini 2020-11-15 20-36-36.png" alt="DESKTOP-LenovoMini 2020-11-15 20-36-36" tabindex="0" loading="lazy"><figcaption>DESKTOP-LenovoMini 2020-11-15 20-36-36</figcaption></figure><h3 id="_3-3-primary-k8s-á„’á…ªá†«á„€á…§á†¼á„‹á…¦á„‰á…¥-á„‹á…µá†«á„Œá…³á†¼á„‰á…¥-á„€á…¡á„Œá…§á„‹á…©á„€á…µ" tabindex="-1"><a class="header-anchor" href="#_3-3-primary-k8s-á„’á…ªá†«á„€á…§á†¼á„‹á…¦á„‰á…¥-á„‹á…µá†«á„Œá…³á†¼á„‰á…¥-á„€á…¡á„Œá…§á„‹á…©á„€á…µ"><span>3.3 Primary(k8s) í™˜ê²½ì—ì„œ ì¸ì¦ì„œ ê°€ì ¸ì˜¤ê¸°</span></a></h3><blockquote><p>Federation Between VMs and Kubernetes : <a href="https://www.consul.io/docs/k8s/installation/multi-cluster/vms-and-kubernetes" target="_blank" rel="noopener noreferrer">https://www.consul.io/docs/k8s/installation/multi-cluster/vms-and-kubernetes</a></p></blockquote><p>Kubernetesì— êµ¬ì„±ëœ Consul Datacenterê°€ Primaryì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ í™˜ê²½ì—ì„œ TLS ì¸ì¦ì„œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. ì•ì„œ êµ¬ì„±ëœ Kubernetes í™˜ê²½ì—ì„œ CA(Certificate authority cert)ì™€ ì„œëª… í‚¤(Certificate Authority signing key)ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ kubectl get secrets/consul-ca-cert <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--template</span><span class="token operator">=</span><span class="token string">&#39;{{index .data &quot;tls.crt&quot; }}&#39;</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span> <span class="token operator">&gt;</span> consul-agent-ca.pem</span>
<span class="line">$ kubectl get secrets/consul-ca-key <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">--template</span><span class="token operator">=</span><span class="token string">&#39;{{index .data &quot;tls.key&quot; }}&#39;</span> <span class="token operator">|</span> base64 <span class="token parameter variable">-d</span> <span class="token operator">&gt;</span> consul-agent-ca-key.pem</span>
<span class="line"></span></code></pre></div><p>ë‘ íŒŒì¼ì´ ìƒì„±ëœ ìœ„ì¹˜ì—ì„œ <code>consul tls</code>ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì—ì„œ ì‚¬ìš©í•  ì¸ì¦ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ consul tls cert create <span class="token parameter variable">-server</span> <span class="token parameter variable">-dc</span><span class="token operator">=</span>vm-dc</span>
<span class="line"><span class="token operator">==</span><span class="token operator">&gt;</span> Using consul-agent-ca.pem and consul-agent-ca-key.pem</span>
<span class="line"><span class="token operator">==</span><span class="token operator">&gt;</span> Saved vm-dc-server-consul-0.pem</span>
<span class="line"><span class="token operator">==</span><span class="token operator">&gt;</span> Saved vm-dc-server-consul-0-key.pem</span>
<span class="line"></span></code></pre></div><p>ë™ì¼í•œ ìœ„ì¹˜ì—ì„œ Clientë¥¼ ìœ„í•œ ì¸ì¦ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ consul tls cert create <span class="token parameter variable">-client</span> <span class="token parameter variable">-dc</span><span class="token operator">=</span>vm-dc</span>
<span class="line"><span class="token operator">==</span><span class="token operator">&gt;</span> Using consul-agent-ca.pem and consul-agent-ca-key.pem</span>
<span class="line"><span class="token operator">==</span><span class="token operator">&gt;</span> Saved vm-dc-client-consul-0.pem</span>
<span class="line"><span class="token operator">==</span><span class="token operator">&gt;</span> Saved vm-dc-client-consul-0-key.pem</span>
<span class="line"></span></code></pre></div><p>CA íŒŒì¼ê³¼ ìƒˆë¡œ ìƒì„±í•œ íŒŒì¼ì„ Serverì™€ Client ê° í™˜ê²½ì— ë³µì‚¬í•©ë‹ˆë‹¤. (e.g. /home/consul/consul-cert/vm-dc-server-consul-0.pem)</p><p>ì•ì„œ ìƒì„±í•œ íŒŒì¼ ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ ë³µì‚¬ ëŒ€ìƒì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p><ul><li>Server <ul><li>consul-agent-ca.pem</li><li>vm-dc-server-consul-0.pem</li><li>vm-dc-server-consul-0-key.pem</li></ul></li><li>Client <ul><li>consul-agent-ca.pem</li><li>vm-dc-client-consul-0.pem</li><li>vm-dc-client-consul-0-key.pem</li></ul></li></ul><h3 id="_3-4-consul-á„€á…®á„‰á…¥á†¼-á„‘á…¡á„‹á…µá†¯-á„Œá…¡á†¨á„‰á…¥á†¼" tabindex="-1"><a class="header-anchor" href="#_3-4-consul-á„€á…®á„‰á…¥á†¼-á„‘á…¡á„‹á…µá†¯-á„Œá…¡á†¨á„‰á…¥á†¼"><span>3.4 Consul êµ¬ì„± íŒŒì¼ ì‘ì„±</span></a></h3><p>CLIë¥¼ í™œìš©í•˜ì—¬ Consulì„ êµ¬ë™í•  ë•Œ êµ¬ì„± ì˜µì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‚˜ ì—¬ê¸°ì„œëŠ” êµ¬ì„± íŒŒì¼ì„ ì‘ì„±í•˜ì—¬ Consul Serverë‚˜ Consul Clientê°€ ê¸°ë™í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. Serverì™€ Clientì— ëŒ€í•œ ì„¤ì •ì— ì•½ê°„ì˜ ì°¨ì´ê°€ ìˆì„ ë¿ ëŒ€ë¶€ë¶„ì´ ë™ì¼í•©ë‹ˆë‹¤.</p><h4 id="_3-4-1-server" tabindex="-1"><a class="header-anchor" href="#_3-4-1-server"><span>3.4.1 Server</span></a></h4><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb" data-title="rb"><pre class="language-ruby"><code><span class="line">server <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">ui <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">bootstrap_expect <span class="token operator">=</span> <span class="token number">3</span></span>
<span class="line">node_name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;consul_server_01&quot;</span></span></span>
<span class="line">datacenter <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;vm-dc&quot;</span></span></span>
<span class="line">client_addr <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;0.0.0.0&quot;</span></span></span>
<span class="line">bind_addr <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;192.168.100.51&quot;</span></span></span>
<span class="line">encrypt <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;h65lqS3w4x42KP+n4Hn9RtK84Rx7zP3WSahZSyD5i1o=&quot;</span></span></span>
<span class="line">data_dir <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;/var/lib/consul&quot;</span></span></span>
<span class="line">retry_join <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;192.168.100.51&quot;</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">&quot;192.168.100.52&quot;</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">&quot;192.168.100.83&quot;</span></span><span class="token punctuation">]</span></span>
<span class="line">ports <span class="token punctuation">{</span></span>
<span class="line">  https <span class="token operator">=</span> <span class="token number">8501</span></span>
<span class="line">  http <span class="token operator">=</span> <span class="token number">8500</span></span>
<span class="line">  grpc <span class="token operator">=</span> <span class="token number">8502</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">enable_central_service_config <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">connect <span class="token punctuation">{</span></span>
<span class="line">  enabled <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line">  enable_mesh_gateway_wan_federation <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">primary_datacenter <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;k8s-dc&quot;</span></span></span>
<span class="line">primary_gateways <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;172.16.1.111:31001&quot;</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">&quot;172.16.1.116:31001&quot;</span></span><span class="token punctuation">]</span></span>
<span class="line">cert_file <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;/root/consul-cert/vm-dc-server-consul-0.pem&quot;</span></span></span>
<span class="line">key_file <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;/root/consul-cert/vm-dc-server-consul-0-key.pem&quot;</span></span></span>
<span class="line">ca_file <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;/root/consul-cert/consul-agent-ca.pem&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>server : serverë¡œ êµ¬ì„±ë˜ëŠ” Consulì˜ ê²½ìš°ì— <code>true</code>ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p></li><li><p>node_name, bind_addrëŠ” ê° Serverì— ë§ê²Œ êµ¬ì„±í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” 3ê°œì˜ ì„œë²„ë¡œ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.</p></li><li><p>encrypt : <code>consul keygen</code>ì„ ìƒì„±í•œ ê°’ì…ë‹ˆë‹¤. Serverì™€ Clientëª¨ë‘ ë™ì¼í•œ ê°’ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p></li><li><p>data_dir : Consulì˜ ë°ì´í„°ë¥¼ ì €ì¥í•  ê²½ë¡œì´ë©° ë¯¸ë¦¬ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.</p></li><li><p>retry_join : Consul ì„œë²„ì˜ IPë¥¼ ê¸°ì…í•©ë‹ˆë‹¤.</p></li><li><p>ports: Mesh Gatewayêµ¬ì„±ì„ ìœ„í•´ httpsë¥¼ í™œì„±í™” í•©ë‹ˆë‹¤.</p></li><li><p>enable_central_service_config : federation êµ¬ì„±ì„ ìœ„í•´ <code>true</code> ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</p></li><li><p>connect : Service Mesh êµ¬ì„± í™œì„±í™”ë¥¼ ìœ„í•´ êµ¬ì„±í•©ë‹ˆë‹¤. <code>enable_mesh_gateway_wan_federation</code>ëŠ” Federationì—ì„œ Mesh Gatewayë¥¼ í™œì„±í™” ì‹œì¼œì¤ë‹ˆë‹¤.</p></li><li><p>primary_datacenter : kubernetes í™˜ê²½ì˜ Datacenterì´ë¦„ì„ ê¸°ì…í•©ë‹ˆë‹¤.</p></li><li><p>primary_gateways : Kubernetes í™˜ê²½ì˜ Mesh Gateway ì˜ IPì™€ Portë¥¼ ê¸°ì…í•©ë‹ˆë‹¤. ì—¬ê¸° ì˜ˆì œì—ì„œëŠ” Nodeportë¡œ êµ¬ì„±ëœ Consul Mesh Gatewayì˜ ê°’ì´ í™•ì¸ë©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ kubectl <span class="token builtin class-name">exec</span> statefulset/consul-server -- <span class="token function">sh</span> <span class="token parameter variable">-c</span>   <span class="token string">&#39;curl -sk https://localhost:8501/v1/catalog/service/mesh-gateway | jq &quot;.[].ServiceTaggedAddresses.wan&quot;&#39;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.16.1.111&quot;</span>,</span>
<span class="line">  <span class="token string">&quot;Port&quot;</span><span class="token builtin class-name">:</span> <span class="token number">31001</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.16.1.116&quot;</span>,</span>
<span class="line">  <span class="token string">&quot;Port&quot;</span><span class="token builtin class-name">:</span> <span class="token number">31001</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>cert_file / key_file / ca_file : ì•ì„œ ìƒì„±í•œ Server ì¸ì¦ì„œë“¤ì˜ ê²½ë¡œì™€ íŒŒì¼ëª…ì„ ê¸°ì…í•©ë‹ˆë‹¤.</p></li></ul><h4 id="_3-4-2-client" tabindex="-1"><a class="header-anchor" href="#_3-4-2-client"><span>3.4.2 Client</span></a></h4><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb" data-title="rb"><pre class="language-ruby"><code><span class="line">node_name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;consul_client_01&quot;</span></span></span>
<span class="line">datacenter <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;vm-dc&quot;</span></span></span>
<span class="line">client_addr <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;0.0.0.0&quot;</span></span></span>
<span class="line">bind_addr <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;192.168.100.54&quot;</span></span></span>
<span class="line">encrypt <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;h65lqS3w4x42KP+n4Hn9RtK84Rx7zP3WSahZSyD5i1o=&quot;</span></span></span>
<span class="line">data_dir <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;/var/lib/consul&quot;</span></span></span>
<span class="line">retry_join <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">&quot;192.168.100.51&quot;</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">&quot;192.168.100.52&quot;</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">&quot;192.168.100.53&quot;</span></span><span class="token punctuation">]</span></span>
<span class="line">cert_file <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;/root/consul-cert/vm-dc-client-consul-0.pem&quot;</span></span></span>
<span class="line">key_file <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;/root/consul-cert/vm-dc-client-consul-0-key.pem&quot;</span></span></span>
<span class="line">ca_file <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;/root/consul-cert/consul-agent-ca.pem&quot;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>node_name, bind_addrëŠ” ê° Client ë§ê²Œ êµ¬ì„±í•©ë‹ˆë‹¤.</li><li>data_dir : Consulì˜ ë°ì´í„°ë¥¼ ì €ì¥í•  ê²½ë¡œì´ë©° ë¯¸ë¦¬ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.</li><li>retry_join : Consul ì„œë²„ì˜ IPë¥¼ ê¸°ì…í•©ë‹ˆë‹¤.</li><li>cert_file / key_file / ca_file : ì•ì„œ ìƒì„±í•œ Client ì¸ì¦ì„œë“¤ì˜ ê²½ë¡œì™€ íŒŒì¼ëª…ì„ ê¸°ì…í•©ë‹ˆë‹¤.</li></ul><h4 id="_3-4-3-consul-á„‰á…¥á„‡á…µá„‰á…³-á„€á…®á„‰á…¥á†¼-option" tabindex="-1"><a class="header-anchor" href="#_3-4-3-consul-á„‰á…¥á„‡á…µá„‰á…³-á„€á…®á„‰á…¥á†¼-option"><span>3.4.3 Consul ì„œë¹„ìŠ¤ êµ¬ì„± (Option)</span></a></h4><p>Linux í™˜ê²½ì´ë‚˜ Windowsí™˜ê²½ì—ì„œ ì„œë¹„ìŠ¤ë¡œ êµ¬ì„±í•˜ë©´ ì‹œìŠ¤í…œ ë¶€íŒ… ì‹œ ìë™ìœ¼ë¡œ ì‹œì‘í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì„ í˜¸ë˜ëŠ” ì„¤ì¹˜ ë°©ì‹ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. ì´ë¯¸ ì„¤ì¹˜ëœ ìƒíƒœë¼ë©´ ì•ì„œ êµ¬ì„±ì„ ë³€ê²½í•˜ê³  <code>consul reload</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì„±ì„ ë‹¤ì‹œ ì½ì–´ì˜¤ê±°ë‚˜ ë¦¬ìŠ¤íƒ€íŠ¸ í•©ë‹ˆë‹¤.</p><details class="hint-container details"><summary>LINUX</summary><p><code>/etc/systemd/system/consul.service</code>ì— ë‹¤ìŒì˜ ì„œë¹„ìŠ¤ íŒŒì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤. í•„ìš”ì— ë”°ë¼ Userì™€ Groupì„ ì¶”ê°€í•˜ì—¬ êµ¬ì„±í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” consul Userë¥¼ êµ¬ì„±í•˜ì—¬ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Description</span><span class="token operator">=</span>Consul Service Discovery Agent</span>
<span class="line"><span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://www.consul.io/</span>
<span class="line"><span class="token assign-left variable">After</span><span class="token operator">=</span>network-online.target</span>
<span class="line"><span class="token assign-left variable">Wants</span><span class="token operator">=</span>network-online.target</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Service<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Type</span><span class="token operator">=</span>simple</span>
<span class="line"><span class="token assign-left variable">User</span><span class="token operator">=</span>consul</span>
<span class="line"><span class="token assign-left variable">Group</span><span class="token operator">=</span>consul</span>
<span class="line"><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/local/bin/consul agent -config-dir<span class="token operator">=</span>/etc/consul.d</span>
<span class="line"></span>
<span class="line"><span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-HUP</span> <span class="token variable">$MAINPID</span></span>
<span class="line"><span class="token assign-left variable">KillSignal</span><span class="token operator">=</span>SIGINT</span>
<span class="line"><span class="token assign-left variable">TimeoutStopSec</span><span class="token operator">=</span><span class="token number">5</span></span>
<span class="line"><span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure</span>
<span class="line"><span class="token assign-left variable">SyslogIdentifier</span><span class="token operator">=</span>consul</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Install<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ë“±ë¡ëœ ì„œë¹„ìŠ¤ë¥¼ í™œì„±í™” í•˜ê³  ì‹œì‘í•˜ì—¬ ìƒëŒ€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ systemctl <span class="token builtin class-name">enable</span> consul</span>
<span class="line">$ systemctl start consul</span>
<span class="line">$ systemctl status consul</span>
<span class="line">â— consul.service - Consul Service Discovery Agent</span>
<span class="line">   Loaded: loaded <span class="token punctuation">(</span>/etc/systemd/system/consul.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span></span>
<span class="line">   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since í†  <span class="token number">2020</span>-11-14 <span class="token number">19</span>:05:39 UTC<span class="token punctuation">;</span> 17h ago</span>
<span class="line">     Docs: https://www.consul.io/</span>
<span class="line"> Main PID: <span class="token number">1020</span> <span class="token punctuation">(</span>consul<span class="token punctuation">)</span></span>
<span class="line">   CGroup: /system.slice/consul.service</span>
<span class="line">           â””â”€1020 /usr/local/bin/consul agent -config-dir<span class="token operator">=</span>/etc/consul.d</span>
<span class="line">           </span>
<span class="line">$ journalctl <span class="token parameter variable">-u</span> consul <span class="token parameter variable">-f</span></span>
<span class="line"><span class="token number">11</span>ì›” <span class="token number">15</span> <span class="token number">13</span>:06:12 cl01-consul-vault-0 consul<span class="token punctuation">[</span><span class="token number">1020</span><span class="token punctuation">]</span>: <span class="token number">2020</span>-11-15T13:06:12.265Z <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>  agent.server: Handled event <span class="token keyword">for</span> <span class="token for-or-select variable">server</span> <span class="token keyword">in</span> area: <span class="token assign-left variable">event</span><span class="token operator">=</span>member-join <span class="token assign-left variable">server</span><span class="token operator">=</span>consul-consul-server-1.tsis-k8s <span class="token assign-left variable">area</span><span class="token operator">=</span>wan</span>
<span class="line"><span class="token number">11</span>ì›” <span class="token number">15</span> <span class="token number">13</span>:06:18 cl01-consul-vault-0 consul<span class="token punctuation">[</span><span class="token number">1020</span><span class="token punctuation">]</span>: <span class="token number">2020</span>-11-15T13:06:18.119Z <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>  agent.server.memberlist.wan: memberlist: Suspect consul-consul-server-0.tsis-k8s has failed, no acks received</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><details class="hint-container details"><summary>WINDOWS</summary><p>Powershellì„ í™œìš©í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.</p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code><span class="line">&gt; <span class="token function">sc</span><span class="token punctuation">.</span>exe create <span class="token string">&quot;Consul&quot;</span> binPath= <span class="token string">&quot;consul agent -config-dir=C:\ProgramData\consul\config&quot;</span> <span class="token function">start</span>= auto</span>
<span class="line"><span class="token namespace">[SC]</span> CreateService SUCCESS</span>
<span class="line"></span>
<span class="line">&gt; <span class="token function">sc</span><span class="token punctuation">.</span>exe <span class="token function">start</span> <span class="token string">&quot;Consul&quot;</span></span>
<span class="line"></span>
<span class="line">SERVICE_NAME: Consul</span>
<span class="line">        <span class="token function">TYPE</span>               : 10  WIN32_OWN_PROCESS</span>
<span class="line">        STATE              : 4  RUNNING <span class="token punctuation">(</span>STOPPABLE<span class="token punctuation">,</span> NOT_PAUSABLE<span class="token punctuation">,</span> ACCEPTS_SHUTDOWN<span class="token punctuation">)</span></span>
<span class="line">        WIN32_EXIT_CODE    : 0  <span class="token punctuation">(</span>0x0<span class="token punctuation">)</span></span>
<span class="line">        SERVICE_EXIT_CODE  : 0  <span class="token punctuation">(</span>0x0<span class="token punctuation">)</span></span>
<span class="line">        CHECKPOINT         : 0x0</span>
<span class="line">        WAIT_HINT          : 0x0</span>
<span class="line">        PID                : 8008</span>
<span class="line">        FLAGS              :</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h4 id="_3-4-4-federation-á„’á…ªá†¨á„‹á…µá†«-option" tabindex="-1"><a class="header-anchor" href="#_3-4-4-federation-á„’á…ªá†¨á„‹á…µá†«-option"><span>3.4.4 Federation í™•ì¸ (Option)</span></a></h4><p>Secondary Datacenterì¸ BM/VM í™˜ê²½ì—ì„œ <code>primary_datacenter</code>ë¥¼ ì§€ì •í•˜ì˜€ê¸° ë•Œë¬¸ì— ê¸°ë™ í›„ Kubernetesì˜ Consulê³¼ Joinë˜ì–´ Federationì´ êµ¬ì„±ë©ë‹ˆë‹¤.</p><figure><img src="https://raw.githubusercontent.com/Great-Stone/images/master/uPic/consul-datacenter-dropdown.png" alt="Consul-Federation" tabindex="0" loading="lazy"><figcaption>Consul-Federation</figcaption></figure><h2 id="_4-bm-vm-á„’á…ªá†«á„€á…§á†¼á„‹á…´-mesh-gateway-á„€á…®á„‰á…¥á†¼" tabindex="-1"><a class="header-anchor" href="#_4-bm-vm-á„’á…ªá†«á„€á…§á†¼á„‹á…´-mesh-gateway-á„€á…®á„‰á…¥á†¼"><span>4. BM/VM í™˜ê²½ì˜ Mesh Gateway êµ¬ì„±</span></a></h2><p>Mesh Gatewayë¥¼ êµ¬ì„±í•˜ì—¬ Service Mesh í™˜ê²½ì´ ë©€í‹°/í•˜ì´ë¸Œë¦¬ë“œ Datacenter í™˜ê²½ì„ ì§€ì›í•˜ë„ë¡ í•©ë‹ˆë‹¤. Mesh GatewayëŠ” Consulì˜ ë‚´ì¥ Proxyë¡œëŠ” ë™ì‘í•˜ì§€ ëª»í•˜ë¯€ë¡œ Envoy ë¥¼ ì„¤ì¹˜í•˜ì—¬ ì´ë¥¼ í™œìš©í•©ë‹ˆë‹¤.</p><h3 id="_4-1-envoy-á„‰á…¥á†¯á„á…µ" tabindex="-1"><a class="header-anchor" href="#_4-1-envoy-á„‰á…¥á†¯á„á…µ"><span>4.1 Envoy ì„¤ì¹˜</span></a></h3><p>Consulì˜ ê° ë²„ì „ë³„ ì§€ì›í•˜ëŠ” Envoy ë²„ì „ì€ ë‹¤ìŒ í‘œì™€ ê°™ìŠµë‹ˆë‹¤.</p><table><thead><tr><th style="text-align:left;">Consul Version</th><th style="text-align:left;">Compatible Envoy Versions</th></tr></thead><tbody><tr><td style="text-align:left;">1.10.x</td><td style="text-align:left;">1.18.3, 1.17.3, 1.16.4, 1.15.5</td></tr><tr><td style="text-align:left;">1.9.x</td><td style="text-align:left;">1.16.0, 1.15.2, 1.14.5â€¡, 1.13.6â€¡</td></tr><tr><td style="text-align:left;">1.8.x</td><td style="text-align:left;">1.14.5, 1.13.6, 1.12.7, 1.11.2</td></tr><tr><td style="text-align:left;">1.7.x</td><td style="text-align:left;">1.13.6, 1.12.7, 1.11.2, 1.10.0*</td></tr><tr><td style="text-align:left;">1.6.x, 1.5.3, 1.5.2</td><td style="text-align:left;">1.11.1, 1.10.0, 1.9.1, 1.8.0â€ </td></tr><tr><td style="text-align:left;">1.5.1, 1.5.0</td><td style="text-align:left;">1.9.1, 1.8.0â€ </td></tr><tr><td style="text-align:left;">1.4.x, 1.3.x</td><td style="text-align:left;">1.9.1, 1.8.0â€ , 1.7.0â€ </td></tr></tbody></table><div class="hint-container warning"><p class="hint-container-title">ê²½ê³ </p><p>â€¡ Consul 1.9.xëŠ” 1.15.0+ì˜ Envoyë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.<br> â€  1.9.1 ë²„ì „ ì´í•˜ì˜ EnvoyëŠ” <a href="https://github.com/envoyproxy/envoy/issues/6434" target="_blank" rel="noopener noreferrer">CVE-2019-9900</a>, <a href="https://github.com/envoyproxy/envoy/issues/6435" target="_blank" rel="noopener noreferrer">CVE-2019-9901</a> ì·¨ì•½ì ì´ ë³´ê³ ë˜ì—ˆìŠµë‹ˆë‹¤.<br> * Consul 1.7.xì—ì„œ Envoy 1.10.0ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° <code>consul connect envoy</code> ì»¤ë§¨ë“œ ì‚¬ìš©ì‹œ <code>-envoy-version</code> ì˜µì…˜ì„ í¬í•¨í•´ì•¼í•©ë‹ˆë‹¤.</p></div><p><a href="https://www.envoyproxy.io/docs/envoy/latest/start/install" target="_blank" rel="noopener noreferrer">Envoy ì›¹ì‚¬ì´íŠ¸</a> ì—ì„œ ì§ì ‘ Envoyì˜ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ë¹Œë“œë¥¼ ì–»ê±°ë‚˜ <a href="https://func-e.io/" target="_blank" rel="noopener noreferrer">func-e.io</a> ì™€ ê°™ì€ 3rd party í”„ë¡œì íŠ¸ì—ì„œ Envoy ë°”ì´ë„ˆë¦¬ ë¹Œë“œ íŒ¨í‚¤ì§€ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ Envoyë¥¼ ê°€ì ¸ì™€ ì„¤ì¹˜í•˜ëŠ” <code>func-e</code> ìœ í‹¸ë¦¬í‹°ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ì„¤ì¹˜í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-L</span> https://func-e.io/install.sh <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> -- <span class="token parameter variable">-b</span> /usr/local/bin</span>
<span class="line"></span></code></pre></div><p>ë‹¤ìŒê³¼ ê°™ì´ ëŒ€ìƒ í™˜ê²½ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">FUNC_E_PLATFORM</span><span class="token operator">=</span>darwin/amd64</span>
<span class="line"></span></code></pre></div><details class="hint-container details"><summary>Go (Golang) GOOS and GOARCH</summary><h2 id="a-list-of-goos-goarch-supported-by-go-out-of-the-box" tabindex="-1"><a class="header-anchor" href="#a-list-of-goos-goarch-supported-by-go-out-of-the-box"><span>A list of GOOS/GOARCH supported by <code>go</code> out of the box</span></a></h2><ul><li><code>aix/ppc64</code></li><li><code>darwin/386</code></li><li><code>darwin/amd64</code></li><li><code>dragonfly/amd64</code></li><li><code>freebsd/386</code></li><li><code>freebsd/amd64</code></li><li><code>freebsd/arm</code></li><li><code>freebsd/arm64</code></li><li><code>illumos/amd64</code></li><li><code>js/wasm</code></li><li><code>linux/386</code></li><li><code>linux/amd64</code></li><li><code>linux/arm</code></li><li><code>linux/arm64</code></li><li><code>linux/ppc64</code></li><li><code>linux/ppc64le</code></li><li><code>linux/mips</code></li><li><code>linux/mipsle</code></li><li><code>linux/mips64</code></li><li><code>linux/mips64le</code></li><li><code>linux/riscv64</code></li><li><code>linux/s390x</code></li><li><code>netbsd/386</code></li><li><code>netbsd/amd64</code></li><li><code>netbsd/arm</code></li><li><code>netbsd/arm64</code></li><li><code>openbsd/386</code></li><li><code>openbsd/amd64</code></li><li><code>openbsd/arm</code></li><li><code>openbsd/arm64</code></li><li><code>plan9/386</code></li><li><code>plan9/amd64</code></li><li><code>plan9/arm</code></li><li><code>solaris/amd64</code></li><li><code>windows/386</code></li><li><code>windows/amd64</code></li><li><code>windows/arm</code></li></ul><h2 id="a-list-of-32-bit-goos-goarch-supported-by-go-out-of-the-box" tabindex="-1"><a class="header-anchor" href="#a-list-of-32-bit-goos-goarch-supported-by-go-out-of-the-box"><span>A list of 32-bit GOOS/GOARCH supported by <code>go</code> out of the box</span></a></h2><ul><li><code>darwin/386</code></li><li><code>freebsd/386</code></li><li><code>freebsd/arm</code></li><li><code>linux/386</code></li><li><code>linux/arm</code></li><li><code>linux/mips</code></li><li><code>linux/mipsle</code></li><li><code>netbsd/386</code></li><li><code>netbsd/arm</code></li><li><code>openbsd/386</code></li><li><code>openbsd/arm</code></li><li><code>plan9/386</code></li><li><code>plan9/arm</code></li><li><code>windows/386</code></li><li><code>windows/arm</code></li></ul><h2 id="a-list-of-64-bit-goos-goarch-supported-by-go-out-of-the-box" tabindex="-1"><a class="header-anchor" href="#a-list-of-64-bit-goos-goarch-supported-by-go-out-of-the-box"><span>A list of 64-bit GOOS/GOARCH supported by <code>go</code> out of the box</span></a></h2><ul><li><code>aix/ppc64</code></li><li><code>darwin/amd64</code></li><li><code>dragonfly/amd64</code></li><li><code>freebsd/amd64</code></li><li><code>freebsd/arm64</code></li><li><code>illumos/amd64</code></li><li><code>js/wasm</code></li><li><code>linux/amd64</code></li><li><code>linux/arm64</code></li><li><code>linux/ppc64</code></li><li><code>linux/ppc64le</code></li><li><code>linux/mips64</code></li><li><code>linux/mips64le</code></li><li><code>linux/riscv64</code></li><li><code>linux/s390x</code></li><li><code>netbsd/amd64</code></li><li><code>netbsd/arm64</code></li><li><code>openbsd/amd64</code></li><li><code>openbsd/arm64</code></li><li><code>plan9/amd64</code></li><li><code>solaris/amd64</code></li><li><code>windows/amd64</code></li></ul></details><p>íŠ¹ì • ë²„ì „ì„ ëª…ì‹œí•˜ì—¬ ë‹¤ìš´ë¡œë“œ í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">func-e use <span class="token number">1.18</span>.3</span>
<span class="line"></span></code></pre></div><p>Envoy ë°”ì´ë„ˆë¦¬ë¥¼ <code>$PATH</code>ì˜ ìœ„ì¹˜ì— ë³µì‚¬í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ Consulì€ ë°”ì´ë„ˆë¦¬ ìœ„ì¹˜ë¥¼ ì§€ì •í•˜ì§€ ì•Šê³  Envoyë¥¼ ìë™ìœ¼ë¡œ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token function">sudo</span> <span class="token function">cp</span> ~/.func-e/versions/1.18.3/bin/envoy /usr/local/bin/</span>
<span class="line"></span></code></pre></div><p>ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ Envoyê°€ <code>$PATH</code>ì— ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">envoy <span class="token parameter variable">--version</span></span>
<span class="line"></span></code></pre></div><h3 id="_4-2-mesh-gateway-á„‰á…µá†¯á„’á…¢á†¼" tabindex="-1"><a class="header-anchor" href="#_4-2-mesh-gateway-á„‰á…µá†¯á„’á…¢á†¼"><span>4.2 Mesh Gateway ì‹¤í–‰</span></a></h3><p>Mesh GatewayëŠ” TLSë¥¼ í•„ìš”ë¡œí•˜ë©° Consulê³¼ë„ TLSë¡œ í†µì‹  í•©ë‹ˆë‹¤. ë”°ë¼ì„œ Consulë¡œì˜ ê¸°ë³¸ ì ‘ì† ë°©ì‹ê³¼ í¬íŠ¸ë¥¼ SSLê¸°ì¤€ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤. ë˜í•œ ì•ì„œ Consul Clientë¥¼ ìœ„í•´ ìƒì„±í•œ ì¸ì¦ì„œë¥¼ í™œìš©í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">CONSUL_HTTP_SSL</span><span class="token operator">=</span>true</span>
<span class="line">$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">CONSUL_HTTP_ADDR</span><span class="token operator">=</span>https://127.0.0.1:8501</span>
<span class="line">$ consul connect envoy <span class="token parameter variable">-gateway</span><span class="token operator">=</span>mesh <span class="token parameter variable">-register</span> -expose-servers <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">-service</span> <span class="token string">&quot;mesh-gateway-secondary&quot;</span> <span class="token punctuation">\</span></span>
<span class="line">  -ca-file<span class="token operator">=</span>/root/consul-cert/consul-agent-ca.pem <span class="token punctuation">\</span></span>
<span class="line">  -client-cert<span class="token operator">=</span>/root/consul-cert/vm-dc-client-consul-0.pem <span class="token punctuation">\</span></span>
<span class="line">  -client-key<span class="token operator">=</span>/root/consul-cert/vm-dc-client-consul-0-key.pem <span class="token punctuation">\</span></span>
<span class="line">  <span class="token parameter variable">-address</span> <span class="token string">&#39;{{ GetInterfaceIP &quot;lo&quot; }}:9100&#39;</span> <span class="token punctuation">\</span></span>
<span class="line">  -wan-address <span class="token string">&#39;{{ GetInterfaceIP &quot;eth0&quot; }}:9100&#39;</span> -admin-bind<span class="token operator">=</span><span class="token number">127.0</span>.0.1:19001 <span class="token operator">&amp;</span></span>
<span class="line"></span></code></pre></div><ul><li>service : Consulì— ë“±ë¡ë˜ëŠ” Mesh Gatewayì˜ ì„œë¹„ìŠ¤ ì´ë¦„ ì…ë‹ˆë‹¤.</li><li>GetInterfaceIP : Consulì—ì„œ ì‚¬ìš©í•˜ëŠ” í…œí”Œë¦¿ ê°’ì…ë‹ˆë‹¤. ì´ë ‡ê²Œ ì‘ì„±í•˜ë©´ Networkì„¤ì •ì—ì„œ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ì— ì§€ì •ëœ IPë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li><li>admin-bind : Envoyì˜ ê´€ë¦¬ì ë°”ì¸ë”©ì„ ì„¤ì •í•©ë‹ˆë‹¤. ë™ì¼í•œ í˜¸ìŠ¤íŠ¸ì—ì„œ ì—¬ëŸ¬ê°œì˜ Envoyë¥¼ ì‹¤í–‰í•˜ëŠ” ê²½ìš° Admin Portê°€ ì¤‘ë³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ 19000 ì…ë‹ˆë‹¤.</li><li>ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ì„ ìœ„í•´ ëì— <code>&amp;</code>ë¥¼ ë¶™ì˜€ìŠµë‹ˆë‹¤. ì›í•˜ì§€ ì•Šìœ¼ì‹œë©´ ì œê±°í•˜ì—¬ í¬ê·¸ë¼ìš´ë“œë¡œ ë„ìš°ì…”ë„ ë©ë‹ˆë‹¤.</li></ul><p>ì‹¤í–‰ í›„ì—ëŠ” Consul UIì—ì„œë„ í•´ë‹¹ Mesh Gatewayë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><h2 id="_5-test-option" tabindex="-1"><a class="header-anchor" href="#_5-test-option"><span>5 TEST (Option)</span></a></h2><blockquote><p>Frontend ì• í”Œë¦¬ì¼€ì´ì…˜ì„ BM/VM í™˜ê²½ì— êµ¬ì„±í•˜ê³  Backendë¥¼ Kubernetesì— êµ¬ì„±í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤.<br><a href="https://github.com/hashicorp/demo-consul-101" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/demo-consul-101</a></p></blockquote><details class="hint-container details"><summary>FOR TEST</summary><h3 id="_5-1-counting-service-backend-on-kubernetes" tabindex="-1"><a class="header-anchor" href="#_5-1-counting-service-backend-on-kubernetes"><span>5.1 Counting Service(Backend) on Kubernetes</span></a></h3><p>ì•ì„œ <a href="#2.2.6-%ED%85%8C%EC%8A%A4%ED%8A%B8%EB%A5%BC-%EC%9C%84%ED%95%9C-pod-%EC%83%9D%EC%84%B1">2.2.6 í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ Pod ìƒì„±</a>ì˜ counting ì„œë¹„ìŠ¤ë¥¼ í™œìš©í•©ë‹ˆë‹¤.</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> counting</span>
<span class="line"><span class="token punctuation">---</span></span>
<span class="line"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1</span>
<span class="line"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod</span>
<span class="line"><span class="token key atrule">metadata</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">name</span><span class="token punctuation">:</span> counting</span>
<span class="line">  <span class="token key atrule">annotations</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">&#39;consul.hashicorp.com/service-tags&#39;</span><span class="token punctuation">:</span> servicemesh<span class="token punctuation">,</span> consul<span class="token punctuation">,</span> counting<span class="token punctuation">,</span> v1</span>
<span class="line">    <span class="token key atrule">&#39;consul.hashicorp.com/connect-inject&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;true&#39;</span></span>
<span class="line"><span class="token key atrule">spec</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">containers</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> counting</span>
<span class="line">      <span class="token key atrule">image</span><span class="token punctuation">:</span> hashicorp/counting<span class="token punctuation">-</span>service<span class="token punctuation">:</span>0.0.2</span>
<span class="line">      <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">9001</span></span>
<span class="line">          <span class="token key atrule">name</span><span class="token punctuation">:</span> http</span>
<span class="line">  <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> counting</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2-dashboard-service-frontend-on-bm-vm" tabindex="-1"><a class="header-anchor" href="#_5-2-dashboard-service-frontend-on-bm-vm"><span>5.2 DashBoard Service(Frontend) on BM/VM</span></a></h3><p>BM/VM í™˜ê²½ì—ì„œ Frontend ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì„±í•©ë‹ˆë‹¤. Envoy Proxyë¥¼ Sidecarë¡œ êµ¬ì„±í•˜ì—¬ Service Meshë¥¼ ìœ„í•œ êµ¬ì„±ì„ í•˜ê³ , ë‹¤ë¥¸ Consul ë°ì´í„°ì„¼í„°ì— ìˆëŠ” ì„œë¹„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.</p><blockquote><p><a href="https://github.com/hashicorp/demo-consul-101/tree/master/services/dashboard-service" target="_blank" rel="noopener noreferrer">https://github.com/hashicorp/demo-consul-101/tree/master/services/dashboard-service</a></p><p>ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ì„ ìœ„í•´ì„œëŠ” golangì´ ì„¤ì¹˜ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</p></blockquote><p>Dashboard ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">9003</span> <span class="token assign-left variable">COUNTING_SERVICE_URL</span><span class="token operator">=</span><span class="token string">&quot;http://localhost:5000&quot;</span> go run main.go <span class="token operator">&amp;</span></span>
<span class="line"></span></code></pre></div><ul><li>PORT : Dashboard ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.</li><li>COUNTING_SERVICE_URL : Backend ì• í”Œë¦¬ì¼€ì´ì…˜ì¸ Counting Serviceì— ëŒ€í•œ ì •ë³´ì…ë‹ˆë‹¤. ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ê°’ì€ &quot;<a href="http://localhost:9001" target="_blank" rel="noopener noreferrer">http://localhost:9001</a>&quot; ì…ë‹ˆë‹¤.</li></ul><p>9003ìœ¼ë¡œ ì‹¤í–‰ëœ Dashboard ì• í”Œë¦¬ì¼€ì´ì…˜ì„ Consulì— ì„œë¹„ìŠ¤ë¡œ ë“±ë¡í•©ë‹ˆë‹¤. Consulì˜ ê¸°ë³¸ Configuration ë””ë ‰í† ë¦¬ ìœ„ì¹˜ì— í•´ë‹¹ ì„œë¹„ìŠ¤ êµ¬ì„±ì„ ì‘ì„±í•˜ê³  ì½ì–´ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (e.g. /etc/consul.d)</p><div class="language-ruby line-numbers-mode" data-highlighter="prismjs" data-ext="rb" data-title="rb"><pre class="language-ruby"><code><span class="line"><span class="token comment"># /etc/consul.d/dashboard.hcl</span></span>
<span class="line">service <span class="token punctuation">{</span></span>
<span class="line">  name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;dashboard-vm&quot;</span></span></span>
<span class="line">  port <span class="token operator">=</span> <span class="token number">9003</span></span>
<span class="line"></span>
<span class="line">  connect <span class="token punctuation">{</span></span>
<span class="line">    sidecar_service <span class="token punctuation">{</span></span>
<span class="line">      proxy <span class="token punctuation">{</span></span>
<span class="line">        upstreams <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            destination_name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;counting&quot;</span></span></span>
<span class="line">            datacenter <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;k8s-dc&quot;</span></span></span>
<span class="line">            local_bind_port <span class="token operator">=</span> <span class="token number">5000</span></span>
<span class="line">            mesh_gateway <span class="token punctuation">{</span></span>
<span class="line">              mode <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;local&quot;</span></span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  check <span class="token punctuation">{</span></span>
<span class="line">    id       <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;dashboard-check&quot;</span></span></span>
<span class="line">    http     <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;http://localhost:9003/health&quot;</span></span></span>
<span class="line">    method   <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;GET&quot;</span></span></span>
<span class="line">    interval <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;1s&quot;</span></span></span>
<span class="line">    timeout  <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;1s&quot;</span></span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>connectì— Service Mesh ì„¤ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤. <ul><li>destination_name : local_bind_portë¡œ ì˜¤ëŠ” ìš”ì²­ì„ ì–´ë–¤ ì„œë¹„ìŠ¤ë¡œ ë³´ë‚¼ì§€ ì •ì˜í•©ë‹ˆë‹¤.</li><li>datacenter : ë°ì´í„°ì„¼í„° ì´ë¦„ì´ í•´ë‹¹ ì„œë¹„ìŠ¤ê°€ ì†í•œ ë°ì´í„°ì„¼í„° ì´ë¦„ê³¼ ë‹¤ë¥´ë©´ ì™¸ë¶€ Mesh Gatewayë¥¼ ì°¾ê³ , Federation ëœ í•´ë‹¹ Mesh Gatewayë¡œ ìš”ì²­ì„ ì „ì†¡í•©ë‹ˆë‹¤.</li></ul></li></ul><p>Dashboard ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ <code>COUNTING_SERVICE_URL</code>ì˜ ëŒ€ìƒì„ 5000ë²ˆ í¬íŠ¸ë¡œ ì§€ì •í•˜ì˜€ê¸° ë•Œë¬¸ì— upstreamì—ì„œ ë°”ì¸ë”©ë˜ëŠ” í¬íŠ¸ë¥¼ ë§ì¶°ì¤ë‹ˆë‹¤. êµ¬ì„±ì´ ì™„ë£Œë˜ë©´ <code>consul reload</code> ëª…ë ¹ì„ í†µí•´ êµ¬ì„± ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ì„ ë°˜ì˜í•˜ê³  ì¶”ê°€ëœ ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ consul reload</span>
<span class="line">Configuration reload triggered</span>
<span class="line"></span>
<span class="line">$ consul catalog services</span>
<span class="line">consul</span>
<span class="line">dashboard-vm</span>
<span class="line"></span></code></pre></div><p>ë‹¤ìŒìœ¼ë¡œ Dashboard ì„œë¹„ìŠ¤ë¥¼ ìœ„í•œ Sidecarë¥¼ ì‹¤í–‰í•˜ê³  ì¶”ê°€ëœ ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ consul connect envoy -sidecar-for dashboard-vm <span class="token punctuation">\</span></span>
<span class="line">  -ca-file<span class="token operator">=</span>/root/consul-cert/consul-agent-ca.pem <span class="token punctuation">\</span></span>
<span class="line">  -client-cert<span class="token operator">=</span>/root/consul-cert/vm-dc-client-consul-0.pem <span class="token punctuation">\</span></span>
<span class="line">  -client-key<span class="token operator">=</span>/root/consul-cert/vm-dc-client-consul-0-key.pem <span class="token operator">&amp;</span></span>
<span class="line">  </span>
<span class="line">$ consul catalog services</span>
<span class="line">consul</span>
<span class="line">dashboard-vm</span>
<span class="line">dashboard-vm-sidecar-proxy</span>
<span class="line"></span></code></pre></div><p>ì´ì œ êµ¬ì„±ëœ 9003ë²ˆ í¬íŠ¸ë¥¼ í†µí•´ Frontendì—ì„œ ì™¸ë¶€ ë°ì´í„°ì„¼í„°ì˜ Backendë¡œ ìš”ì²­ì´ ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p><figure><img src="https://learn.hashicorp.com/img/consul/connect-getting-started/screenshot1.png" alt="Dashiboard" tabindex="0" loading="lazy"><figcaption>Dashiboard</figcaption></figure><h3 id="_5-3-intention" tabindex="-1"><a class="header-anchor" href="#_5-3-intention"><span>5.3 Intention</span></a></h3><p>Sidecarê¸°ëŠ¥ì´ í™œì„±í™” ë˜ë©´ì„œ Consulì˜ Intentionê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Intentionì„ í†µí•´ ë™ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ì— ëŒ€í•œ íŠ¸ë˜í”½ì„ í†µì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>UI ë˜ëŠ” CLIë¥¼ í†µí•´ <code>dashboard-vm</code>ì´ <code>counting</code>ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë„ë¡ ì •ì˜í•©ë‹ˆë‹¤.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ consul intention create <span class="token parameter variable">-deny</span> <span class="token parameter variable">-replace</span> dashboard-vm counting</span>
<span class="line">Created: dashboard-vm <span class="token operator">=</span><span class="token operator">&gt;</span> counting <span class="token punctuation">(</span>deny<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre></div><figure><img src="https://raw.githubusercontent.com/Great-Stone/images/master/uPic/Edit Intention - Consul 2020-11-16 00-27-50.png" alt="Edit Intention - Consul 2020-11-16 00-27-50" tabindex="0" loading="lazy"><figcaption>Edit Intention - Consul 2020-11-16 00-27-50</figcaption></figure><p>ì ‘ê·¼í•  ìˆ˜ ì—†ê²Œ ì„¤ì •ë˜ì—ˆê¸° ë•Œë¬¸ì— Sidecarì— ì£¼ì…ëœ ì„¤ì •ìœ¼ë¡œ Dashboardì—ì„œëŠ” Countingì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤ëŠ” ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤.</p><figure><img src="https://learn.hashicorp.com/img/consul/connect-getting-started/screenshot2.png" alt="Dashboard-intention" tabindex="0" loading="lazy"><figcaption>Dashboard-intention</figcaption></figure></details></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/docmoa/docs/edit/main/docs/04-HashiCorp/04-Consul/03-UseCase/Consul Enterprise Feature.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ë§ˆì§€ë§‰ ìˆ˜ì •: </span><!----></div><div class="contributors"><span class="vp-meta-label">ê¸°ì—¬ì: </span><!--[--><!--[--><span class="vp-meta-info" title="email: hahohh@gmail.com">Great-Stone</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/04-HashiCorp/04-Consul/03-UseCase/Consul%20Health%20Check.html" aria-label="Consul Health Check on VMs"><div class="hint"><span class="arrow start"></span>ì´ì „</div><div class="link"><!---->Consul Health Check on VMs</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">CC BY-NC-ND 4.0 Licensed | â“’ 2021-present docmoaâ„¢ contributers all rights reserved.</div><!----></footer></div><!--]--><!--]--><!--[--><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DVMlqOhY.js" defer></script>
  </body>
</html>
