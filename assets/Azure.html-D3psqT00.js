import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as a,h as p}from"./app-DVMlqOhY.js";const e={},t=p(`<h1 id="azure-packer-sample" tabindex="-1"><a class="header-anchor" href="#azure-packer-sample"><span>Azure Packer Sample</span></a></h1><h2 id="packer-pkr-hcl" tabindex="-1"><a class="header-anchor" href="#packer-pkr-hcl"><span>packer.pkr.hcl</span></a></h2><ul><li><code>vault()</code>는 vault 연동시 사용가능 : <a href="https://www.packer.io/docs/templates/hcl_templates/functions/contextual/vault" target="_blank" rel="noopener noreferrer">https://www.packer.io/docs/templates/hcl_templates/functions/contextual/vault</a></li></ul><div class="language-hcl line-numbers-mode" data-highlighter="prismjs" data-ext="hcl" data-title="hcl"><pre class="language-hcl"><code><span class="line"><span class="token comment"># packer init -upgrade .</span></span>
<span class="line"><span class="token comment"># packer build -force .</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">locals</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">client_id</span> <span class="token punctuation">=</span> vault(<span class="token string">&quot;/kv/data/azure&quot;</span>, <span class="token string">&quot;client_id&quot;</span>)</span>
<span class="line">  <span class="token property">client_secret</span> <span class="token punctuation">=</span> vault(<span class="token string">&quot;/kv/data/azure&quot;</span>, <span class="token string">&quot;client_secret&quot;</span>)</span>
<span class="line">  <span class="token property">tenant_id</span> <span class="token punctuation">=</span> vault(<span class="token string">&quot;/kv/data/azure&quot;</span>, <span class="token string">&quot;tenant_id&quot;</span>)</span>
<span class="line">  <span class="token property">subscription_id</span> <span class="token punctuation">=</span> vault(<span class="token string">&quot;/kv/data/azure&quot;</span>, <span class="token string">&quot;subscription_id&quot;</span>)</span>
<span class="line">  <span class="token property">resource_group_name</span> <span class="token punctuation">=</span> var.resource_name</span>
<span class="line">  <span class="token property">virtual_network_name</span> <span class="token punctuation">=</span> <span class="token string">&quot;kbid-d-krc-vnet-002&quot;</span></span>
<span class="line">  <span class="token property">virtual_network_subnet_name</span>  <span class="token punctuation">=</span> <span class="token string">&quot;d-mgmt-snet-001&quot;</span></span>
<span class="line">  <span class="token property">virtual_network_resource_group_name</span>  <span class="token punctuation">=</span> <span class="token string">&quot;kbid-d-krc-mgmt-rg&quot;</span></span>
<span class="line">  <span class="token property">timestamp</span> <span class="token punctuation">=</span> formatdate(<span class="token string">&quot;YYYYMMDD_hhmmss&quot;</span>, timeadd(timestamp(), <span class="token string">&quot;9h&quot;</span>)) <span class="token comment">#생성되는 이미지 이름을 time 기반으로 생성</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">variable<span class="token type variable"> &quot;placeholder&quot; </span></span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">default</span>     <span class="token punctuation">=</span> <span class="token string">&quot;placekitten.com&quot;</span></span>
<span class="line">  <span class="token property">description</span> <span class="token punctuation">=</span> <span class="token string">&quot;Image-as-a-service URL. Some other fun ones to try are fillmurray.com, placecage.com, placebeard.it, loremflickr.com, baconmockup.com, placeimg.com, placebear.com, placeskull.com, stevensegallery.com, placedog.net&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Basic example : https://www.packer.io/docs/builders/azure/arm#basic-example</span></span>
<span class="line"><span class="token comment"># MS Guide : https://docs.microsoft.com/ko-kr/azure/virtual-machines/linux/build-image-with-packer</span></span>
<span class="line">source <span class="token string">&quot;azure-arm&quot;</span> <span class="token string">&quot;basic-example&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">client_id</span> <span class="token punctuation">=</span> local.client_id</span>
<span class="line">  <span class="token property">client_secret</span> <span class="token punctuation">=</span> local.client_secret</span>
<span class="line">  <span class="token property">subscription_id</span> <span class="token punctuation">=</span> local.subscription_id</span>
<span class="line">  <span class="token property">tenant_id</span> <span class="token punctuation">=</span> local.tenant_id</span>
<span class="line"></span>
<span class="line">  <span class="token comment"># shared_image_gallery {</span></span>
<span class="line">  <span class="token comment">#   subscription = local.subscription_id</span></span>
<span class="line">  <span class="token comment">#   resource_group = &quot;myrg&quot;</span></span>
<span class="line">  <span class="token comment">#   gallery_name = &quot;GalleryName&quot;</span></span>
<span class="line">  <span class="token comment">#   image_name = &quot;gs_pkr_\${local.timestamp}&quot;</span></span>
<span class="line">  <span class="token comment">#   image_version = &quot;1.0.0&quot;</span></span>
<span class="line">  <span class="token comment"># }</span></span>
<span class="line">  <span class="token property">managed_image_resource_group_name</span> <span class="token punctuation">=</span> local.resource_group_name</span>
<span class="line">  <span class="token property">managed_image_name</span> <span class="token punctuation">=</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">image_name</span><span class="token punctuation">}</span></span>-<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">local</span><span class="token punctuation">.</span><span class="token type variable">timestamp</span><span class="token punctuation">}</span></span>&quot;</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">os_type</span> <span class="token punctuation">=</span> <span class="token string">&quot;Linux&quot;</span></span>
<span class="line">  <span class="token comment"># az vm image list-publishers --location koreacentral --output table</span></span>
<span class="line">  <span class="token property">image_publisher</span> <span class="token punctuation">=</span> <span class="token string">&quot;RedHat&quot;</span></span>
<span class="line">  <span class="token comment"># az vm image list-offers --location koreacentral --publisher RedHat --output table</span></span>
<span class="line">  <span class="token property">image_offer</span> <span class="token punctuation">=</span> <span class="token string">&quot;RHEL&quot;</span></span>
<span class="line">  <span class="token comment"># az vm image list-skus --location koreacentral --publisher RedHat --offer RHEL --output table</span></span>
<span class="line">  <span class="token property">image_sku</span> <span class="token punctuation">=</span> <span class="token string">&quot;8_4&quot;</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">azure_tags</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">dept</span> <span class="token punctuation">=</span> <span class="token string">&quot;KBHC Terraform POC&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  </span>
<span class="line">  <span class="token comment"># az vm list-skus --location koreacentral --all --output table</span></span>
<span class="line">  <span class="token property">build_resource_group_name</span> <span class="token punctuation">=</span> local.resource_group_name</span>
<span class="line"></span>
<span class="line">  <span class="token comment">#########################################</span></span>
<span class="line">  <span class="token comment"># 기존 생성되어있는 network 를 사용하기 위한 항목 #</span></span>
<span class="line">  <span class="token comment">#########################################</span></span>
<span class="line">  <span class="token property">virtual_network_name</span> <span class="token punctuation">=</span> local.virtual_network_name</span>
<span class="line">  <span class="token property">virtual_network_subnet_name</span> <span class="token punctuation">=</span> local.virtual_network_subnet_name</span>
<span class="line">  <span class="token property">virtual_network_resource_group_name</span> <span class="token punctuation">=</span> local.virtual_network_resource_group_name</span>
<span class="line">  </span>
<span class="line">  <span class="token comment"># location = &quot;koreacentral&quot;</span></span>
<span class="line">  <span class="token property">vm_size</span> <span class="token punctuation">=</span> <span class="token string">&quot;Standard_A2_v2&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">build</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">sources</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;sources.azure-arm.basic-example&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">provisioner<span class="token type variable"> &quot;file&quot; </span></span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">source</span>      <span class="token punctuation">=</span> <span class="token string">&quot;./files/&quot;</span></span>
<span class="line">    <span class="token property">destination</span> <span class="token punctuation">=</span> <span class="token string">&quot;/tmp&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Vault OTP</span></span>
<span class="line">  <span class="token keyword">provisioner<span class="token type variable"> &quot;shell&quot; </span></span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">inline</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token string">&quot;sudo cp /tmp/sshd /etc/pam.d/sshd&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo cp /tmp/sshd_config /etc/ssh/sshd_config&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo mkdir -p /etc/vault.d&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo cp /tmp/vault.hcl /etc/vault.d/vault.hcl&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo cp /tmp/vault-ssh-helper /usr/bin/vault-ssh-helper&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;echo \\&quot;=== Vault_Check ===\\&quot;&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;curl http://10.0.9.10:8200&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;/usr/bin/vault-ssh-helper -verify-only -config=/etc/vault.d/vault.hcl -dev&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;echo \\&quot;=== Add User ===\\&quot;&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo adduser jboss&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;echo password | sudo passwd --stdin jboss&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;echo &#39;jboss ALL=(ALL) NOPASSWD: ALL&#39; | sudo tee -a /etc/sudoers&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;echo \\&quot;=== SELINUX DISABLE ===\\&quot;&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo sed -ie &#39;s/SELINUX=enforcing/SELINUX=disabled /g&#39; /etc/selinux/config&quot;</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Apache</span></span>
<span class="line">  <span class="token keyword">provisioner<span class="token type variable"> &quot;shell&quot; </span></span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">inline</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token string">&quot;sudo yum -y update&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sleep 15&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo yum -y update&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo yum -y install httpd&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo systemctl enable httpd&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo systemctl start httpd&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;chmod +x /tmp/deploy_app.sh&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo PLACEHOLDER=<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span><span class="token keyword">var</span><span class="token punctuation">.</span><span class="token type variable">placeholder</span><span class="token punctuation">}</span></span> WIDTH=600 HEIGHT=800 PREFIX=gs /tmp/deploy_app.sh&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo firewall-cmd --zone=public --permanent --add-port=80/tcp&quot;</span>,</span>
<span class="line">      <span class="token string">&quot;sudo firewall-cmd --reload&quot;</span>,</span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="deploy-app-sh-option" tabindex="-1"><a class="header-anchor" href="#deploy-app-sh-option"><span>deploy_app.sh (option)</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"><span class="token comment"># Script to deploy a very simple web application.</span></span>
<span class="line"><span class="token comment"># The web app has a customizable image and some text.</span></span>
<span class="line"></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOM<span class="token bash punctuation"> <span class="token operator">&gt;</span> /var/www/html/index.html</span></span>
<span class="line">&lt;html&gt;</span>
<span class="line">  &lt;head&gt;&lt;title&gt;Meow!&lt;/title&gt;&lt;/head&gt;</span>
<span class="line">  &lt;body&gt;</span>
<span class="line">  &lt;div style=&quot;width:800px;margin: 0 auto&quot;&gt;</span>
<span class="line"></span>
<span class="line">  &lt;!-- BEGIN --&gt;</span>
<span class="line">  &lt;center&gt;&lt;img src=&quot;http://<span class="token variable">\${PLACEHOLDER}</span>/<span class="token variable">\${WIDTH}</span>/<span class="token variable">\${HEIGHT}</span>&quot;&gt;&lt;/img&gt;&lt;/center&gt;</span>
<span class="line">  &lt;center&gt;&lt;h2&gt;Meow World!&lt;/h2&gt;&lt;/center&gt;</span>
<span class="line">  Welcome to <span class="token variable">\${PREFIX}</span>&#39;s app. Replace this text with your own.</span>
<span class="line">  &lt;!-- END --&gt;</span>
<span class="line"></span>
<span class="line">  &lt;/div&gt;</span>
<span class="line">  &lt;/body&gt;</span>
<span class="line">&lt;/html&gt;</span>
<span class="line">EOM</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;Script complete.&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),l=[t];function c(i,o){return n(),a("div",null,l)}const d=s(e,[["render",c],["__file","Azure.html.vue"]]),k=JSON.parse(`{"path":"/04-HashiCorp/01-Packer/05-SamplePkr/Azure.html","title":"Azure Packer Sample","lang":"ko-KR","frontmatter":{"description":"Packer Sample","tag":["Packer","Sample","Azure"],"head":[["meta",{"property":"og:url","content":"https://docmoa.github.io/04-HashiCorp/01-Packer/05-SamplePkr/Azure.html"}],["meta",{"property":"og:site_name","content":"docmoa"}],["meta",{"property":"og:title","content":"Azure Packer Sample"}],["meta",{"property":"og:description","content":"Packer Sample"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2023-09-18T13:12:54.000Z"}],["meta",{"property":"article:tag","content":"Packer"}],["meta",{"property":"article:tag","content":"Sample"}],["meta",{"property":"article:tag","content":"Azure"}],["meta",{"property":"article:modified_time","content":"2023-09-18T13:12:54.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Azure Packer Sample\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-09-18T13:12:54.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"packer.pkr.hcl","slug":"packer-pkr-hcl","link":"#packer-pkr-hcl","children":[]},{"level":2,"title":"deploy_app.sh (option)","slug":"deploy-app-sh-option","link":"#deploy-app-sh-option","children":[]}],"git":{"createdTime":1632808034000,"updatedTime":1695042774000,"contributors":[{"name":"Administrator","email":"admin@example.com","commits":2},{"name":"Great-Stone","email":"hahohh@gmail.com","commits":1}]},"readingTime":{"minutes":7.07,"words":424},"filePathRelative":"04-HashiCorp/01-Packer/05-SamplePkr/Azure.md","localizedDate":"2021년 9월 28일","excerpt":"\\n<h2>packer.pkr.hcl</h2>\\n<ul>\\n<li><code>vault()</code>는 vault 연동시 사용가능 : <a href=\\"https://www.packer.io/docs/templates/hcl_templates/functions/contextual/vault\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://www.packer.io/docs/templates/hcl_templates/functions/contextual/vault</a></li>\\n</ul>\\n<div class=\\"language-hcl\\" data-highlighter=\\"prismjs\\" data-ext=\\"hcl\\" data-title=\\"hcl\\"><pre class=\\"language-hcl\\"><code><span class=\\"line\\"><span class=\\"token comment\\"># packer init -upgrade .</span></span>\\n<span class=\\"line\\"><span class=\\"token comment\\"># packer build -force .</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">locals</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">client_id</span> <span class=\\"token punctuation\\">=</span> vault(<span class=\\"token string\\">\\"/kv/data/azure\\"</span>, <span class=\\"token string\\">\\"client_id\\"</span>)</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">client_secret</span> <span class=\\"token punctuation\\">=</span> vault(<span class=\\"token string\\">\\"/kv/data/azure\\"</span>, <span class=\\"token string\\">\\"client_secret\\"</span>)</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">tenant_id</span> <span class=\\"token punctuation\\">=</span> vault(<span class=\\"token string\\">\\"/kv/data/azure\\"</span>, <span class=\\"token string\\">\\"tenant_id\\"</span>)</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">subscription_id</span> <span class=\\"token punctuation\\">=</span> vault(<span class=\\"token string\\">\\"/kv/data/azure\\"</span>, <span class=\\"token string\\">\\"subscription_id\\"</span>)</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">resource_group_name</span> <span class=\\"token punctuation\\">=</span> var.resource_name</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">virtual_network_name</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"kbid-d-krc-vnet-002\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">virtual_network_subnet_name</span>  <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"d-mgmt-snet-001\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">virtual_network_resource_group_name</span>  <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"kbid-d-krc-mgmt-rg\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">timestamp</span> <span class=\\"token punctuation\\">=</span> formatdate(<span class=\\"token string\\">\\"YYYYMMDD_hhmmss\\"</span>, timeadd(timestamp(), <span class=\\"token string\\">\\"9h\\"</span>)) <span class=\\"token comment\\">#생성되는 이미지 이름을 time 기반으로 생성</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">variable<span class=\\"token type variable\\"> \\"placeholder\\" </span></span><span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">default</span>     <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"placekitten.com\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">description</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"Image-as-a-service URL. Some other fun ones to try are fillmurray.com, placecage.com, placebeard.it, loremflickr.com, baconmockup.com, placeimg.com, placebear.com, placeskull.com, stevensegallery.com, placedog.net\\"</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token comment\\"># Basic example : https://www.packer.io/docs/builders/azure/arm#basic-example</span></span>\\n<span class=\\"line\\"><span class=\\"token comment\\"># MS Guide : https://docs.microsoft.com/ko-kr/azure/virtual-machines/linux/build-image-with-packer</span></span>\\n<span class=\\"line\\">source <span class=\\"token string\\">\\"azure-arm\\"</span> <span class=\\"token string\\">\\"basic-example\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">client_id</span> <span class=\\"token punctuation\\">=</span> local.client_id</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">client_secret</span> <span class=\\"token punctuation\\">=</span> local.client_secret</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">subscription_id</span> <span class=\\"token punctuation\\">=</span> local.subscription_id</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">tenant_id</span> <span class=\\"token punctuation\\">=</span> local.tenant_id</span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\"># shared_image_gallery {</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\">#   subscription = local.subscription_id</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\">#   resource_group = \\"myrg\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\">#   gallery_name = \\"GalleryName\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\">#   image_name = \\"gs_pkr_\${local.timestamp}\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\">#   image_version = \\"1.0.0\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\"># }</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">managed_image_resource_group_name</span> <span class=\\"token punctuation\\">=</span> local.resource_group_name</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">managed_image_name</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"<span class=\\"token interpolation\\"><span class=\\"token punctuation\\">$</span><span class=\\"token punctuation\\">{</span><span class=\\"token keyword\\">var</span><span class=\\"token punctuation\\">.</span><span class=\\"token type variable\\">image_name</span><span class=\\"token punctuation\\">}</span></span>-<span class=\\"token interpolation\\"><span class=\\"token punctuation\\">$</span><span class=\\"token punctuation\\">{</span><span class=\\"token keyword\\">local</span><span class=\\"token punctuation\\">.</span><span class=\\"token type variable\\">timestamp</span><span class=\\"token punctuation\\">}</span></span>\\"</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">os_type</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"Linux\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\"># az vm image list-publishers --location koreacentral --output table</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">image_publisher</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"RedHat\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\"># az vm image list-offers --location koreacentral --publisher RedHat --output table</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">image_offer</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"RHEL\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\"># az vm image list-skus --location koreacentral --publisher RedHat --offer RHEL --output table</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">image_sku</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"8_4\\"</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">azure_tags</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    <span class=\\"token property\\">dept</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"KBHC Terraform POC\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">  </span>\\n<span class=\\"line\\">  <span class=\\"token comment\\"># az vm list-skus --location koreacentral --all --output table</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">build_resource_group_name</span> <span class=\\"token punctuation\\">=</span> local.resource_group_name</span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\">#########################################</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\"># 기존 생성되어있는 network 를 사용하기 위한 항목 #</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\">#########################################</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">virtual_network_name</span> <span class=\\"token punctuation\\">=</span> local.virtual_network_name</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">virtual_network_subnet_name</span> <span class=\\"token punctuation\\">=</span> local.virtual_network_subnet_name</span>\\n<span class=\\"line\\">  <span class=\\"token property\\">virtual_network_resource_group_name</span> <span class=\\"token punctuation\\">=</span> local.virtual_network_resource_group_name</span>\\n<span class=\\"line\\">  </span>\\n<span class=\\"line\\">  <span class=\\"token comment\\"># location = \\"koreacentral\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">vm_size</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"Standard_A2_v2\\"</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">build</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">sources</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"sources.azure-arm.basic-example\\"</span><span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">  <span class=\\"token keyword\\">provisioner<span class=\\"token type variable\\"> \\"file\\" </span></span><span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    <span class=\\"token property\\">source</span>      <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"./files/\\"</span></span>\\n<span class=\\"line\\">    <span class=\\"token property\\">destination</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"/tmp\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token comment\\"># Vault OTP</span></span>\\n<span class=\\"line\\">  <span class=\\"token keyword\\">provisioner<span class=\\"token type variable\\"> \\"shell\\" </span></span><span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    <span class=\\"token property\\">inline</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span></span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo cp /tmp/sshd /etc/pam.d/sshd\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo cp /tmp/sshd_config /etc/ssh/sshd_config\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo mkdir -p /etc/vault.d\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo cp /tmp/vault.hcl /etc/vault.d/vault.hcl\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo cp /tmp/vault-ssh-helper /usr/bin/vault-ssh-helper\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"echo \\\\\\"=== Vault_Check ===\\\\\\"\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"curl http://10.0.9.10:8200\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"/usr/bin/vault-ssh-helper -verify-only -config=/etc/vault.d/vault.hcl -dev\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"echo \\\\\\"=== Add User ===\\\\\\"\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo adduser jboss\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"echo password | sudo passwd --stdin jboss\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"echo 'jboss ALL=(ALL) NOPASSWD: ALL' | sudo tee -a /etc/sudoers\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"echo \\\\\\"=== SELINUX DISABLE ===\\\\\\"\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo sed -ie 's/SELINUX=enforcing/SELINUX=disabled /g' /etc/selinux/config\\"</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token comment\\"># Apache</span></span>\\n<span class=\\"line\\">  <span class=\\"token keyword\\">provisioner<span class=\\"token type variable\\"> \\"shell\\" </span></span><span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    <span class=\\"token property\\">inline</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span></span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo yum -y update\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sleep 15\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo yum -y update\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo yum -y install httpd\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo systemctl enable httpd\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo systemctl start httpd\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"chmod +x /tmp/deploy_app.sh\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo PLACEHOLDER=<span class=\\"token interpolation\\"><span class=\\"token punctuation\\">$</span><span class=\\"token punctuation\\">{</span><span class=\\"token keyword\\">var</span><span class=\\"token punctuation\\">.</span><span class=\\"token type variable\\">placeholder</span><span class=\\"token punctuation\\">}</span></span> WIDTH=600 HEIGHT=800 PREFIX=gs /tmp/deploy_app.sh\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo firewall-cmd --zone=public --permanent --add-port=80/tcp\\"</span>,</span>\\n<span class=\\"line\\">      <span class=\\"token string\\">\\"sudo firewall-cmd --reload\\"</span>,</span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span></code></pre></div>"}`);export{d as comp,k as data};
