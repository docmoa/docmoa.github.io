import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o as t,c as e,a as s,b as l,w as c,h as i,g as o}from"./app-DVMlqOhY.js";const u={},r=s("h1",{id:"vaultkv",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#vaultkv"},[s("span",null,"vaultKV")])],-1),k=s("h2",{id:"nomad-job에서-vault의-secret에서-kv사용하기",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#nomad-job에서-vault의-secret에서-kv사용하기"},[s("span",null,"nomad job에서 vault의 secret에서 kv사용하기")])],-1),d=i(`<h2 id="nomad-hcl-설정" tabindex="-1"><a class="header-anchor" href="#nomad-hcl-설정"><span>nomad hcl 설정</span></a></h2><div class="language-hcl line-numbers-mode" data-highlighter="prismjs" data-ext="hcl" data-title="hcl"><pre class="language-hcl"><code><span class="line">job <span class="token string">&quot;logs&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">datacenters</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;dc1&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">constraint</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">attribute</span> <span class="token punctuation">=</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>attr<span class="token punctuation">.</span>kernel<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>&quot;</span></span>
<span class="line">        <span class="token property">value</span> <span class="token punctuation">=</span> <span class="token string">&quot;linux&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">update</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">stagger</span> <span class="token punctuation">=</span> <span class="token string">&quot;10s&quot;</span></span>
<span class="line">        <span class="token property">max_parallel</span> <span class="token punctuation">=</span> <span class="token number">1</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    group <span class="token string">&quot;elk&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">count</span> <span class="token punctuation">=</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">restart</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">attempts</span> <span class="token punctuation">=</span> <span class="token number">2</span></span>
<span class="line">            <span class="token property">interval</span> <span class="token punctuation">=</span> <span class="token string">&quot;1m&quot;</span></span>
<span class="line">            <span class="token property">delay</span> <span class="token punctuation">=</span> <span class="token string">&quot;15s&quot;</span></span>
<span class="line">            <span class="token property">mode</span> <span class="token punctuation">=</span> <span class="token string">&quot;delay&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">network</span> <span class="token punctuation">{</span></span>
<span class="line">          port <span class="token string">&quot;elk&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">to</span>     <span class="token punctuation">=</span> <span class="token number">9200</span></span>
<span class="line">            <span class="token property">static</span> <span class="token punctuation">=</span> <span class="token number">9200</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">          port <span class="token string">&quot;kibana&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">to</span>     <span class="token punctuation">=</span> <span class="token number">5601</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">          port <span class="token string">&quot;logstash&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">to</span>     <span class="token punctuation">=</span> <span class="token number">5000</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        task <span class="token string">&quot;elasticsearch&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">driver</span> <span class="token punctuation">=</span> <span class="token string">&quot;docker&quot;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">vault</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">policies</span>  <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">]</span></span>
<span class="line">              <span class="token property">change_mode</span>   <span class="token punctuation">=</span> <span class="token string">&quot;signal&quot;</span></span>
<span class="line">              <span class="token property">change_signal</span> <span class="token punctuation">=</span> <span class="token string">&quot;SIGINT&quot;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">config</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">image</span> <span class="token punctuation">=</span> <span class="token string">&quot;elasticsearch:7.16.2&quot;</span></span>
<span class="line">                <span class="token property">ports</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;elk&quot;</span><span class="token punctuation">]</span></span>
<span class="line">                <span class="token property">volumes</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token string">&quot;local/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml&quot;</span>,</span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">template</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">data</span> <span class="token punctuation">=</span> <span class="token heredoc string">&lt;&lt;EOF</span>
<span class="line">cluster.name: &quot;my-cluster&quot;</span>
<span class="line">network.host: 0.0.0.0</span>
<span class="line">discovery.type: single-node</span>
<span class="line">discovery.seed_hosts: [&quot;127.0.0.1&quot;]</span>
<span class="line">xpack.security.enabled: true</span>
<span class="line">xpack.license.self_generated.type: trial</span>
<span class="line">xpack.monitoring.collection.enabled: true</span>
<span class="line">EOF</span></span>
<span class="line">        <span class="token property">destination</span>   <span class="token punctuation">=</span> <span class="token string">&quot;local/elasticsearch.yml&quot;</span></span>
<span class="line">        <span class="token property">change_mode</span>   <span class="token punctuation">=</span> <span class="token string">&quot;signal&quot;</span></span>
<span class="line">        <span class="token property">change_signal</span> <span class="token punctuation">=</span> <span class="token string">&quot;SIGHUP&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">template</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">data</span> <span class="token punctuation">=</span> <span class="token heredoc string">&lt;&lt;EOH</span>
<span class="line">ELASTIC_PASSWORD=&quot;{{with secret &quot;secret/elastic&quot;}}{{.Data.passwd}}{{end}}&quot;</span>
<span class="line">EOH</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">destination</span> <span class="token punctuation">=</span> <span class="token string">&quot;secrets/file.env&quot;</span></span>
<span class="line">  <span class="token property">env</span>         <span class="token punctuation">=</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">service</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>TASKGROUP<span class="token punctuation">}</span></span>-elasticsearch&quot;</span></span>
<span class="line">                <span class="token property">port</span> <span class="token punctuation">=</span> <span class="token string">&quot;elk&quot;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">resources</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">cpu</span> <span class="token punctuation">=</span> <span class="token number">500</span></span>
<span class="line">                <span class="token property">memory</span> <span class="token punctuation">=</span> <span class="token number">1048</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        task <span class="token string">&quot;kibana&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">driver</span> <span class="token punctuation">=</span> <span class="token string">&quot;docker&quot;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">vault</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">policies</span>  <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">]</span></span>
<span class="line">              <span class="token property">change_mode</span>   <span class="token punctuation">=</span> <span class="token string">&quot;signal&quot;</span></span>
<span class="line">              <span class="token property">change_signal</span> <span class="token punctuation">=</span> <span class="token string">&quot;SIGINT&quot;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">config</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">image</span> <span class="token punctuation">=</span> <span class="token string">&quot;kibana:7.16.2&quot;</span></span>
<span class="line">                <span class="token property">ports</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;kibana&quot;</span><span class="token punctuation">]</span></span>
<span class="line">                <span class="token property">volumes</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token string">&quot;local/kibana.yml:/usr/share/kibana/config/kibana.yml&quot;</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">template</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">data</span> <span class="token punctuation">=</span> <span class="token heredoc string">&lt;&lt;EOF</span>
<span class="line">#</span>
<span class="line"># ** THIS IS AN AUTO-GENERATED FILE **</span>
<span class="line">#</span>
<span class="line"></span>
<span class="line"># Default Kibana configuration for docker target</span>
<span class="line">server.host: &quot;0.0.0.0&quot;</span>
<span class="line">server.shutdownTimeout: &quot;5s&quot;</span>
<span class="line">elasticsearch.hosts: [ &quot;http://{{ env &quot;NOMAD_IP_elk&quot; }}:{{ env &quot;NOMAD_PORT_elk&quot; }}&quot; ]</span>
<span class="line">elasticsearch.username: elastic</span>
<span class="line">{{ with secret &quot;secret/elastic&quot; }}</span>
<span class="line">elasticsearch.password: {{.Data.passwd}}</span>
<span class="line">{{ end }}</span>
<span class="line"></span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line">        <span class="token property">destination</span>   <span class="token punctuation">=</span> <span class="token string">&quot;local/kibana.yml&quot;</span></span>
<span class="line">        <span class="token property">change_mode</span>   <span class="token punctuation">=</span> <span class="token string">&quot;signal&quot;</span></span>
<span class="line">        <span class="token property">change_signal</span> <span class="token punctuation">=</span> <span class="token string">&quot;SIGHUP&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">service</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>TASKGROUP<span class="token punctuation">}</span></span>-kibana&quot;</span></span>
<span class="line">                <span class="token property">port</span> <span class="token punctuation">=</span> <span class="token string">&quot;kibana&quot;</span></span>
<span class="line">                <span class="token keyword">check</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token property">type</span> <span class="token punctuation">=</span> <span class="token string">&quot;http&quot;</span></span>
<span class="line">                    <span class="token property">path</span> <span class="token punctuation">=</span> <span class="token string">&quot;/&quot;</span></span>
<span class="line">                    <span class="token property">interval</span> <span class="token punctuation">=</span> <span class="token string">&quot;10s&quot;</span></span>
<span class="line">                    <span class="token property">timeout</span> <span class="token punctuation">=</span> <span class="token string">&quot;2s&quot;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">resources</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">cpu</span> <span class="token punctuation">=</span> <span class="token number">500</span></span>
<span class="line">                <span class="token property">memory</span> <span class="token punctuation">=</span> <span class="token number">1200</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        task <span class="token string">&quot;logstash&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">driver</span> <span class="token punctuation">=</span> <span class="token string">&quot;docker&quot;</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">config</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">image</span> <span class="token punctuation">=</span> <span class="token string">&quot;logstash:7.16.2&quot;</span></span>
<span class="line">                <span class="token property">ports</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;logstash&quot;</span><span class="token punctuation">]</span></span>
<span class="line">                <span class="token property">volumes</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token string">&quot;local/logstash.yml:/usr/share/logstash/config/logstash.yml&quot;</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">template</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">data</span> <span class="token punctuation">=</span> <span class="token heredoc string">&lt;&lt;EOF</span>
<span class="line">http.host: &quot;0.0.0.0&quot;</span>
<span class="line">xpack.monitoring.elasticsearch.hosts: [ &quot;http://{{ env &quot;NOMAD_IP_elk&quot; }}:{{ env &quot;NOMAD_PORT_elk&quot; }}&quot; ]</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line">        <span class="token property">destination</span>   <span class="token punctuation">=</span> <span class="token string">&quot;local/logstash.yml&quot;</span></span>
<span class="line">        <span class="token property">change_mode</span>   <span class="token punctuation">=</span> <span class="token string">&quot;signal&quot;</span></span>
<span class="line">        <span class="token property">change_signal</span> <span class="token punctuation">=</span> <span class="token string">&quot;SIGHUP&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">service</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>TASKGROUP<span class="token punctuation">}</span></span>-logstash&quot;</span></span>
<span class="line">                <span class="token property">port</span> <span class="token punctuation">=</span> <span class="token string">&quot;logstash&quot;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">            <span class="token keyword">resources</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token property">cpu</span> <span class="token punctuation">=</span> <span class="token number">200</span></span>
<span class="line">                <span class="token property">memory</span> <span class="token punctuation">=</span> <span class="token number">1024</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2);function v(m,b){const n=p("RouteLink");return t(),e("div",null,[r,k,s("ul",null,[s("li",null,[l(n,{to:"/04-HashiCorp/07-Nomad/02-Config/integrateVault.html"},{default:c(()=>[o("Nomad 설정 링크")]),_:1})])]),d])}const h=a(u,[["render",v],["__file","withVaultKV.html.vue"]]),q=JSON.parse('{"path":"/04-HashiCorp/07-Nomad/05-SampleJob/withVaultKV.html","title":"vaultKV","lang":"ko-KR","frontmatter":{"description":"Nomad Sample","tag":["Nomad","Sample","Job"],"head":[["meta",{"property":"og:url","content":"https://docmoa.github.io/04-HashiCorp/07-Nomad/05-SampleJob/withVaultKV.html"}],["meta",{"property":"og:site_name","content":"docmoa"}],["meta",{"property":"og:title","content":"vaultKV"}],["meta",{"property":"og:description","content":"Nomad Sample"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2023-09-18T13:12:54.000Z"}],["meta",{"property":"article:tag","content":"Nomad"}],["meta",{"property":"article:tag","content":"Sample"}],["meta",{"property":"article:tag","content":"Job"}],["meta",{"property":"article:modified_time","content":"2023-09-18T13:12:54.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"vaultKV\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-09-18T13:12:54.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"nomad job에서 vault의 secret에서 kv사용하기","slug":"nomad-job에서-vault의-secret에서-kv사용하기","link":"#nomad-job에서-vault의-secret에서-kv사용하기","children":[]},{"level":2,"title":"nomad hcl 설정","slug":"nomad-hcl-설정","link":"#nomad-hcl-설정","children":[]}],"git":{"createdTime":1642040133000,"updatedTime":1695042774000,"contributors":[{"name":"Great-Stone","email":"hahohh@gmail.com","commits":1},{"name":"ung","email":"swbs90@naver.com","commits":1}]},"readingTime":{"minutes":4.3,"words":258},"filePathRelative":"04-HashiCorp/07-Nomad/05-SampleJob/withVaultKV.md","localizedDate":"2022년 1월 13일","excerpt":"\\n<h2>nomad job에서 vault의 secret에서 kv사용하기</h2>\\n<ul>\\n<li><a href=\\"/04-HashiCorp/07-Nomad/02-Config/integrateVault.html\\" target=\\"_blank\\">Nomad 설정 링크</a></li>\\n</ul>\\n<h2>nomad hcl 설정</h2>\\n<div class=\\"language-hcl\\" data-highlighter=\\"prismjs\\" data-ext=\\"hcl\\" data-title=\\"hcl\\"><pre class=\\"language-hcl\\"><code><span class=\\"line\\">job <span class=\\"token string\\">\\"logs\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    <span class=\\"token property\\">datacenters</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"dc1\\"</span><span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">constraint</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">attribute</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"<span class=\\"token interpolation\\"><span class=\\"token punctuation\\">$</span><span class=\\"token punctuation\\">{</span>attr<span class=\\"token punctuation\\">.</span>kernel<span class=\\"token punctuation\\">.</span>name<span class=\\"token punctuation\\">}</span></span>\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">value</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"linux\\"</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">update</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">stagger</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"10s\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">max_parallel</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">1</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    group <span class=\\"token string\\">\\"elk\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">count</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">1</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">restart</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">attempts</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">2</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">interval</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"1m\\"</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">delay</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"15s\\"</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">mode</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"delay\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">network</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">          port <span class=\\"token string\\">\\"elk\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">to</span>     <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">9200</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">static</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">9200</span></span>\\n<span class=\\"line\\">          <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">          port <span class=\\"token string\\">\\"kibana\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">to</span>     <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">5601</span></span>\\n<span class=\\"line\\">          <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">          port <span class=\\"token string\\">\\"logstash\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">to</span>     <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">5000</span></span>\\n<span class=\\"line\\">          <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">        task <span class=\\"token string\\">\\"elasticsearch\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">driver</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"docker\\"</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">vault</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">              <span class=\\"token property\\">policies</span>  <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"admin\\"</span><span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">              <span class=\\"token property\\">change_mode</span>   <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"signal\\"</span></span>\\n<span class=\\"line\\">              <span class=\\"token property\\">change_signal</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"SIGINT\\"</span></span>\\n<span class=\\"line\\">            <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">config</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">image</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"elasticsearch:7.16.2\\"</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">ports</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"elk\\"</span><span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">volumes</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span></span>\\n<span class=\\"line\\">          <span class=\\"token string\\">\\"local/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml\\"</span>,</span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">      <span class=\\"token keyword\\">template</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">data</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token heredoc string\\">&lt;&lt;EOF</span>\\n<span class=\\"line\\">cluster.name: \\"my-cluster\\"</span>\\n<span class=\\"line\\">network.host: 0.0.0.0</span>\\n<span class=\\"line\\">discovery.type: single-node</span>\\n<span class=\\"line\\">discovery.seed_hosts: [\\"127.0.0.1\\"]</span>\\n<span class=\\"line\\">xpack.security.enabled: true</span>\\n<span class=\\"line\\">xpack.license.self_generated.type: trial</span>\\n<span class=\\"line\\">xpack.monitoring.collection.enabled: true</span>\\n<span class=\\"line\\">EOF</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">destination</span>   <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"local/elasticsearch.yml\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">change_mode</span>   <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"signal\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">change_signal</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"SIGHUP\\"</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">      <span class=\\"token keyword\\">template</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">data</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token heredoc string\\">&lt;&lt;EOH</span>\\n<span class=\\"line\\">ELASTIC_PASSWORD=\\"{{with secret \\"secret/elastic\\"}}{{.Data.passwd}}{{end}}\\"</span>\\n<span class=\\"line\\">EOH</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">destination</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"secrets/file.env\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">env</span>         <span class=\\"token punctuation\\">=</span> <span class=\\"token boolean\\">true</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">service</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">name</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"<span class=\\"token interpolation\\"><span class=\\"token punctuation\\">$</span><span class=\\"token punctuation\\">{</span>TASKGROUP<span class=\\"token punctuation\\">}</span></span>-elasticsearch\\"</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">port</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"elk\\"</span></span>\\n<span class=\\"line\\">            <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">resources</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">cpu</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">500</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">memory</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">1048</span></span>\\n<span class=\\"line\\">            <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">        task <span class=\\"token string\\">\\"kibana\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">driver</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"docker\\"</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">vault</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">              <span class=\\"token property\\">policies</span>  <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"admin\\"</span><span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">              <span class=\\"token property\\">change_mode</span>   <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"signal\\"</span></span>\\n<span class=\\"line\\">              <span class=\\"token property\\">change_signal</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"SIGINT\\"</span></span>\\n<span class=\\"line\\">            <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">config</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">image</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"kibana:7.16.2\\"</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">ports</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"kibana\\"</span><span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">volumes</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span></span>\\n<span class=\\"line\\">          <span class=\\"token string\\">\\"local/kibana.yml:/usr/share/kibana/config/kibana.yml\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">      <span class=\\"token keyword\\">template</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">data</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token heredoc string\\">&lt;&lt;EOF</span>\\n<span class=\\"line\\">#</span>\\n<span class=\\"line\\"># ** THIS IS AN AUTO-GENERATED FILE **</span>\\n<span class=\\"line\\">#</span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"># Default Kibana configuration for docker target</span>\\n<span class=\\"line\\">server.host: \\"0.0.0.0\\"</span>\\n<span class=\\"line\\">server.shutdownTimeout: \\"5s\\"</span>\\n<span class=\\"line\\">elasticsearch.hosts: [ \\"http://{{ env \\"NOMAD_IP_elk\\" }}:{{ env \\"NOMAD_PORT_elk\\" }}\\" ]</span>\\n<span class=\\"line\\">elasticsearch.username: elastic</span>\\n<span class=\\"line\\">{{ with secret \\"secret/elastic\\" }}</span>\\n<span class=\\"line\\">elasticsearch.password: {{.Data.passwd}}</span>\\n<span class=\\"line\\">{{ end }}</span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">EOF</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">destination</span>   <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"local/kibana.yml\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">change_mode</span>   <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"signal\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">change_signal</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"SIGHUP\\"</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">service</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">name</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"<span class=\\"token interpolation\\"><span class=\\"token punctuation\\">$</span><span class=\\"token punctuation\\">{</span>TASKGROUP<span class=\\"token punctuation\\">}</span></span>-kibana\\"</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">port</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"kibana\\"</span></span>\\n<span class=\\"line\\">                <span class=\\"token keyword\\">check</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                    <span class=\\"token property\\">type</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"http\\"</span></span>\\n<span class=\\"line\\">                    <span class=\\"token property\\">path</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"/\\"</span></span>\\n<span class=\\"line\\">                    <span class=\\"token property\\">interval</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"10s\\"</span></span>\\n<span class=\\"line\\">                    <span class=\\"token property\\">timeout</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"2s\\"</span></span>\\n<span class=\\"line\\">                <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">            <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">resources</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">cpu</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">500</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">memory</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">1200</span></span>\\n<span class=\\"line\\">            <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">        task <span class=\\"token string\\">\\"logstash\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">            <span class=\\"token property\\">driver</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"docker\\"</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">config</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">image</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"logstash:7.16.2\\"</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">ports</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"logstash\\"</span><span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">volumes</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span></span>\\n<span class=\\"line\\">          <span class=\\"token string\\">\\"local/logstash.yml:/usr/share/logstash/config/logstash.yml\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">      <span class=\\"token keyword\\">template</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">data</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token heredoc string\\">&lt;&lt;EOF</span>\\n<span class=\\"line\\">http.host: \\"0.0.0.0\\"</span>\\n<span class=\\"line\\">xpack.monitoring.elasticsearch.hosts: [ \\"http://{{ env \\"NOMAD_IP_elk\\" }}:{{ env \\"NOMAD_PORT_elk\\" }}\\" ]</span>\\n<span class=\\"line\\">EOF</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">destination</span>   <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"local/logstash.yml\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">change_mode</span>   <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"signal\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">change_signal</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"SIGHUP\\"</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">service</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">name</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"<span class=\\"token interpolation\\"><span class=\\"token punctuation\\">$</span><span class=\\"token punctuation\\">{</span>TASKGROUP<span class=\\"token punctuation\\">}</span></span>-logstash\\"</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">port</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"logstash\\"</span></span>\\n<span class=\\"line\\">            <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">resources</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">cpu</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">200</span></span>\\n<span class=\\"line\\">                <span class=\\"token property\\">memory</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">1024</span></span>\\n<span class=\\"line\\">            <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span></code></pre></div>"}');export{h as comp,q as data};
