import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as e,c as a,h as n}from"./app-DVMlqOhY.js";const s={},r=n(`<h1 id="_05-테라폼-상태파일-state" tabindex="-1"><a class="header-anchor" href="#_05-테라폼-상태파일-state"><span>05. 테라폼 상태파일(State)</span></a></h1><h2 id="terraform-state" tabindex="-1"><a class="header-anchor" href="#terraform-state"><span>Terraform State</span></a></h2><p>Terraform은 <sub>stateful</sub> 애플리케이션입니다. 즉, state file 내부에서 빌드 한 모든 내용을 추적합니다.</p><p>앞서의 실습에서 반복된 <code>Apply</code> 작업 간에 Workspace 디렉토리에 나타난 <code>terraform.tfstate</code> 및 <code>terraform.tfstate.backup</code> 파일을 보셨을 것입니다.</p><p>상태 파일은 Terraform이 알고있는 모든 것에 대한 기록 소스입니다.</p><div class="hint-container info"><p class="hint-container-title">파일 구조</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">WORKSPACE</span>
<span class="line">├── files</span>
<span class="line">│   └── deploy_app.sh</span>
<span class="line">├── main.tf</span>
<span class="line">├── outputs.tf</span>
<span class="line">├── <span class="token variable"><span class="token variable">\`</span>terraform.tfstate<span class="token variable">\`</span></span></span>
<span class="line">├── <span class="token variable"><span class="token variable">\`</span>terraform.tfstate.backup<span class="token variable">\`</span></span></span>
<span class="line">├── terraform.tfvars</span>
<span class="line">└── variables.tf</span>
<span class="line"></span></code></pre></div></div><p>State 파일 내부는 JSON 형식으로 구성되어있습니다.</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre class="language-json"><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;terraform_version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.12.7&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;serial&quot;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;lineage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;452b4191-89f6-db17-a3b1-4470dcb00607&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;outputs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;catapp_url&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;value&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://go-hashicat-5c0265179ccda553.workshop.aws.hashidemos.io&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="terraform-refresh" tabindex="-1"><a class="header-anchor" href="#terraform-refresh"><span>Terraform Refresh</span></a></h2><p>때때로 인프라는 Terraform이 통제하는 범위 밖에서 변경 될 수 있습니다. (수동으로 UI에서 변경 등)</p><p>State 파일은 인프라의 마지막으로 갱신된 상태를 나타냅니다. 상태 파일이 빌드 한 파일과 여전히 일치하는지 확인하고 확인하려면 <code>terraform refresh</code> 명령을 사용할 수 있습니다.</p><p>이것은 인프라를 업데이트하지 않는 상태 파일 만 업데이트합니다.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">terraform refresh</span>
<span class="line"></span></code></pre></div><h2 id="기존-인프라-변경" tabindex="-1"><a class="header-anchor" href="#기존-인프라-변경"><span>기존 인프라 변경</span></a></h2><p>계획을 실행하거나 적용 할 때마다 Terraform은 세 가지 데이터 소스를 조정합니다.</p><ol><li>코드에 작성한 내용</li><li>상태 파일</li><li>실제로 존재하는 것</li></ol><p>Terraform은 <code>*.tf</code> 파일에있는 내용을 기반으로 기존 리소스를 추가, 삭제, 변경 또는 교체하기 위해 <mark>최선</mark> 을 다합니다. 다음은 Plan/Apply 중에 각 리소스에 발생할 수있는 네 가지 사항입니다.</p><div class="language-diff" data-highlighter="prismjs" data-ext="diff" data-title="diff"><pre class="language-diff"><code><span class="line"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   create</span>
<span class="line"></span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">   destroy</span>
<span class="line"></span><span class="token prefix deleted">-</span><span class="token line">/+ replace</span>
<span class="line"></span></span>~   update in-place</span>
<span class="line"></span></code></pre></div><div class="hint-container warning"><p class="hint-container-title">경고</p><p>무엇인가 변경할때 <code>-/+ replace</code>가 발생하는지 확인하세요. 이것은 기존 리소스를 삭제하고 다시 생성합니다.</p></div><h2 id="terraform-state-quiz" tabindex="-1"><a class="header-anchor" href="#terraform-state-quiz"><span>😱 Terraform State Quiz :</span></a></h2><p>각 시나리오에서 어떤 일이 발생합니까? 논의해 볼까요?</p><table><thead><tr><th style="text-align:center;">Configuration(.tf)</th><th style="text-align:center;">State</th><th style="text-align:center;">Reality</th><th style="text-align:center;">Operation</th></tr></thead><tbody><tr><td style="text-align:center;">ncloud_server</td><td style="text-align:center;"></td><td style="text-align:center;"></td><td style="text-align:center;">???</td></tr><tr><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;"></td><td style="text-align:center;">???</td></tr><tr><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">???</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">???</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;"></td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">???</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;"></td><td style="text-align:center;">???</td></tr></tbody></table><details class="hint-container details"><summary>답</summary><table><thead><tr><th style="text-align:center;">Configuration(.tf)</th><th style="text-align:center;">State</th><th style="text-align:center;">Reality</th><th style="text-align:center;">Operation</th></tr></thead><tbody><tr><td style="text-align:center;">ncloud_server</td><td style="text-align:center;"></td><td style="text-align:center;"></td><td style="text-align:center;">create</td></tr><tr><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;"></td><td style="text-align:center;">create</td></tr><tr><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">-</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">delete</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;"></td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;">-</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;">ncloud_server</td><td style="text-align:center;"></td><td style="text-align:center;">update state</td></tr></tbody></table></details>`,23),l=[r];function o(p,i){return e(),a("div",null,l)}const u=t(s,[["render",o],["__file","05-terraform-state.html.vue"]]),m=JSON.parse('{"path":"/03-PublicCloud/NCP/09-Terraform-Workshop/01-intro_to_terraform_on_ncp/05-terraform-state.html","title":"05. 테라폼 상태파일(State)","lang":"ko-KR","frontmatter":{"description":"Naver Cloud Platform에서의 Terraform 실습","tag":["ncloud","ncp","terraform","workshop"],"head":[["meta",{"property":"og:url","content":"https://docmoa.github.io/03-PublicCloud/NCP/09-Terraform-Workshop/01-intro_to_terraform_on_ncp/05-terraform-state.html"}],["meta",{"property":"og:site_name","content":"docmoa"}],["meta",{"property":"og:title","content":"05. 테라폼 상태파일(State)"}],["meta",{"property":"og:description","content":"Naver Cloud Platform에서의 Terraform 실습"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2023-09-19T11:31:31.000Z"}],["meta",{"property":"article:tag","content":"ncloud"}],["meta",{"property":"article:tag","content":"ncp"}],["meta",{"property":"article:tag","content":"terraform"}],["meta",{"property":"article:tag","content":"workshop"}],["meta",{"property":"article:modified_time","content":"2023-09-19T11:31:31.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"05. 테라폼 상태파일(State)\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-09-19T11:31:31.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Terraform State","slug":"terraform-state","link":"#terraform-state","children":[]},{"level":2,"title":"Terraform Refresh","slug":"terraform-refresh","link":"#terraform-refresh","children":[]},{"level":2,"title":"기존 인프라 변경","slug":"기존-인프라-변경","link":"#기존-인프라-변경","children":[]},{"level":2,"title":"😱 Terraform State Quiz :","slug":"terraform-state-quiz","link":"#terraform-state-quiz","children":[]}],"git":{"createdTime":1634784217000,"updatedTime":1695123091000,"contributors":[{"name":"Great-Stone","email":"hahohh@gmail.com","commits":2}]},"readingTime":{"minutes":2.38,"words":143},"filePathRelative":"03-PublicCloud/NCP/09-Terraform-Workshop/01-intro_to_terraform_on_ncp/05-terraform-state.md","localizedDate":"2021년 10월 21일","excerpt":"\\n<h2>Terraform State</h2>\\n<p>Terraform은 <sub>stateful</sub> 애플리케이션입니다. 즉, state file 내부에서 빌드 한 모든 내용을 추적합니다.</p>\\n<p>앞서의 실습에서 반복된 <code>Apply</code> 작업 간에 Workspace 디렉토리에 나타난 <code>terraform.tfstate</code> 및 <code>terraform.tfstate.backup</code> 파일을 보셨을 것입니다.</p>\\n<p>상태 파일은 Terraform이 알고있는 모든 것에 대한 기록 소스입니다.</p>"}');export{u as comp,m as data};
