import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,h as p}from"./app-DVMlqOhY.js";const e={},t=p(`<h1 id="service-mesh-test" tabindex="-1"><a class="header-anchor" href="#service-mesh-test"><span>Service Mesh Test</span></a></h1><p>HashiCorp 공식 Service Mesh Test App</p><p><a href="https://learn.hashicorp.com/tutorials/nomad/consul-service-mesh" target="_blank" rel="noopener noreferrer">https://learn.hashicorp.com/tutorials/nomad/consul-service-mesh</a></p><div class="language-hcl line-numbers-mode" data-highlighter="prismjs" data-ext="hcl" data-title="hcl"><pre class="language-hcl"><code><span class="line">job <span class="token string">&quot;countdash&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">region</span>      <span class="token punctuation">=</span> <span class="token string">&quot;global&quot;</span></span>
<span class="line">  <span class="token property">datacenters</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;dc1&quot;</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token comment"># namespace   = &quot;mesh&quot;</span></span>
<span class="line"></span>
<span class="line">  group <span class="token string">&quot;api&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">network</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">mode</span> <span class="token punctuation">=</span> <span class="token string">&quot;bridge&quot;</span></span>
<span class="line">      port <span class="token string">&quot;api&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">to</span> <span class="token punctuation">=</span> <span class="token number">9001</span> <span class="token comment"># static 설정이 없으므로 컨테이너의 앱 9001과 노출되는 임의의 포트와 맵핑</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">service</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;count-api&quot;</span></span>
<span class="line">      <span class="token property">port</span> <span class="token punctuation">=</span> <span class="token string">&quot;api&quot;</span> <span class="token comment"># 임의의 포트 할당을 network port id로 지정</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">connect</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">sidecar_service</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    task <span class="token string">&quot;web&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">driver</span> <span class="token punctuation">=</span> <span class="token string">&quot;docker&quot;</span></span>
<span class="line">      <span class="token keyword">config</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">image</span> <span class="token punctuation">=</span> <span class="token string">&quot;hashicorpnomad/counter-api:v1&quot;</span></span>
<span class="line">        <span class="token property">ports</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;api&quot;</span><span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  group <span class="token string">&quot;dashboard&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">network</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">mode</span> <span class="token punctuation">=</span> <span class="token string">&quot;bridge&quot;</span></span>
<span class="line">      port <span class="token string">&quot;http&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">static</span> <span class="token punctuation">=</span> <span class="token number">9002</span> <span class="token comment"># 컨테이너 앱 9002와 외부노출되는 사용자 지정 static port를 맵핑</span></span>
<span class="line">        <span class="token property">to</span>     <span class="token punctuation">=</span> <span class="token number">9002</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">service</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">name</span> <span class="token punctuation">=</span> <span class="token string">&quot;count-dashboard&quot;</span></span>
<span class="line">      <span class="token property">port</span> <span class="token punctuation">=</span> <span class="token string">&quot;http&quot;</span> <span class="token comment"># 할당된 포트를 network port id로 지정</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">connect</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">sidecar_service</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">proxy</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">upstreams</span> <span class="token punctuation">{</span></span>
<span class="line">              <span class="token property">destination_name</span> <span class="token punctuation">=</span> <span class="token string">&quot;count-api&quot;</span></span>
<span class="line">              <span class="token property">local_bind_port</span>  <span class="token punctuation">=</span> <span class="token number">8080</span> <span class="token comment"># backend인 count-api의 실제 port와는 별개로 frontend가 호출할 port 지정</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    task <span class="token string">&quot;dashboard&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">driver</span> <span class="token punctuation">=</span> <span class="token string">&quot;docker&quot;</span></span>
<span class="line">      <span class="token keyword">env</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">COUNTING_SERVICE_URL</span> <span class="token punctuation">=</span> <span class="token string">&quot;http://<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>NOMAD_UPSTREAM_ADDR_count_api<span class="token punctuation">}</span></span>&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">      <span class="token keyword">config</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">image</span> <span class="token punctuation">=</span> <span class="token string">&quot;hashicorpnomad/counter-dashboard:v1&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">scaling</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">enabled</span> <span class="token punctuation">=</span> <span class="token boolean">true</span></span>
<span class="line">      <span class="token property">min</span> <span class="token punctuation">=</span> <span class="token number">1</span></span>
<span class="line">      <span class="token property">max</span> <span class="token punctuation">=</span> <span class="token number">10</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),c=[t];function l(o,i){return s(),a("div",null,c)}const k=n(e,[["render",l],["__file","service-mesh-test.html.vue"]]),d=JSON.parse('{"path":"/04-HashiCorp/07-Nomad/05-SampleJob/service-mesh-test.html","title":"Service Mesh Test","lang":"ko-KR","frontmatter":{"description":"Nomad + Consul Sample","tag":["Nomad","Consul","Sample","Job","Service Mesh"],"head":[["meta",{"property":"og:url","content":"https://docmoa.github.io/04-HashiCorp/07-Nomad/05-SampleJob/service-mesh-test.html"}],["meta",{"property":"og:site_name","content":"docmoa"}],["meta",{"property":"og:title","content":"Service Mesh Test"}],["meta",{"property":"og:description","content":"Nomad + Consul Sample"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2023-09-18T13:12:54.000Z"}],["meta",{"property":"article:tag","content":"Nomad"}],["meta",{"property":"article:tag","content":"Consul"}],["meta",{"property":"article:tag","content":"Sample"}],["meta",{"property":"article:tag","content":"Job"}],["meta",{"property":"article:tag","content":"Service Mesh"}],["meta",{"property":"article:modified_time","content":"2023-09-18T13:12:54.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Service Mesh Test\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-09-18T13:12:54.000Z\\",\\"author\\":[]}"]]},"headers":[],"git":{"createdTime":1632449108000,"updatedTime":1695042774000,"contributors":[{"name":"Administrator","email":"admin@example.com","commits":1},{"name":"Great-Stone","email":"hahohh@gmail.com","commits":1}]},"readingTime":{"minutes":2.07,"words":124},"filePathRelative":"04-HashiCorp/07-Nomad/05-SampleJob/service-mesh-test.md","localizedDate":"2021년 9월 24일","excerpt":"\\n<p>HashiCorp 공식 Service Mesh Test App</p>\\n<p><a href=\\"https://learn.hashicorp.com/tutorials/nomad/consul-service-mesh\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://learn.hashicorp.com/tutorials/nomad/consul-service-mesh</a></p>\\n<div class=\\"language-hcl\\" data-highlighter=\\"prismjs\\" data-ext=\\"hcl\\" data-title=\\"hcl\\"><pre class=\\"language-hcl\\"><code><span class=\\"line\\">job <span class=\\"token string\\">\\"countdash\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">region</span>      <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"global\\"</span></span>\\n<span class=\\"line\\">  <span class=\\"token property\\">datacenters</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"dc1\\"</span><span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">  <span class=\\"token comment\\"># namespace   = \\"mesh\\"</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">  group <span class=\\"token string\\">\\"api\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">network</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">mode</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"bridge\\"</span></span>\\n<span class=\\"line\\">      port <span class=\\"token string\\">\\"api\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">to</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">9001</span> <span class=\\"token comment\\"># static 설정이 없으므로 컨테이너의 앱 9001과 노출되는 임의의 포트와 맵핑</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">service</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">name</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"count-api\\"</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">port</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"api\\"</span> <span class=\\"token comment\\"># 임의의 포트 할당을 network port id로 지정</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">      <span class=\\"token keyword\\">connect</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">sidecar_service</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    task <span class=\\"token string\\">\\"web\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">driver</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"docker\\"</span></span>\\n<span class=\\"line\\">      <span class=\\"token keyword\\">config</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">image</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"hashicorpnomad/counter-api:v1\\"</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">ports</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"api\\"</span><span class=\\"token punctuation\\">]</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">  group <span class=\\"token string\\">\\"dashboard\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">network</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">mode</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"bridge\\"</span></span>\\n<span class=\\"line\\">      port <span class=\\"token string\\">\\"http\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">static</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">9002</span> <span class=\\"token comment\\"># 컨테이너 앱 9002와 외부노출되는 사용자 지정 static port를 맵핑</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">to</span>     <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">9002</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">service</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">name</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"count-dashboard\\"</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">port</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"http\\"</span> <span class=\\"token comment\\"># 할당된 포트를 network port id로 지정</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">      <span class=\\"token keyword\\">connect</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">sidecar_service</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">          <span class=\\"token keyword\\">proxy</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">            <span class=\\"token keyword\\">upstreams</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">              <span class=\\"token property\\">destination_name</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"count-api\\"</span></span>\\n<span class=\\"line\\">              <span class=\\"token property\\">local_bind_port</span>  <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">8080</span> <span class=\\"token comment\\"># backend인 count-api의 실제 port와는 별개로 frontend가 호출할 port 지정</span></span>\\n<span class=\\"line\\">            <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">          <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">        <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    task <span class=\\"token string\\">\\"dashboard\\"</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">driver</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"docker\\"</span></span>\\n<span class=\\"line\\">      <span class=\\"token keyword\\">env</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">COUNTING_SERVICE_URL</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"http://<span class=\\"token interpolation\\"><span class=\\"token punctuation\\">$</span><span class=\\"token punctuation\\">{</span>NOMAD_UPSTREAM_ADDR_count_api<span class=\\"token punctuation\\">}</span></span>\\"</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">      <span class=\\"token keyword\\">config</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">        <span class=\\"token property\\">image</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token string\\">\\"hashicorpnomad/counter-dashboard:v1\\"</span></span>\\n<span class=\\"line\\">      <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">scaling</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">enabled</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token boolean\\">true</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">min</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">1</span></span>\\n<span class=\\"line\\">      <span class=\\"token property\\">max</span> <span class=\\"token punctuation\\">=</span> <span class=\\"token number\\">10</span></span>\\n<span class=\\"line\\">    <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span></code></pre></div>"}');export{k as comp,d as data};
