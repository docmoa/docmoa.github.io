import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,h as e}from"./app-DVMlqOhY.js";const p={},t=e(`<h1 id="nginx-sample" tabindex="-1"><a class="header-anchor" href="#nginx-sample"><span>NGINX Sample</span></a></h1><p>참고 : <a href="https://learn.hashicorp.com/tutorials/consul/load-balancing-nginx" target="_blank" rel="noopener noreferrer">https://learn.hashicorp.com/tutorials/consul/load-balancing-nginx</a></p><h2 id="템플릿-파일-변환-하기" tabindex="-1"><a class="header-anchor" href="#템플릿-파일-변환-하기"><span>템플릿 파일 변환 하기</span></a></h2><h3 id="템플릿-파일-작성" tabindex="-1"><a class="header-anchor" href="#템플릿-파일-작성"><span>템플릿 파일 작성</span></a></h3><ul><li>대상 서비스 : nginx-backend</li></ul><div class="language-hcl line-numbers-mode" data-highlighter="prismjs" data-ext="hcl" data-title="hcl"><pre class="language-hcl"><code><span class="line"><span class="token comment"># nginx.conf.ctmpl</span></span>
<span class="line">upstream <span class="token keyword">backend</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token punctuation">{</span><span class="token punctuation">{</span>- range service <span class="token string">&quot;nginx-backend&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">  <span class="token keyword">server</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>.Address<span class="token punctuation">}</span><span class="token punctuation">}</span>:<span class="token punctuation">{</span><span class="token punctuation">{</span>.Port<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token property">max_fails</span><span class="token punctuation">=</span><span class="token number">3</span> <span class="token property">fail_timeout</span><span class="token punctuation">=</span><span class="token number">60</span> <span class="token property">weight</span><span class="token punctuation">=</span><span class="token number">1</span>;</span>
<span class="line">  <span class="token punctuation">{</span><span class="token punctuation">{</span>else<span class="token punctuation">}</span><span class="token punctuation">}</span>server <span class="token number">127.0</span>.<span class="token number">0.1</span>:<span class="token number">65535</span>; <span class="token comment"># force a 502</span></span>
<span class="line">  <span class="token punctuation">{</span><span class="token punctuation">{</span>- end<span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">server</span> <span class="token punctuation">{</span></span>
<span class="line">  listen <span class="token number">80</span> default_server;</span>
<span class="line"></span>
<span class="line">  location /<span class="token keyword">stub_status</span> <span class="token punctuation">{</span></span>
<span class="line">    stub_status;</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  location / <span class="token punctuation">{</span></span>
<span class="line">    proxy_pass http:<span class="token comment">//backend;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="실행" tabindex="-1"><a class="header-anchor" href="#실행"><span>실행</span></a></h3><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ consul-template <span class="token parameter variable">-template</span><span class="token operator">=</span><span class="token string">&quot;./nginx.conf.ctmpl:./nginx.conf&quot;</span></span>
<span class="line"></span></code></pre></div><div class="hint-container info"><p class="hint-container-title">파일 구조</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token builtin class-name">.</span></span>
<span class="line">├── nginx.conf.ctmpl</span>
<span class="line">└── <span class="token variable"><span class="token variable">\`</span>nginx.conf<span class="token variable">\`</span></span></span>
<span class="line"></span></code></pre></div></div><h2 id="config-활용" tabindex="-1"><a class="header-anchor" href="#config-활용"><span>Config 활용</span></a></h2><h3 id="cli-inline의-옵션을-정의하는-config-작성" tabindex="-1"><a class="header-anchor" href="#cli-inline의-옵션을-정의하는-config-작성"><span>CLI Inline의 옵션을 정의하는 config 작성</span></a></h3><div class="language-hcl line-numbers-mode" data-highlighter="prismjs" data-ext="hcl" data-title="hcl"><pre class="language-hcl"><code><span class="line"><span class="token comment"># consul-template-nginx.hcl</span></span>
<span class="line"><span class="token keyword">consul</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">address</span> <span class="token punctuation">=</span> <span class="token string">&quot;localhost:8500&quot;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">retry</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">enabled</span>  <span class="token punctuation">=</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token property">attempts</span> <span class="token punctuation">=</span> <span class="token number">12</span></span>
<span class="line">    <span class="token property">backoff</span>  <span class="token punctuation">=</span> <span class="token string">&quot;250ms&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">template</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">source</span>      <span class="token punctuation">=</span> <span class="token string">&quot;./nginx.conf.ctmpl&quot;</span></span>
<span class="line">  <span class="token property">destination</span> <span class="token punctuation">=</span> <span class="token string">&quot;./nginx.conf&quot;</span></span>
<span class="line">  <span class="token property">perms</span>       <span class="token punctuation">=</span> <span class="token number">0644</span></span>
<span class="line">  <span class="token property">command</span>     <span class="token punctuation">=</span> <span class="token string">&quot;echo &#39;service nginx reload&#39;&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="실행-1" tabindex="-1"><a class="header-anchor" href="#실행-1"><span>실행</span></a></h3><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line">$ consul-template <span class="token parameter variable">-config</span><span class="token operator">=</span>consul-template-nginx.hcl</span>
<span class="line"><span class="token function">service</span> nginx reload</span>
<span class="line"></span></code></pre></div>`,14),l=[t];function c(i,o){return s(),a("div",null,l)}const d=n(p,[["render",c],["__file","nginx.html.vue"]]),k=JSON.parse('{"path":"/04-HashiCorp/04-Consul/05-Template_Sample/nginx.html","title":"NGINX Sample","lang":"ko-KR","frontmatter":{"description":"Consul Template","tag":["Consul","Consul Template","NGINX"],"head":[["meta",{"property":"og:url","content":"https://docmoa.github.io/04-HashiCorp/04-Consul/05-Template_Sample/nginx.html"}],["meta",{"property":"og:site_name","content":"docmoa"}],["meta",{"property":"og:title","content":"NGINX Sample"}],["meta",{"property":"og:description","content":"Consul Template"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2023-09-19T11:31:31.000Z"}],["meta",{"property":"article:tag","content":"Consul"}],["meta",{"property":"article:tag","content":"Consul Template"}],["meta",{"property":"article:tag","content":"NGINX"}],["meta",{"property":"article:modified_time","content":"2023-09-19T11:31:31.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"NGINX Sample\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-09-19T11:31:31.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"템플릿 파일 변환 하기","slug":"템플릿-파일-변환-하기","link":"#템플릿-파일-변환-하기","children":[{"level":3,"title":"템플릿 파일 작성","slug":"템플릿-파일-작성","link":"#템플릿-파일-작성","children":[]},{"level":3,"title":"실행","slug":"실행","link":"#실행","children":[]}]},{"level":2,"title":"Config 활용","slug":"config-활용","link":"#config-활용","children":[{"level":3,"title":"CLI Inline의 옵션을 정의하는 config 작성","slug":"cli-inline의-옵션을-정의하는-config-작성","link":"#cli-inline의-옵션을-정의하는-config-작성","children":[]},{"level":3,"title":"실행","slug":"실행-1","link":"#실행-1","children":[]}]}],"git":{"createdTime":1634870622000,"updatedTime":1695123091000,"contributors":[{"name":"Great-Stone","email":"hahohh@gmail.com","commits":2},{"name":"Administrator","email":"admin@example.com","commits":1}]},"readingTime":{"minutes":1.8,"words":108},"filePathRelative":"04-HashiCorp/04-Consul/05-Template_Sample/nginx.md","localizedDate":"2021년 10월 22일","excerpt":"\\n<p>참고 : <a href=\\"https://learn.hashicorp.com/tutorials/consul/load-balancing-nginx\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://learn.hashicorp.com/tutorials/consul/load-balancing-nginx</a></p>\\n<h2>템플릿 파일 변환 하기</h2>\\n<h3>템플릿 파일 작성</h3>\\n<ul>\\n<li>대상 서비스 : nginx-backend</li>\\n</ul>\\n<div class=\\"language-hcl\\" data-highlighter=\\"prismjs\\" data-ext=\\"hcl\\" data-title=\\"hcl\\"><pre class=\\"language-hcl\\"><code><span class=\\"line\\"><span class=\\"token comment\\"># nginx.conf.ctmpl</span></span>\\n<span class=\\"line\\">upstream <span class=\\"token keyword\\">backend</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">{</span>- range service <span class=\\"token string\\">\\"nginx-backend\\"</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\">  <span class=\\"token keyword\\">server</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">{</span>.Address<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span>:<span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">{</span>.Port<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span> <span class=\\"token property\\">max_fails</span><span class=\\"token punctuation\\">=</span><span class=\\"token number\\">3</span> <span class=\\"token property\\">fail_timeout</span><span class=\\"token punctuation\\">=</span><span class=\\"token number\\">60</span> <span class=\\"token property\\">weight</span><span class=\\"token punctuation\\">=</span><span class=\\"token number\\">1</span>;</span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">{</span>else<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span>server <span class=\\"token number\\">127.0</span>.<span class=\\"token number\\">0.1</span>:<span class=\\"token number\\">65535</span>; <span class=\\"token comment\\"># force a 502</span></span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">{</span>- end<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">server</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">  listen <span class=\\"token number\\">80</span> default_server;</span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">  location /<span class=\\"token keyword\\">stub_status</span> <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    stub_status;</span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">  location / <span class=\\"token punctuation\\">{</span></span>\\n<span class=\\"line\\">    proxy_pass http:<span class=\\"token comment\\">//backend;</span></span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"><span class=\\"token punctuation\\">}</span></span>\\n<span class=\\"line\\"></span></code></pre></div>"}');export{d as comp,k as data};
