import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as t,c as n,h as o}from"./app-DVMlqOhY.js";const a={},i=o(`<h1 id="connection-termination" tabindex="-1"><a class="header-anchor" href="#connection-termination"><span>Connection termination</span></a></h1><blockquote><ul><li>blog : <a href="https://medium.com/expedia-group-tech/all-about-istio-proxy-5xx-issues-e0221b29e692" target="_blank" rel="noopener noreferrer">https://medium.com/expedia-group-tech/all-about-istio-proxy-5xx-issues-e0221b29e692</a></li><li>issue : <a href="https://github.com/envoyproxy/envoy/issues/14981" target="_blank" rel="noopener noreferrer">https://github.com/envoyproxy/envoy/issues/14981</a></li><li>envoy proxy error code : <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/response_code_details" target="_blank" rel="noopener noreferrer">https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/response_code_details</a></li></ul></blockquote><h2 id="로그" tabindex="-1"><a class="header-anchor" href="#로그"><span>로그</span></a></h2><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="line"><span class="token punctuation">[</span>debug<span class="token punctuation">]</span> <span class="token punctuation">[</span>router<span class="token punctuation">]</span> upstream reset: reset reason: connection termination, transport failure reason.</span>
<span class="line"><span class="token punctuation">[</span>debug<span class="token punctuation">]</span> <span class="token punctuation">[</span>http<span class="token punctuation">]</span> Sending <span class="token builtin class-name">local</span> reply with details upstream_reset_before_response_started<span class="token punctuation">(</span>connection termination<span class="token punctuation">)</span>.</span>
<span class="line"></span></code></pre></div><h2 id="현상" tabindex="-1"><a class="header-anchor" href="#현상"><span>현상</span></a></h2><ul><li>upstream_reset_before_response_started : The upstream connection was reset before a response was started This may include further details about the cause of the disconnect.</li></ul><h2 id="connection-termination-1" tabindex="-1"><a class="header-anchor" href="#connection-termination-1"><span>connection termination</span></a></h2><ul><li><p>원인 1: Envoy에서 TCP 연결(FIN)이 닫는 현상 보고됨 - Keepalive time 이슈</p></li><li><p>해결 1 - 1: Keepalive time을 끄거나</p></li><li><p>해결 1 - 2: max_requests_per_connection 을 1로 설정</p></li><li><p>해결 1 - 3: Keepalive interval을 짧게 (10초)</p></li><li><p>원인 2 : Kubernetes 내부 기본 TCP 계층 4 연결 부하 분산의 제한, (e.g. tomcat - maxKeepAliveRequests)</p></li><li><p>해결 2 - 1: 애플리케이션의 KeepAlive를 끔</p></li><li><p>원인 3 : 외부 서비스에 대해 요청시 Envoy Proxy는 애플리케이션이 연결을 닫으려 하지 않는 한 영구적으로 연결을 닫지 않으므로 신규요청 발생시 IPSET이 만료되는 (1시간) 시간이 지나 DNS 확인 없이 동일한 IP로 요청하는 경우</p></li><li><p>해결 3 - 1: Keepalive time을 끄거나</p></li><li><p>해결 3 - 2: 시간 초과 값을 늘임</p></li><li><p>해결 3 - 3: dns_refresh_rate 간격을 짧게 (300초)</p></li></ul>`,8),r=[i];function s(p,l){return t(),n("div",null,r)}const u=e(a,[["render",s],["__file","connection-termination.html.vue"]]),h=JSON.parse('{"path":"/04-HashiCorp/04-Consul/04-TroubleShooting/connection-termination.html","title":"Connection termination","lang":"ko-KR","frontmatter":{"description":"Envoy proxy 50x Error","tag":["Consul","ServiceMesh","SideCar","Kubernetes","K8S"],"head":[["meta",{"property":"og:url","content":"https://docmoa.github.io/04-HashiCorp/04-Consul/04-TroubleShooting/connection-termination.html"}],["meta",{"property":"og:site_name","content":"docmoa"}],["meta",{"property":"og:title","content":"Connection termination"}],["meta",{"property":"og:description","content":"Envoy proxy 50x Error"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2023-09-18T13:12:54.000Z"}],["meta",{"property":"article:tag","content":"Consul"}],["meta",{"property":"article:tag","content":"ServiceMesh"}],["meta",{"property":"article:tag","content":"SideCar"}],["meta",{"property":"article:tag","content":"Kubernetes"}],["meta",{"property":"article:tag","content":"K8S"}],["meta",{"property":"article:modified_time","content":"2023-09-18T13:12:54.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Connection termination\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-09-18T13:12:54.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"로그","slug":"로그","link":"#로그","children":[]},{"level":2,"title":"현상","slug":"현상","link":"#현상","children":[]},{"level":2,"title":"connection termination","slug":"connection-termination-1","link":"#connection-termination-1","children":[]}],"git":{"createdTime":1649167505000,"updatedTime":1695042774000,"contributors":[{"name":"Administrator","email":"admin@example.com","commits":2},{"name":"Great-Stone","email":"hahohh@gmail.com","commits":1}]},"readingTime":{"minutes":2.1,"words":126},"filePathRelative":"04-HashiCorp/04-Consul/04-TroubleShooting/connection-termination.md","localizedDate":"2022년 4월 5일","excerpt":"\\n<blockquote>\\n<ul>\\n<li>blog : <a href=\\"https://medium.com/expedia-group-tech/all-about-istio-proxy-5xx-issues-e0221b29e692\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://medium.com/expedia-group-tech/all-about-istio-proxy-5xx-issues-e0221b29e692</a></li>\\n<li>issue : <a href=\\"https://github.com/envoyproxy/envoy/issues/14981\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://github.com/envoyproxy/envoy/issues/14981</a></li>\\n<li>envoy proxy error code : <a href=\\"https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/response_code_details\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://www.envoyproxy.io/docs/envoy/latest/configuration/http/http_conn_man/response_code_details</a></li>\\n</ul>\\n</blockquote>"}');export{u as comp,h as data};
