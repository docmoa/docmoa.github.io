import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o as l,c as t,a as n,b as i,w as o,h as s,g as c}from"./app-DVMlqOhY.js";const u="/assets/nfs-csi-BDVjkhWP.png",r={},d=s(`<h1 id="nomad-csi-nfs" tabindex="-1"><a class="header-anchor" href="#nomad-csi-nfs"><span>nomad csi (nfs)</span></a></h1><ul><li>nomad에서 외부 storage를 사용하기 위한 plugin <ul><li>그 중에서도 접근성이 좋은 nfs를 사용, public cloud에서 제공하는 storage와는 사용법이 다를 수 있음</li></ul></li><li>구성환경은 아래와 같다.(사실 nfs server정보만 보면 될 거 같음) <ul><li>nfs-server 10.0.0.151:/mnt/data</li></ul></li></ul><h2 id="controller" tabindex="-1"><a class="header-anchor" href="#controller"><span>controller</span></a></h2><ul><li>하나이상의 node에 storage를 배포할 수 있게 해주는 중앙관리 기능</li><li>어느 node(client)에 띄어져도 상관없다.</li></ul><div class="language-hcl line-numbers-mode" data-highlighter="prismjs" data-ext="hcl" data-title="hcl"><pre class="language-hcl"><code><span class="line">job <span class="token string">&quot;plugin-nfs-controller&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">datacenters</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;dc1&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">  group <span class="token string">&quot;controller&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">    task <span class="token string">&quot;plugin&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">driver</span> <span class="token punctuation">=</span> <span class="token string">&quot;docker&quot;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">config</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">image</span> <span class="token punctuation">=</span> <span class="token string">&quot;mcr.microsoft.com/k8s/csi/nfs-csi:latest&quot;</span></span>
<span class="line"></span>
<span class="line">        <span class="token property">args</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token string">&quot;--endpoint=unix://csi/csi.sock&quot;</span>,</span>
<span class="line">          <span class="token string">&quot;--nodeid=<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>attr<span class="token punctuation">.</span>unique<span class="token punctuation">.</span>hostname<span class="token punctuation">}</span></span>&quot;</span>,</span>
<span class="line">          <span class="token string">&quot;--logtostderr&quot;</span>,</span>
<span class="line">          <span class="token string">&quot;-v=5&quot;</span>,</span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">csi_plugin</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">id</span>        <span class="token punctuation">=</span> <span class="token string">&quot;nfs&quot;</span></span>
<span class="line">        <span class="token property">type</span>      <span class="token punctuation">=</span> <span class="token string">&quot;controller&quot;</span></span>
<span class="line">        <span class="token property">mount_dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/csi&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">resources</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">cpu</span>    <span class="token punctuation">=</span> <span class="token number">250</span></span>
<span class="line">        <span class="token property">memory</span> <span class="token punctuation">=</span> <span class="token number">128</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="node-plugin" tabindex="-1"><a class="header-anchor" href="#node-plugin"><span>node plugin</span></a></h2><ul><li>컨테이너가 동작하는, 그리고 storage가 띄어져야 할 모든 node에 올라가야됨</li></ul><div class="language-hcl line-numbers-mode" data-highlighter="prismjs" data-ext="hcl" data-title="hcl"><pre class="language-hcl"><code><span class="line">job <span class="token string">&quot;plugin-nfs-nodes&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">datacenters</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;dc1&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">  <span class="token property">type</span> <span class="token punctuation">=</span> <span class="token string">&quot;system&quot;</span></span>
<span class="line"></span>
<span class="line">  group <span class="token string">&quot;nodes&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">    task <span class="token string">&quot;plugin&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">driver</span> <span class="token punctuation">=</span> <span class="token string">&quot;docker&quot;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">config</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">image</span> <span class="token punctuation">=</span> <span class="token string">&quot;mcr.microsoft.com/k8s/csi/nfs-csi:latest&quot;</span></span>
<span class="line"></span>
<span class="line">        <span class="token property">args</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token string">&quot;--endpoint=unix://csi/csi.sock&quot;</span>,</span>
<span class="line">          <span class="token string">&quot;--nodeid=<span class="token interpolation"><span class="token punctuation">$</span><span class="token punctuation">{</span>attr<span class="token punctuation">.</span>unique<span class="token punctuation">.</span>hostname<span class="token punctuation">}</span></span>&quot;</span>,</span>
<span class="line">          <span class="token string">&quot;--logtostderr&quot;</span>,</span>
<span class="line">          <span class="token string">&quot;--v=5&quot;</span>,</span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">        <span class="token property">privileged</span> <span class="token punctuation">=</span> <span class="token boolean">true</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">csi_plugin</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">id</span>        <span class="token punctuation">=</span> <span class="token string">&quot;nfs&quot;</span></span>
<span class="line">        <span class="token property">type</span>      <span class="token punctuation">=</span> <span class="token string">&quot;node&quot;</span></span>
<span class="line">        <span class="token property">mount_dir</span> <span class="token punctuation">=</span> <span class="token string">&quot;/csi&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">resources</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token property">cpu</span>    <span class="token punctuation">=</span> <span class="token number">250</span></span>
<span class="line">        <span class="token property">memory</span> <span class="token punctuation">=</span> <span class="token number">128</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nomad-volume" tabindex="-1"><a class="header-anchor" href="#nomad-volume"><span>nomad volume</span></a></h2><ul><li>csi를 이용하여 실제 사용할 volume을 만든다.</li><li>cli: nomad volume register [파일명] <ul><li>다른 건 nomad doc에 다 나오지만 nfs 마운트 명령어에 던져 줄 parameter 값을 넣어줘야 할 경우에는 context에 넣어줘야한다.</li></ul></li></ul><div class="language-hcl line-numbers-mode" data-highlighter="prismjs" data-ext="hcl" data-title="hcl"><pre class="language-hcl"><code><span class="line"><span class="token property">id</span>           <span class="token punctuation">=</span> <span class="token string">&quot;nfs-vol&quot;</span></span>
<span class="line"><span class="token property">name</span>         <span class="token punctuation">=</span> <span class="token string">&quot;nfs&quot;</span></span>
<span class="line"><span class="token property">type</span>         <span class="token punctuation">=</span> <span class="token string">&quot;csi&quot;</span></span>
<span class="line"><span class="token property">external_id</span>  <span class="token punctuation">=</span> <span class="token string">&quot;nfs&quot;</span></span>
<span class="line"><span class="token property">plugin_id</span>    <span class="token punctuation">=</span> <span class="token string">&quot;nfs&quot;</span></span>
<span class="line"><span class="token comment">#snapshot_id  = &quot;test&quot; # or clone_id, see below</span></span>
<span class="line"><span class="token property">capacity_max</span> <span class="token punctuation">=</span> <span class="token string">&quot;20G&quot;</span></span>
<span class="line"><span class="token property">capacity_min</span> <span class="token punctuation">=</span> <span class="token string">&quot;10G&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">capability</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">access_mode</span>     <span class="token punctuation">=</span> <span class="token string">&quot;single-node-writer&quot;</span></span>
<span class="line">  <span class="token property">attachment_mode</span> <span class="token punctuation">=</span> <span class="token string">&quot;file-system&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">mount_options</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">fs_type</span>     <span class="token punctuation">=</span> <span class="token string">&quot;ext4&quot;</span></span>
<span class="line">  <span class="token property">mount_flags</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;noatime&quot;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">context</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">server</span>  <span class="token punctuation">=</span> <span class="token string">&quot;10.0.0.151&quot;</span></span>
<span class="line">  <span class="token property">share</span>   <span class="token punctuation">=</span> <span class="token string">&quot;/mnt/data&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="job에는-아래와-같이-추가하여-사용했다" tabindex="-1"><a class="header-anchor" href="#job에는-아래와-같이-추가하여-사용했다"><span>job에는 아래와 같이 추가하여 사용했다.</span></a></h2>`,12),m=s(`<div class="language-hcl" data-highlighter="prismjs" data-ext="hcl" data-title="hcl"><pre class="language-hcl"><code><span class="line">    volume <span class="token string">&quot;nfs-vol&quot;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">type</span>            <span class="token punctuation">=</span> <span class="token string">&quot;csi&quot;</span></span>
<span class="line">      <span class="token property">source</span>          <span class="token punctuation">=</span> <span class="token string">&quot;nfs-vol&quot;</span></span>
<span class="line">      <span class="token property">read_only</span>       <span class="token punctuation">=</span> <span class="token boolean">false</span></span>
<span class="line">      <span class="token property">attachment_mode</span> <span class="token punctuation">=</span> <span class="token string">&quot;file-system&quot;</span></span>
<span class="line">      <span class="token property">access_mode</span>     <span class="token punctuation">=</span> <span class="token string">&quot;single-node-writer&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre></div><h2 id="nomad-volume페이지에서-확인" tabindex="-1"><a class="header-anchor" href="#nomad-volume페이지에서-확인"><span>nomad volume페이지에서 확인</span></a></h2><ul><li>nomad ui에서 volume 페이지에서 alloc에서 사용 중인 volume을 볼 수 있다<br><img src="`+u+'" alt="" loading="lazy"></li></ul>',3);function v(k,g){const a=p("RouteLink");return l(),t("div",null,[d,n("ul",null,[n("li",null,[i(a,{to:"/04-HashiCorp/07-Nomad/05-SampleJob/jboss.html"},{default:o(()=>[c("원본 job")]),_:1})])]),m])}const q=e(r,[["render",v],["__file","csi-nfs.html.vue"]]),y=JSON.parse('{"path":"/04-HashiCorp/07-Nomad/02-Config/csi-nfs.html","title":"nomad csi (nfs)","lang":"ko-KR","frontmatter":{"description":"Nomad Sample","tag":["Nomad","config","csi","nfs"],"head":[["meta",{"property":"og:url","content":"https://docmoa.github.io/04-HashiCorp/07-Nomad/02-Config/csi-nfs.html"}],["meta",{"property":"og:site_name","content":"docmoa"}],["meta",{"property":"og:title","content":"nomad csi (nfs)"}],["meta",{"property":"og:description","content":"Nomad Sample"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"ko-KR"}],["meta",{"property":"og:updated_time","content":"2023-09-18T13:12:54.000Z"}],["meta",{"property":"article:tag","content":"Nomad"}],["meta",{"property":"article:tag","content":"config"}],["meta",{"property":"article:tag","content":"csi"}],["meta",{"property":"article:tag","content":"nfs"}],["meta",{"property":"article:modified_time","content":"2023-09-18T13:12:54.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"nomad csi (nfs)\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-09-18T13:12:54.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"controller","slug":"controller","link":"#controller","children":[]},{"level":2,"title":"node plugin","slug":"node-plugin","link":"#node-plugin","children":[]},{"level":2,"title":"nomad volume","slug":"nomad-volume","link":"#nomad-volume","children":[]},{"level":2,"title":"job에는 아래와 같이 추가하여 사용했다.","slug":"job에는-아래와-같이-추가하여-사용했다","link":"#job에는-아래와-같이-추가하여-사용했다","children":[]},{"level":2,"title":"nomad volume페이지에서 확인","slug":"nomad-volume페이지에서-확인","link":"#nomad-volume페이지에서-확인","children":[]}],"git":{"createdTime":1639885372000,"updatedTime":1695042774000,"contributors":[{"name":"ung","email":"swbs90@naver.com","commits":2},{"name":"Great-Stone","email":"hahohh@gmail.com","commits":1},{"name":"unghee","email":"ung@mz.co.kr","commits":1}]},"readingTime":{"minutes":3.45,"words":207},"filePathRelative":"04-HashiCorp/07-Nomad/02-Config/csi-nfs.md","localizedDate":"2021년 12월 19일","excerpt":"\\n<ul>\\n<li>nomad에서 외부 storage를 사용하기 위한 plugin\\n<ul>\\n<li>그 중에서도 접근성이 좋은 nfs를 사용, public cloud에서 제공하는 storage와는 사용법이 다를 수 있음</li>\\n</ul>\\n</li>\\n<li>구성환경은 아래와 같다.(사실 nfs server정보만 보면 될 거 같음)\\n<ul>\\n<li>nfs-server 10.0.0.151:/mnt/data</li>\\n</ul>\\n</li>\\n</ul>\\n<h2>controller</h2>\\n<ul>\\n<li>하나이상의 node에 storage를 배포할 수 있게 해주는 중앙관리 기능</li>\\n<li>어느 node(client)에 띄어져도 상관없다.</li>\\n</ul>"}');export{q as comp,y as data};
